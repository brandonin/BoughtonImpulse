(function(u,y,s){u.execute(function(){u.when("A","jQuery").register("jq-ui-widget",function(n,j){(function(g){g(j)})(function(g,d){var a=0,e=Array.prototype.slice,c=g.cleanData;g.cleanData=function(b){for(var a=0,f;(f=b[a])!=null;a++)try{g(f).triggerHandler("remove")}catch(e){}c(b)};g.widget=function(b,a,f){var c,e,d,m,o={},t=b.split(".")[0],b=b.split(".")[1];c=t+"-"+b;if(!f)f=a,a=g.Widget;g.expr[":"][c.toLowerCase()]=function(b){return!!g.data(b,c)};g[t]=g[t]||{};e=g[t][b];d=g[t][b]=function(b,f){if(!this._createWidget)return new d(b,
f);arguments.length&&this._createWidget(b,f)};g.extend(d,e,{version:f.version,_proto:g.extend({},f),_childConstructors:[]});m=new a;m.options=g.widget.extend({},m.options);g.each(f,function(b,f){o[b]=g.isFunction(f)?function(){var c=function(){return a.prototype[b].apply(this,arguments)},e=function(f){return a.prototype[b].apply(this,f)};return function(){var b=this._super,a=this._superApply,h;this._super=c;this._superApply=e;h=f.apply(this,arguments);this._super=b;this._superApply=a;return h}}():
f});d.prototype=g.widget.extend(m,{widgetEventPrefix:e?m.widgetEventPrefix||b:b},o,{constructor:d,namespace:t,widgetName:b,widgetFullName:c});e?(g.each(e._childConstructors,function(b,f){var a=f.prototype;g.widget(a.namespace+"."+a.widgetName,d,f._proto)}),delete e._childConstructors):a._childConstructors.push(d);g.widget.bridge(b,d)};g.widget.extend=function(b){for(var a=e.call(arguments,1),f=0,c=a.length,k,i;f<c;f++)for(k in a[f])i=a[f][k],a[f].hasOwnProperty(k)&&i!==d&&(b[k]=g.isPlainObject(i)?
g.isPlainObject(b[k])?g.widget.extend({},b[k],i):g.widget.extend({},i):i);return b};g.widget.bridge=function(b,a){var f=a.prototype.widgetFullName||b;g.fn[b]=function(c){var k=typeof c==="string",i=e.call(arguments,1),m=this,c=!k&&i.length?g.widget.extend.apply(null,[c].concat(i)):c;k?this.each(function(){var a,h=g.data(this,f);if(!h)return g.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+c+"'");if(!g.isFunction(h[c])||c.charAt(0)==="_")return g.error("no such method '"+
c+"' for "+b+" widget instance");a=h[c].apply(h,i);if(a!==h&&a!==d)return m=a&&a.jquery?m.pushStack(a.get()):a,!1}):this.each(function(){var b=g.data(this,f);b?b.option(c||{})._init():g.data(this,f,new a(c,this))});return m}};g.Widget=function(){};g.Widget._childConstructors=[];g.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,h){h=g(h||this.defaultElement||this)[0];this.element=g(h);this.uuid=a++;this.eventNamespace=
"."+this.widgetName+this.uuid;this.options=g.widget.extend({},this.options,this._getCreateOptions(),b);this.bindings=g();this.hoverable=g();this.focusable=g();if(h!==this)g.data(h,this.widgetFullName,this),this._on(!0,this.element,{remove:function(b){b.target===h&&this.destroy()}}),this.document=g(h.style?h.ownerDocument:h.document||h),this.window=g(this.document[0].defaultView||this.document[0].parentWindow);this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:g.noop,
_getCreateEventData:g.noop,_create:g.noop,_init:g.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(g.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},
_destroy:g.noop,widget:function(){return this.element},option:function(b,a){var f=b,c,e,i;if(arguments.length===0)return g.widget.extend({},this.options);if(typeof b==="string")if(f={},c=b.split("."),b=c.shift(),c.length){e=f[b]=g.widget.extend({},this.options[b]);for(i=0;i<c.length-1;i++)e[c[i]]=e[c[i]]||{},e=e[c[i]];b=c.pop();if(arguments.length===1)return e[b]===d?null:e[b];e[b]=a}else{if(arguments.length===1)return this.options[b]===d?null:this.options[b];f[b]=a}this._setOptions(f);return this},
_setOptions:function(b){for(var a in b)this._setOption(a,b[a]);return this},_setOption:function(b,a){this.options[b]=a;b==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!a).attr("aria-disabled",a),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"));return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,a,f){var c,e=this;typeof b!==
"boolean"&&(f=a,a=b,b=!1);f?(a=c=g(a),this.bindings=this.bindings.add(a)):(f=a,a=this.element,c=this.widget());g.each(f,function(f,d){function o(){return!b&&(e.options.disabled===!0||g(this).hasClass("ui-state-disabled"))?void 0:(typeof d==="string"?e[d]:d).apply(e,arguments)}if(typeof d!=="string")o.guid=d.guid=d.guid||o.guid||g.guid++;var t=f.match(/^(\w+)\s*(.*)$/),p=t[1]+e.eventNamespace;(t=t[2])?c.delegate(t,p,o):a.bind(p,o)})},_off:function(b,a){a=(a||"").split(" ").join(this.eventNamespace+
" ")+this.eventNamespace;b.unbind(a).undelegate(a)},_delay:function(b,a){var f=this;return setTimeout(function(){return(typeof b==="string"?f[b]:b).apply(f,arguments)},a||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b);this._on(b,{mouseenter:function(b){g(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){g(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b);this._on(b,{focusin:function(b){g(b.currentTarget).addClass("ui-state-focus")},
focusout:function(b){g(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,a,f){var c,e=this.options[b],f=f||{},a=g.Event(a);a.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();a.target=this.element[0];if(b=a.originalEvent)for(c in b)c in a||(a[c]=b[c]);this.element.trigger(a,f);return!(g.isFunction(e)&&e.apply(this.element[0],[a].concat(f))===!1||a.isDefaultPrevented())}};g.each({show:"fadeIn",hide:"fadeOut"},function(b,a){g.Widget.prototype["_"+b]=function(f,
c,e){typeof c==="string"&&(c={effect:c});var d,m=!c?b:c===!0||typeof c==="number"?a:c.effect||a,c=c||{};typeof c==="number"&&(c={duration:c});d=!g.isEmptyObject(c);c.complete=e;c.delay&&f.delay(c.delay);if(d&&g.effects&&g.effects.effect[m])f[b](c);else if(m!==b&&f[m])f[m](c.duration,c.easing,e);else f.queue(function(a){g(this)[b]();e&&e.call(f[0]);a()})}})})});u.when("A","jQuery").register("jq-IframeTransport",function(n,j){(function(g){g(j)})(function(g){var d=0;g.ajaxTransport("iframe",function(a){if(a.async){var e=
a.initialIframeSrc||"javascript:false;",c,b,h;return{send:function(f,l){c=g('<form style="display:none;"></form>');c.attr("accept-charset",a.formAcceptCharset);h=/\?/.test(a.url)?"&":"?";if(a.type==="DELETE")a.url=a.url+h+"_method=DELETE",a.type="POST";else if(a.type==="PUT")a.url=a.url+h+"_method=PUT",a.type="POST";else if(a.type==="PATCH")a.url=a.url+h+"_method=PATCH",a.type="POST";d+=1;b=g('<iframe src="'+e+'" name="iframe-transport-'+d+'"></iframe>').bind("load",function(){var f,h=g.isArray(a.paramName)?
a.paramName:[a.paramName];b.unbind("load").bind("load",function(){var f;try{if(f=b.contents(),!f.length||!f[0].firstChild)throw Error();}catch(a){f=s}l(200,"success",{iframe:f});g('<iframe src="'+e+'"></iframe>').appendTo(c);y.setTimeout(function(){c.remove()},0)});c.prop("target",b.prop("name")).prop("action",a.url).prop("method",a.type);a.formData&&g.each(a.formData,function(b,f){f.name!=="file"&&g('<input type="hidden"/>').prop("name",f.name).val(f.value).appendTo(c)});a.fileInput&&a.fileInput.length&&
a.type==="POST"&&(f=a.fileInput.clone(),a.fileInput.after(function(b){return f[b]}),a.paramName&&a.fileInput.each(function(b){g(this).prop("name",h[b]||a.paramName)}),c.append(a.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),a.fileInput.removeAttr("form"));c.submit();f&&f.length&&a.fileInput.each(function(b,a){var h=g(f[b]);g(a).prop("name",h.prop("name")).attr("form",h.attr("form"));h.replaceWith(a)})});c.append(b).appendTo(document.body)},abort:function(){b&&
b.unbind("load").prop("src",e);c&&c.remove()}}}});g.ajaxSetup({converters:{"iframe text":function(a){return a&&g(a[0].body).text()},"iframe json":function(a){return a&&g.parseJSON(g(a[0].body).text())},"iframe html":function(a){return a&&g(a[0].body).html()},"iframe xml":function(a){return(a=a&&a[0])&&g.isXMLDoc(a)?a:g.parseXML(a.XMLDocument&&a.XMLDocument.xml||g(a.body).html())},"iframe script":function(a){return a&&g.globalEval(g(a[0].body).text())}}})})});u.when("A","jQuery","jq-ui-widget").register("jq-fileupload",
function(n,j){(function(g){g(j)})(function(g){g.support.fileInput=!(RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(y.navigator.userAgent)||g('<input type="file">').prop("disabled"));g.support.xhrFileUpload=!(!y.ProgressEvent||!y.FileReader);g.support.xhrFormDataFileUpload=!!y.FormData;g.support.blobSlice=y.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);
g.widget("blueimp.fileupload",{options:{dropZone:g(document),pasteZone:g(document),fileInput:s,replaceFileInput:!0,paramName:s,singleFileUploads:!0,limitMultiFileUploads:s,limitMultiFileUploadSize:s,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:s,forceIframeTransport:!1,redirect:s,redirectParamName:s,postMessage:s,multipart:!0,maxChunkSize:s,uploadedBytes:s,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},
i18n:function(d,a){d=this.messages[d]||d.toString();a&&g.each(a,function(a,c){d=d.replace("{"+a+"}",c)});return d},formData:function(d){return d.serializeArray()},add:function(d,a){if(d.isDefaultPrevented())return!1;(a.autoUpload||a.autoUpload!==!1&&g(this).fileupload("option","autoUpload"))&&a.process().done(function(){a.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:g.support.blobSlice&&function(){return(this.slice||
this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(d,a,e){var c=d-this.timestamp;if(!this.bitrate||!e||c>e)this.bitrate=(a-this.loaded)*(1E3/c)*8,this.loaded=a,this.timestamp=d;return this.bitrate}},_isXHRUpload:function(d){return!d.forceIframeTransport&&(!d.multipart&&g.support.xhrFileUpload||g.support.xhrFormDataFileUpload)},_getFormData:function(d){var a;if(g.type(d.formData)===
"function")return d.formData(d.form);if(g.isArray(d.formData))return d.formData;return g.type(d.formData)==="object"?(a=[],g.each(d.formData,function(e,c){a.push({name:e,value:c})}),a):[]},_getTotal:function(d){var a=0;g.each(d,function(e,c){a+=c.size||1});return a},_initProgressObject:function(d){var a={loaded:0,total:0,bitrate:0};d._progress?g.extend(d._progress,a):d._progress=a},_initResponseObject:function(d){var a;if(d._response)for(a in d._response)d._response.hasOwnProperty(a)&&delete d._response[a];
else d._response={}},_onProgress:function(d,a){if(d.lengthComputable){var e=Date.now?Date.now():(new Date).getTime(),c;if(!a._time||!a.progressInterval||!(e-a._time<a.progressInterval&&d.loaded!==d.total))a._time=e,c=Math.floor(d.loaded/d.total*(a.chunkSize||a._progress.total))+(a.uploadedBytes||0),this._progress.loaded+=c-a._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(e,this._progress.loaded,a.bitrateInterval),a._progress.loaded=a.loaded=c,a._progress.bitrate=a.bitrate=a._bitrateTimer.getBitrate(e,
c,a.bitrateInterval),this._trigger("progress",g.Event("progress",{delegatedEvent:d}),a),this._trigger("progressall",g.Event("progressall",{delegatedEvent:d}),this._progress)}},_initProgressListener:function(d){var a=this,e=d.xhr?d.xhr():g.ajaxSettings.xhr();if(e.upload)g(e.upload).bind("progress",function(c){var b=c.originalEvent;c.lengthComputable=b.lengthComputable;c.loaded=b.loaded;c.total=b.total;a._onProgress(c,d)}),d.xhr=function(){return e}},_isInstanceOf:function(d,a){return Object.prototype.toString.call(a)===
"[object "+d+"]"},_initXHRData:function(d){var a=this,e,c=d.files[0],b=d.multipart||!g.support.xhrFileUpload,h=g.type(d.paramName)==="array"?d.paramName[0]:d.paramName;d.headers=g.extend({},d.headers);if(d.contentRange)d.headers["Content-Range"]=d.contentRange;if(!b||d.blob||!this._isInstanceOf("File",c))d.headers["Content-Disposition"]='attachment; filename="'+encodeURI(c.name)+'"';if(b){if(g.support.xhrFormDataFileUpload)d.postMessage?(e=this._getFormData(d),d.blob?e.push({name:h,value:d.blob}):
g.each(d.files,function(b,a){e.push({name:g.type(d.paramName)==="array"&&d.paramName[b]||h,value:a})})):(a._isInstanceOf("FormData",d.formData)?e=d.formData:(e=new FormData,g.each(this._getFormData(d),function(b,a){e.append(a.name,a.value)})),d.blob?e.append(h,d.blob,c.name):g.each(d.files,function(b,c){if(a._isInstanceOf("File",c)||a._isInstanceOf("Blob",c))e.append(g.type(d.paramName)==="array"&&d.paramName[b]||h,c,c.uploadName||c.name)})),d.data=e}else d.contentType=c.type||"application/octet-stream",
d.data=d.blob||c;d.blob=null},_initIframeSettings:function(d){var a=g("<a></a>").prop("href",d.url).prop("host");d.dataType="iframe "+(d.dataType||"");d.formData=this._getFormData(d);d.redirect&&a&&a!==location.host&&d.formData.push({name:d.redirectParamName||"redirect",value:d.redirect})},_initDataSettings:function(d){if(this._isXHRUpload(d)){if(this._chunkedUpload(d,!0)||(d.data||this._initXHRData(d),this._initProgressListener(d)),d.postMessage)d.dataType="postmessage "+(d.dataType||"")}else this._initIframeSettings(d)},
_getParamName:function(d){var a=g(d.fileInput),e=d.paramName;e?g.isArray(e)||(e=[e]):(e=[],a.each(function(){for(var a=g(this),b=a.prop("name")||"files[]",a=(a.prop("files")||[1]).length;a;)e.push(b),a-=1}),e.length||(e=[a.prop("name")||"files[]"]));return e},_initFormSettings:function(d){if(!d.form||!d.form.length)if(d.form=g(d.fileInput.prop("form")),!d.form.length)d.form=g(this.options.fileInput.prop("form"));d.paramName=this._getParamName(d);if(!d.url)d.url=d.form.prop("action")||location.href;
d.type=(d.type||g.type(d.form.prop("method"))==="string"&&d.form.prop("method")||"").toUpperCase();if(d.type!=="POST"&&d.type!=="PUT"&&d.type!=="PATCH")d.type="POST";if(!d.formAcceptCharset)d.formAcceptCharset=d.form.attr("accept-charset")},_getAJAXSettings:function(d){d=g.extend({},this.options,d);this._initFormSettings(d);this._initDataSettings(d);return d},_getDeferredState:function(d){return d.state?d.state():d.isResolved()?"resolved":d.isRejected()?"rejected":"pending"},_enhancePromise:function(d){d.success=
d.done;d.error=d.fail;d.complete=d.always;return d},_getXHRPromise:function(d,a,e){var c=g.Deferred(),b=c.promise(),a=a||this.options.context||b;d===!0?c.resolveWith(a,e):d===!1&&c.rejectWith(a,e);b.abort=c.promise;return this._enhancePromise(b)},_addConvenienceMethods:function(d,a){var e=this,c=function(b){return g.Deferred().resolveWith(e,b).promise()};a.process=function(b,h){if(b||h)a._processQueue=this._processQueue=(this._processQueue||c([this])).pipe(function(){return a.errorThrown?g.Deferred().rejectWith(e,
[a]).promise():c(arguments)}).pipe(b,h);return this._processQueue||c([this])};a.submit=function(){if(this.state()!=="pending")a.jqXHR=this.jqXHR=e._trigger("submit",g.Event("submit",{delegatedEvent:d}),this)!==!1&&e._onSend(d,this);return this.jqXHR||e._getXHRPromise()};a.abort=function(){if(this.jqXHR)return this.jqXHR.abort();this.errorThrown="abort";e._trigger("fail",null,this);return e._getXHRPromise(!1)};a.state=function(){if(this.jqXHR)return e._getDeferredState(this.jqXHR);if(this._processQueue)return e._getDeferredState(this._processQueue)};
a.processing=function(){return!this.jqXHR&&this._processQueue&&e._getDeferredState(this._processQueue)==="pending"};a.progress=function(){return this._progress};a.response=function(){return this._response}},_getUploadedBytes:function(d){var b;var a;return(b=(a=(d=d.getResponseHeader("Range"))&&d.split("-"),d=a)&&d.length>1&&parseInt(d[1],10),d=b)&&d+1},_chunkedUpload:function(d,a){d.uploadedBytes=d.uploadedBytes||0;var e=this,c=d.files[0],b=c.size,h=d.uploadedBytes,f=d.maxChunkSize||b,l=this._blobSlice,
k=g.Deferred(),i=k.promise(),m,o;if(!this._isXHRUpload(d)||!l||!(h||f<b)||d.data)return!1;if(a)return!0;if(h>=b)return c.error=d.i18n("uploadedBytes"),this._getXHRPromise(!1,d.context,[null,"error",c.error]);o=function(){var a=g.extend({},d),i=a._progress.loaded;a.blob=l.call(c,h,h+f,c.type);a.chunkSize=a.blob.size;a.contentRange="bytes "+h+"-"+(h+a.chunkSize-1)+"/"+b;e._initXHRData(a);e._initProgressListener(a);m=(e._trigger("chunksend",null,a)!==!1&&g.ajax(a)||e._getXHRPromise(!1,a.context)).done(function(f,
c,l){h=e._getUploadedBytes(l)||h+a.chunkSize;i+a.chunkSize-a._progress.loaded&&e._onProgress(g.Event("progress",{lengthComputable:!0,loaded:h-a.uploadedBytes,total:h-a.uploadedBytes}),a);d.uploadedBytes=a.uploadedBytes=h;a.result=f;a.textStatus=c;a.jqXHR=l;e._trigger("chunkdone",null,a);e._trigger("chunkalways",null,a);h<b?o():k.resolveWith(a.context,[f,c,l])}).fail(function(b,f,h){a.jqXHR=b;a.textStatus=f;a.errorThrown=h;e._trigger("chunkfail",null,a);e._trigger("chunkalways",null,a);k.rejectWith(a.context,
[b,f,h])})};this._enhancePromise(i);i.abort=function(){return m.abort()};o();return i},_beforeSend:function(d,a){if(this._active===0)this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0;this._initResponseObject(a);this._initProgressObject(a);a._progress.loaded=a.loaded=a.uploadedBytes||0;a._progress.total=a.total=this._getTotal(a.files)||1;a._progress.bitrate=a.bitrate=0;this._active+=1;this._progress.loaded+=a.loaded;
this._progress.total+=a.total},_onDone:function(d,a,e,c){var b=c._progress.total,h=c._response;c._progress.loaded<b&&this._onProgress(g.Event("progress",{lengthComputable:!0,loaded:b,total:b}),c);h.result=c.result=d;h.textStatus=c.textStatus=a;h.jqXHR=c.jqXHR=e;this._trigger("done",null,c)},_onFail:function(d,a,e,c){var b=c._response;c.recalculateProgress&&(this._progress.loaded-=c._progress.loaded,this._progress.total-=c._progress.total);b.jqXHR=c.jqXHR=d;b.textStatus=c.textStatus=a;b.errorThrown=
c.errorThrown=e;this._trigger("fail",null,c)},_onAlways:function(d,a,e,c){this._trigger("always",null,c)},_onSend:function(d,a){a.submit||this._addConvenienceMethods(d,a);var e=this,c,b,h,f,l=e._getAJAXSettings(a),k=function(){e._sending+=1;l._bitrateTimer=new e._BitrateTimer;return c=c||((b||e._trigger("send",g.Event("send",{delegatedEvent:d}),l)===!1)&&e._getXHRPromise(!1,l.context,b)||e._chunkedUpload(l)||g.ajax(l)).done(function(b,f,a){e._onDone(b,f,a,l)}).fail(function(b,f,a){e._onFail(b,f,a,
l)}).always(function(b,f,a){e._onAlways(b,f,a,l);e._sending-=1;e._active-=1;if(l.limitConcurrentUploads&&l.limitConcurrentUploads>e._sending)for(b=e._slots.shift();b;){if(e._getDeferredState(b)==="pending"){b.resolve();break}b=e._slots.shift()}e._active===0&&e._trigger("stop")})};this._beforeSend(d,l);return this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(h=g.Deferred(),this._slots.push(h),
f=h.pipe(k)):f=this._sequence=this._sequence.pipe(k,k),f.abort=function(){b=[s,"abort","abort"];return!c?(h&&h.rejectWith(l.context,b),k()):c.abort()},this._enhancePromise(f)):k()},_onAdd:function(d,a){var e=this,c=!0,b=g.extend({},this.options,a),h=a.files,f=h.length,l=b.limitMultiFileUploads,k=b.limitMultiFileUploadSize,i=b.limitMultiFileUploadSizeOverhead,m=0,o=this._getParamName(b),t,p,D=0;if(k&&(!f||h[0].size===s))k=s;if(!b.singleFileUploads&&!l&&!k||!this._isXHRUpload(b))p=[h],t=[o];else if(!b.singleFileUploads&&
!k&&l){p=[];t=[];for(b=0;b<f;b+=l)p.push(h.slice(b,b+l)),m=o.slice(b,b+l),m.length||(m=o),t.push(m)}else if(!b.singleFileUploads&&k){p=[];t=[];for(b=0;b<f;b+=1)if(m+=h[b].size+i,b+1===f||m+h[b+1].size+i>k||l&&b+1-D>=l)p.push(h.slice(D,b+1)),m=o.slice(D,b+1),m.length||(m=o),t.push(m),D=b+1,m=0}else t=o;a.originalFiles=h;g.each(p||h,function(b,f){var h=g.extend({},a);h.files=p?f:[f];h.paramName=t[b];e._initResponseObject(h);e._initProgressObject(h);e._addConvenienceMethods(d,h);return c=e._trigger("add",
g.Event("add",{delegatedEvent:d}),h)});return c},_replaceFileInput:function(d){var a=d.clone(!0);g("<form></form>").append(a)[0].reset();d.after(a).detach();g.cleanData(d.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(e,c){return c===d[0]?a[0]:c});if(d[0]===this.element[0])this.element=a},_handleFileTreeEntry:function(d,a){var e=this,c=g.Deferred(),b=function(b){if(b&&!b.entry)b.entry=d;c.resolve([b])},h,a=a||"";d.isFile?d._file?(d._file.relativePath=a,c.resolve(d._file)):
d.file(function(b){b.relativePath=a;c.resolve(b)},b):d.isDirectory?(h=d.createReader(),h.readEntries(function(f){e._handleFileTreeEntries(f,a+d.name+"/").done(function(b){c.resolve(b)}).fail(b)},b)):c.resolve([]);return c.promise()},_handleFileTreeEntries:function(d,a){var e=this;return g.when.apply(g,g.map(d,function(c){return e._handleFileTreeEntry(c,a)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(d){var d=d||{},a=d.items;return a&&a.length&&
(a[0].webkitGetAsEntry||a[0].getAsEntry)?this._handleFileTreeEntries(g.map(a,function(a){var c;if(a.webkitGetAsEntry){if(c=a.webkitGetAsEntry())c._file=a.getAsFile();return c}return a.getAsEntry()})):g.Deferred().resolve(g.makeArray(d.files)).promise()},_getSingleFileInputFiles:function(d){var d=g(d),a=d.prop("webkitEntries")||d.prop("entries");if(a&&a.length)return this._handleFileTreeEntries(a);a=g.makeArray(d.prop("files"));if(a.length)a[0].name===s&&a[0].fileName&&g.each(a,function(a,c){c.name=
c.fileName;c.size=c.fileSize});else{d=d.prop("value");if(!d)return g.Deferred().resolve([]).promise();a=[{name:d.replace(/^.*\\/,"")}]}return g.Deferred().resolve(a).promise()},_getFileInputFiles:function(d){return!(d instanceof g)||d.length===1?this._getSingleFileInputFiles(d):g.when.apply(g,g.map(d,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(d){var a=this,e={fileInput:g(d.target),form:g(d.target.form)};this._getFileInputFiles(e.fileInput).always(function(c){e.files=
c;a.options.replaceFileInput&&a._replaceFileInput(e.fileInput);a._trigger("change",g.Event("change",{delegatedEvent:d}),e)!==!1&&a._onAdd(d,e)})},_onPaste:function(d){var a=d.originalEvent&&d.originalEvent.clipboardData&&d.originalEvent.clipboardData.items,e={files:[]};a&&a.length&&(g.each(a,function(a,b){var h=b.getAsFile&&b.getAsFile();h&&e.files.push(h)}),this._trigger("paste",g.Event("paste",{delegatedEvent:d}),e)!==!1&&this._onAdd(d,e))},_onDrop:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;
var a=this,e=d.dataTransfer,c={};e&&e.files&&e.files.length&&(d.preventDefault(),this._getDroppedFiles(e).always(function(b){c.files=b;a._trigger("drop",g.Event("drop",{delegatedEvent:d}),c)!==!1&&a._onAdd(d,c)}))},_onDragOver:function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;var a=d.dataTransfer;if(a&&g.inArray("Files",a.types)!==-1&&this._trigger("dragover",g.Event("dragover",{delegatedEvent:d}))!==!1)d.preventDefault(),a.dropEffect="copy"},_initEventHandlers:function(){this._isXHRUpload(this.options)&&
(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));g.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(d,a){var e=g.inArray(d,this._specialOptions)!==-1;e&&this._destroyEventHandlers();this._super(d,a);
e&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var d=this.options;if(d.fileInput===s)d.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]');else if(!(d.fileInput instanceof g))d.fileInput=g(d.fileInput);if(!(d.dropZone instanceof g))d.dropZone=g(d.dropZone);if(!(d.pasteZone instanceof g))d.pasteZone=g(d.pasteZone)},_getRegExp:function(d){var d=d.split("/"),a=d.pop();d.shift();return RegExp(d.join("/"),a)},_isRegExpOption:function(d,
a){return d!=="url"&&g.type(a)==="string"&&/^\/.*\/[igm]{0,3}$/.test(a)},_initDataAttributes:function(){var d=this,a=this.options,e=g(this.element[0].cloneNode(!1));g.each(e.data(),function(c,b){var h="data-"+c.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();e.attr(h)&&(d._isRegExpOption(c,b)&&(b=d._getRegExp(b)),a[c]=b)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);
this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(d){var a=this;if(d&&!this.options.disabled)d.fileInput&&!d.files?this._getFileInputFiles(d.fileInput).always(function(e){d.files=e;a._onAdd(null,d)}):(d.files=g.makeArray(d.files),this._onAdd(null,d))},send:function(d){if(d&&!this.options.disabled){if(d.fileInput&&!d.files){var a=this,e=g.Deferred(),c=e.promise(),b,h;c.abort=function(){h=!0;if(b)return b.abort();e.reject(null,
"abort","abort");return c};this._getFileInputFiles(d.fileInput).always(function(f){if(!h)f.length?(d.files=f,b=a._onSend(null,d).then(function(b,f,a){e.resolve(b,f,a)},function(b,f,a){e.reject(b,f,a)})):e.reject()});return this._enhancePromise(c)}d.files=g.makeArray(d.files);if(d.files.length)return this._onSend(null,d)}return this._getXHRPromise(!1,d&&d.context)}})})})})})(function(){var u=window.AmazonUIPageJS||window.P,y=u._namespace||u.attributeErrors;return y?y("ProductCustomizationFileUploadAssets"):
u}(),window);
(function(u,y,s){u.execute(function(){(function(){u.when("A","ready").register("ac-base",function(n){var j=n.$;n.on("pc-single-text-loaded",function(){j("html").hasClass("a-canvas")||(j(".pc-customization-disabled").addClass("active"),j(".pc-customization-enabled").remove())});return{getASIN:function(){return j("#ASIN").val()},getOfferListingID:function(){return j("#offerListingID").val()},getMerchantID:function(){return j("#merchantID").val()}}});u.when("A","ready").execute(function(n){function j(a){var c="/gp/product/features/log-message.html/ref="+
a.refTag,b;d++;b="ajax_amzon_custom_log"+d;if(y.ue){var h=y.uet;h("tc",b)}g.ajax({type:"POST",url:c,dataType:"json",data:{component:a.component,message:a.msg,isMetricsNeeded:a.isMetricsNeeded},success:function(f){if(y.ue){var a=y.ues,h=y.uet,c=y.uex;a("id",b,f.result.rid);a("t0",b,new Date);a("ctb",b,"1");h("cf",b);h("be",b);c("ld",b)}}})}var g=n.$,d=0,a=function(){var a=g("#ASIN",g(".pc-buy-box")).val();return{CustomizeNowClick:{refTag:"amz_custom_cn_clk_"+a,component:"Amazon Custom customize now button",
msg:"Amazon Custom customize now button clicked",isMetricsNeeded:!1},AddToCartClick:{refTag:"amz_custom_atc_clk_"+a,component:"Amazon Custom Add to cart",msg:"Amazon Custom add to cart clicked",isMetricsNeeded:!1},CloseClick:{refTag:"amz_custom_cls_clk_"+a,component:"Amazon Custom Add to cart",msg:"Amazon Custom close button clicked",isMetricsNeeded:!1},FontChange:{refTag:"amz_custom_font_chg_"+a,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},FontColorChange:{refTag:"amz_custom_color_chg_"+
a,component:"Font drop down list",msg:"Font selected from drop down list",isMetricsNeeded:!1},logCustomImageTabClick:{refTag:"pc_ci_tab_clk",component:"Custom image",msg:"Custom Image click",isMetricsNeeded:!1},logVendorGalleryTabClick:{refTag:"pc_ig_tab_clk",component:"Vendor image gallery",msg:"Vendor image gallery click",isMetricsNeeded:!1},logAddTextTabClick:{refTag:"pc_at_tab_clk",component:"Add Text",msg:"Add Text Click",isMetricsNeeded:!1},logUseThisDesignClick:{refTag:"pc_utdbtn_clk_"+g("#ASIN").val(),
component:"UseThisDesignClick",msg:"Use this design click",isMetricsNeeded:!0},logS3TextUploadError:{refTag:"pc_s3_txt_err",component:"S3TextUploadError",msg:"S3 error on text upload",isMetricsNeeded:!0},logS3ImageUploadError:{refTag:"pc_s3_img_pst_err",component:"S3ImageUploadError",msg:"S3 error on image upload",isMetricsNeeded:!0},logUseThisDesignKindleHucClick:{refTag:"pc_utdgbtn_clk_kin_huc_"+g("#ASIN").val(),component:"UseThisDesignKindleHucClick",msg:"Use this Design From Kindle Click",isMetricsNeeded:!1}}}();
n.on("amazon-custom-popup-open",function(){this.popupOpenTime=new Date});n.on("amazon-custom-popup-close",function(a){a-=this.popupOpenTime;a/=1E3;y.ue.count("pcSingleTextTimer",a);y.ue.count("pcSingleTextTimer")});n.on("logVendor-ref-Click",function(a){a={refTag:"pc_vi_"+a.categoryName.substring(0,4)+"_"+g("#ASIN").val(),component:"theme for selected vendor image",msg:"Theme selected for vendor image is "+a.categoryName,isMetricsNeeded:!1};j(a)});n.on("amazon-custom-log-ref-tag",function(e){e!==
s&&(e=a[e],e!==s&&j(e))})})})();(function(){u.when("A","fabric-js","ac-base","ac-utils","ac-constants","ac-simple-textInput","ac-gallery","ac-image-gallery","ac-text-image","ac-error-handling","ready").register("ac-canvas",function(n,j,g,d,a,e,c,b,h,f){var l=n.$;return function(a,c){var m=this;m.isActive=!1;m.surface=c;m.childCanvas=[];m.canvas=a;m.isChild=m.canvas.isChild?m.canvas.isChild:!1;m.controls={};m.canvasObjects=[];m.name="";m.canvas.index!==s?(m.id=m.surface.id+"-area-"+m.canvas.index,
m.data=c.data.areas[m.canvas.index],m.name=m.data.name):(m.id=m.surface.id+"-primary",m.isChild=!1);m.currentSelectedObject=null;m.enableBuyBox=!1;m.renderAll=function(b){b=b?b:1;m.isChild?(m.canvas.renderAll(),setTimeout(function(){d.debounce(m.surface.updatePrimaryCanvas(m.canvas.index),25)},b)):m.canvas.renderAll()};m.getObjects=function(){return m.canvas.getObjects()};m.toDataURL=function(){try{m.canvas.toDataURL()}catch(b){return null}};m.verifyScaling=function(){m.canvas.off("object:modified");
m.canvas.on("object:modified",function(b){b=b.target;m.renderAll();b.type!=="text"&&(b.scaleX>1.5||b.scaleY>1.5?f.show("pc-scale-warning-message"):(b.scaleX<1.5||b.scaleY<1.5)&&f.hide(),m.canvas.calcOffset());m.dragResetObject()})};m.dragResetObject=function(){var b=parseInt(m.canvas.width,10),a=parseInt(m.canvas.height,10),h=new j.Rect({left:0,top:0,width:b,height:a,opacity:0}),c=new j.Point(0,0),e=new j.Point(0+b,0+a);m.canvas.add(h);c=m.canvas.getActiveObject().intersectsWithObject(h)||m.canvas.getActiveObject().isContainedWithinRect(c,
e);m.canvas.remove(h);c||(m.canvas.getActiveObject().set({left:0+(b/2-m.canvas.getActiveObject().width/2),top:0+(a/2-m.canvas.getActiveObject().height/2),scaleX:1,scaleY:1,angle:0}),f.hide(),m.canvas.getActiveObject().setCoords(),m.canvas.calcOffset(),m.renderAll(50))};m.clear=function(){m.canvas.clear();for(var b in m.controls)if(m.controls.hasOwnProperty(b)&&m.controls[b].cleared)m.controls[b].cleared(),m.controls[b].isControlActive=!1;m.renderAll()};m.childCanvas=[];m.addGalleryImage=function(b){var f;
f=m.getObjects();d.imageLoading.show();for(var a=m.canvas.size()-1;a>=0;a--)(f[a].name&&f[a].name==="galImage"||f[a].name&&f[a].name==="cusImage"||f[a].type==="text")&&m.canvas.remove(f[a]);if(m.controls.textInput&&m.controls.textInput.imgText)m.controls.textInput.imgText.resetControl(),m.controls.textInput.isControlActive=!1;l("#pcTextArea").val("");l(".ac-upload-tnC").fadeOut();j.Image.fromURL(b.imageUrl,function(f){m.canvas.add(f);f.name="galImage";d.imageLoading.hide();m.renderAll();f.vendorGalleryFileId=
b.vendorGalleryFileId;f.vendorGalleryId=b.vendorGalleryId;f.originalURL=b.originalURL;l(".pc-two-column-layout .ac-delete-button").fadeIn()},{height:m.canvas.height,width:m.canvas.width,selectable:!1,crossOrigin:"anonymous"})};m.addCustomerImage=function(f){var a,h;a=m.getObjects();for(var c=m.canvas.size()-1;c>=0;c--)m.canvas.deactivateAll(),(a[c].name&&a[c].name==="galImage"||a[c].name&&a[c].name==="cusImage")&&m.canvas.remove(a[c]);h=function(b){b.height>=b.width&&b.height>=m.canvas.height?(b.width*=
m.canvas.height/b.height,b.height=m.canvas.height,b.width>m.canvas.width?(b.width=m.canvas.width,b.height*=m.canvas.width/b.width,b.left=0,b.top=0):(b.top=0,b.left=(m.canvas.width-b.width)/2)):b.width>=b.height&&b.width>=m.canvas.width?(b.height*=m.canvas.width/b.width,b.width=m.canvas.width,b.height>m.canvas.height?(b.width*=m.canvas.height/b.height,b.height=m.canvas.height,b.left=(m.canvas.width-b.width)/2,b.top=0):(b.left=0,b.top=(m.canvas.height-b.height)/2)):(b.left=(m.canvas.width-b.width)/
2,b.top=(m.canvas.height-b.height)/2);m.canvas.calcOffset();b.setCoords();m.renderAll()};f=b.prototype.scaleImage(f);j.Image.fromURL(f,function(b){m.canvas.add(b);h(b);d.imageLoading.hide();b.name="cusImage";b.sendToBack();m.canvas.setActiveObject(b);m.renderAll()},{crossOrigin:"anonymous",transparentCorners:!1,borderColor:"white",centeredScaling:!0,lockUniScaling:!0});l(".ac-upload-tnC").fadeIn()};m.setActiveControl=function(b){for(var f in m.controls)if(m.controls.hasOwnProperty(f)&&m.controls[f])m.controls[f].isControlActive=
!1;m.controls[b].isControlActive=!0};m.resetControls=function(){var b=!1,f;f=function(){l(".ac-btn-makeOwn.ac-imageUpload").trigger("click")};for(var a in m.controls)if(m.controls.hasOwnProperty(a)&&m.controls[a].isControlActive)switch(a){case "textInput":l(".ac-btn-makeOwn.ac-textInput").trigger("click");b=!0;break;case "imageUpload":l(".ac-btn-makeOwn.ac-imageUpload").trigger("click"),b=!0}b||f()};m.activate=function(){};m.bindEvents={commonEvent:function(){m.canvas.off("canvas:cleared");m.canvas.on("canvas:cleared",
function(){for(var b=0;b<=m.controls.length;b++)m.controls[b].cleared&&m.controls[b].cleared()});m.canvas.off("object:modified");m.canvas.on("object:modified",function(b){b=b.target;m.controls.textInput?(b.type!=="text"&&((b.scaleX>1.5||b.scaleY>1.5)&&f.show("pc-scale-warning-message"),(b.scaleX<1.5||b.scaleY<1.5)&&f.hide(),m.canvas.calcOffset()),m.dragResetObject(),m.renderAll()):m.controls.imageUpload&&(m.dragResetObject(),m.renderAll())})},imageUpload:function(){m.controls.imageUpload.cleared=
function(){f.hide();l(".ac-upload-tnC").fadeOut()}},imageAndText:function(){m.controls.textInput={};m.canvas.off("object:selected");m.canvas.on("object:selected",function(b){if(b.target)b.target.type==="text"?(m.currentSelectedObject="text",b.target.text!==""&&l(".pc-two-column-layout .ac-delete-button").fadeIn(),n.trigger("slideUpTextArea")):(m.currentSelectedObject="other",n.trigger("slideDownTextArea"),l(".pc-two-column-layout .ac-delete-button").fadeIn())});m.canvas.off("selection:cleared");m.canvas.on("selection:cleared",
function(){if(m.currentSelectedObject==="text")m.currentSelectedObject="other",n.trigger("slideDownTextArea");l(".pc-two-column-layout .ac-delete-button").fadeOut()});m.controls.textInput.cleared=function(){var b=m.getObjects();l("#pcTextArea").val("");m.controls.textInput.imgText.cleared();for(var f=0;f<b.length;f++)b[f].type==="text"&&b[f].remove();n.trigger("slideDownTextArea")}}};m.bindControls=function(){var b=l(".ac-area-control."+m.id+", .ac-area-control.ac-widget-control"),f;l.each(b,function(b,
a){f=l(a).attr("data-control-template");switch(f){case "simple-textInput":var c=new e(a,m,{});m.controls.simpleTextInput=c;break;case "imageUpload":if(m.surface.customizationType==="ImagePrinting")m.verifyScaling(),m.controls.imageUpload={isControlActive:!0},m.bindEvents.imageUpload();break;case "textInput":if(m.surface.customizationType==="ImagePrinting"&&m.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported)m.bindEvents.imageAndText(),m.controls.textInput.imgText=new h(m,{})}})};
m.controlRenderingHandle=function(){var b,f,a;if(m.surface.customizationType==="ImagePrinting"){var h,c,e,d,i=!1;b=!1;f=!1;a=!1;l(".ac-imageUpload-control");h=l(".ac-btn-makeOwn.ac-imageUpload");l(".ac-textInput-control");c=l(".ac-btn-makeOwn.ac-textInput");e=l('.a-tab-heading[data-a-tab-name="gallery"]');d=l('.a-tab-heading[data-a-tab-name="makeOwn"]');m.data.customizationTypeSettings.ImagePrinting&&(m.data.customizationTypeSettings.ImagePrinting.isGallerySupported&&m.data.customizationTypeSettings.ImagePrinting.galleries&&
m.data.customizationTypeSettings.ImagePrinting.galleries.length&&(b=!0),m.data.customizationTypeSettings.ImagePrinting.isCustomerUploadSupported&&(f=!0),m.data.customizationTypeSettings.ImagePrinting.isCustomTextSupported&&(a=!0));e.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");h.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden");
d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item");b?e.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-list-item"):d.trigger("click");f?h.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"):(l(".ac-imageUpload-control").removeClass("active"),l(".ac-btn-makeOwn.ac-imageUpload").removeClass("active"));
a&&(c.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-inline"),f||(m.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=b.getObjects(),f=0;f<b.length;f++)b[f].name&&b[f].name==="galImage"&&(i=!0)})}),i||setTimeout(function(){c.trigger("click")},50)));!f&&!a&&(d.removeClass("amz-custom-hidden amz-custom-visible amz-custom-inline amz-custom-list-item").addClass("amz-custom-hidden"),e.trigger("click"))}};
m.fulfillmentJSON=function(){var b={},f=m.getObjects(),a,h;m.canvas.deactivateAll();h=function(){var b,f;f={};for(f=0;f<m.surface.data.FontSettings.colors.length;f++)if(m.surface.data.FontSettings.colors[f].value===m.surface.color){b=m.surface.data.FontSettings.colors[f].name;break}f=m.data.customizationTypeSettings.TextPrinting.placeHolderText;f={fontFamily:m.surface.fontName,text:m.controls.simpleTextInput.inputBox.val(),fill:m.surface.color,customizationType:"TextPrinting",label:f?f:""};if(b)f.colorName=
b;return f};b.name=m.name;b.Position=m.data.specifications.position;b.Dimensions=m.data.specifications.dimension;if(m.surface.customizationType==="ImagePrinting"){for(h=0;h<f.length;h++)if(f[h].name&&f[h].name==="galImage"){var c=f[h].originalURL;a="VendorGallery";b.vendorGalleryImagePath=c;b.vendorGalleryFileId=f[h].vendorGalleryFileId;b.vendorGalleryId=f[h].vendorGalleryId;b.customizationType="ImagePrinting"}else f[h].type==="text"&&!f[h].text.replace(" ","").length&&f[h].remove();if(!a&&f.length)a=
"SVG",b.canvas=m.canvas,b.customizationType="ImagePrinting"}else a="JSON",b=l.extend(b,h());if(l("#amazonCustomUseCaseId").val()==="AC_ImgTxtPersonalization_3")b.id=m.id;b.fulfillmentType=a;return b};m.init=function(){m.isChild&&(m.bindControls(),m.controlRenderingHandle())}}})})();(function(){u.when("A","ac-base","fabric-js","ac-utils","ac-canvas","ac-color-picker","ac-font-picker","ac-constants","ready").register("ac-surface",function(n,j,g,d,a,e,c,b){var h=n.$;return function(f,l,k){var i={},m,
o,t,p,D,E;i.isActive=!1;i.name="";i.productImageUrl="";i.maskImageUrl="";i.primaryCanvas=null;i.thumbnail=null;i.childCanvasList=[];i.controls={};i.font=j.getMerchantID()+"-Arial";i.customizationType=f.areas[0].customizationType;i.data=f;i.widget=l;E=h("html.a-ie9").length||n.capabilities.isIE10;i.miniThumbnailCanvas=[];m=function(b){b=new a(b,i);b.init();return b};o=function(b,f){var a,c,e,l,d,k;if(f.isChild)return null;c=b.specifications.position.y;e=b.specifications.position.x;l=b.specifications.dimension.height;
d=b.specifications.dimension.width;k=b.specifications.angle?b.specifications.angle:0;a=document.createElement("canvas");a.id=i.id+"-area-"+b.index;a.className+="canvasArea";a.setAttribute("data-left",e);a.setAttribute("data-top",c);a.setAttribute("data-angle",k);a.height=l+5;a.width=d;h('.ac-preview-container[data-surface="'+i.id+'"]').append(a);a.getContext("2d");l=new g.Canvas(a.id);k="rotate("+k+"deg)";h(a).parent(".canvas-container").css({position:"absolute",top:c+"px",left:e+"px","-ms-transform":k,
"-webkit-transform":k,transform:k});l.isChild=!0;l.parent=f;l.index=b.index;return l};t=function(b){var a=new Image;a.crossOrigin="anonymous";a.src=f.preview.url;a.onload=function(){b.canvas.setBackgroundImage(new g.Image(a,{originX:"left",originY:"top",left:0,top:0}),function(){b.renderAll.bind(b.canvas);d.debounce(i.updateThumbnail(),50)})};if(f.mask&&f.mask.url){var c=new Image;c.crossOrigin="anonymous";c.src=f.mask.url;c.style.top="-"+f.areas[0].specifications.position.y+"px";c.style.left="-"+
f.areas[0].specifications.position.x+"px";c.onload=function(){if(h("#ac-enable-active-controls").length!==0&&h("#ac-enable-active-controls").val()==="true"){var a,e=f.areas[0].specifications.position.y===0?0:-1*f.areas[0].specifications.position.y,l=f.areas[0].specifications.position.x===0?0:-1*f.areas[0].specifications.position.x;b.childCanvas&&b.childCanvas.length===1&&(a=b.childCanvas[0],a.canvas.setOverlayImage(new g.Image(c,{originY:"top",originX:"left",left:l,top:e})));h("#"+i.id+"-area-0").before(c).parent(".canvas-container").css({width:"400px",
height:"400px"});a.canvas.controlsAboveOverlay=!0;a.canvas.renderAll();b.canvas.renderAll()}else b.canvas.setOverlayImage(new g.Image(c,{originY:"top",originX:"left",left:0,top:0}),function(){b.renderAll.bind(b.canvas);d.debounce(i.updateThumbnail(),25)}),h("#"+i.id+"-area-0").after(c).parent(".canvas-container").css({height:"400px",width:"400px"})}}};p=function(b){for(var a,h=0;h<f.areas.length;h++)a=f.areas[h],a.index=h,a=m(o(a,b)),h===0&&i.setActiveArea(a),b.childCanvas.push(a);t(b);return b.childCanvas};
D=function(){var b,f=i.data.areas[0].customizationTypeSettings.ImagePrinting.galleries,a,c=!1,e,l;h("#ac-gallery.vendor-categories > .vendor-category").css({display:"none"});if(i.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery)a=i.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery;for(var d=0;d<f.length;d++)if(b="",b=f[d].charAt(0)==="/"?f[d].substr(1,f[d].length):f[d])e=h('#ac-gallery.vendor-categories > .vendor-category > a[data-themename="'+b+'"]'),l=h('#ac-gallery.vendor-categories > .vendor-category > a[data-categoryid="'+
b+'"]'),e.length?(e.parent(".vendor-category").css({display:"block"}),a&&a.substr(1,a.length)===b&&(e.trigger("click"),c=!0)):l.length&&(l.parent(".vendor-category").css({display:"block"}),a&&a.substr(1,a.length)===b&&(l.trigger("click"),c=!0));c||h("#ac-gallery.vendor-categories > .vendor-category > a").each(function(b,f){h(f).parent(".vendor-category").css("display")==="block"&&h(f).trigger("click")})};i.setActiveArea=function(b){for(var f=0;f<i.childCanvasList.length;f++)i.childCanvasList[f].isActive=
!1;b.isActive=!0;return b};i.getActiveArea=function(){var b,f;for(b=0;b<i.childCanvasList.length;b++)i.childCanvasList[b].isActive===!0&&(f=i.childCanvasList[b]);return f};i.enableBuyBox=function(){for(var b=!1,f=0;f<i.childCanvasList.length;f++)if(i.childCanvasList[f].enableBuyBox===!0){b=!0;break}return b};i.setPrimaryCanvas=function(){var b;b=m(new g.Canvas("ac-preview-canvas-"+i.id));b.isChild=!1;return b};i.updatePrimaryCanvas=function(b){var f,a,c,e,k=!1;f=function(){var f={};f.height=i.primaryCanvas.childCanvas[b].canvas.height;
f.width=i.primaryCanvas.childCanvas[b].canvas.width;f.top=h("canvas#"+i.id+"-area-"+b).data("top");f.left=h("canvas#"+i.id+"-area-"+b).data("left");f.angle=h("canvas#"+i.id+"-area-"+b).data("angle");return f};if(i.primaryCanvas.childCanvas[b]){var m=i.primaryCanvas.childCanvas[b].getObjects(),o;e=i.primaryCanvas.getObjects();for(var p=i.primaryCanvas.canvas.size()-1;p>=0;p--)e[p].areaId!==s&&e[p].areaId===b&&i.primaryCanvas.canvas.remove(e[p]);if(m.length)if(m.length===1&&m[0].type==="text"&&(m[0].text===
""||m[0].text===" "))i.primaryCanvas.childCanvas[b].canvas.deactivateAll();else{k=!0;for(p=i.primaryCanvas.childCanvas[b].canvas.size()-1;p>=0;p--)m[p].active&&(o=m[p]);c=f();var t=function(b){var f={},a=!1,f={left:-b.width/2,top:-b.height/2,width:b.width,height:b.height};if(b.left<0){if(a=!0,f.left=-b.width/2-b.left,b.width+b.left>c.width)f.width=c.width}else if(b.width+b.left>c.width)a=!0,f.left=-b.width/2-(b.width+b.left-c.width);if(b.top<0){if(a=!0,f.top=-b.height/2-b.top,b.height+b.top>c.height)f.height=
c.height}else if(b.height+b.top>c.height)a=!0,f.top=-b.height/2-(b.height+b.top-c.height);f.clipNeeded=a;return f};f=function(){i.primaryCanvas.canvas.forEachObject(function(f){f.areaId===b&&f.remove()});E?i.primaryCanvas.childCanvas[b].canvas.forEachObject(function(f){var h=g.util.object.clone(f);if(!E&&h.type==="group")for(var e=h.getObjects(),l=0;l<e.length;l++)e[l].text&&(f=g.util.object.clone(e[l]),f.top+=h.top,f.top+=h.top,h=f);i.primaryCanvas.canvas.calcOffset();i.primaryCanvas.canvas.add(h);
if(h.type==="image"){h.sendToBack();try{var k={},m,o,p,D;m=h.getBoundingRect();k=t(m);o=new g.Rect({left:c.left,top:c.top,height:c.height,width:c.width,selectable:!1,fill:"none",strokeWidth:0,opacity:0});i.primaryCanvas.canvas.add(o);p=function(b){return b*(Math.PI/180)};D=function(b,f){f.setCoords();b.save();b.translate(-(f.width/2)+o.strokeWidth,-(f.height/2)+o.strokeWidth);b.rotate(p(f.angle*-1));b.scale(1,1);b.beginPath();b.rect(o.left-f.oCoords.tl.x,o.top-f.oCoords.tl.y,o.width,o.height);b.closePath();
b.restore()};h.clipTo=function(b){return D(b,h)}}catch(q){}}h.type==="text"?h.text.replace(/\s/g,"")===""?i.primaryCanvas.canvas.remove(h):(k={},m=h.getBoundingRect(),k=t(m),k.clipNeeded?(a=h.toDataURL(),g.Image.fromURL(a,function(f){f.set({top:m.top+c.top,left:m.left+c.left,selectable:!1,areaId:b});i.primaryCanvas.canvas.remove(h);h=f;i.primaryCanvas.canvas.add(f);f.clipTo=function(b){b.rect(k.left,k.top,k.width,k.height)};i.primaryCanvas.canvas.renderAll();d.debounce(i.updateThumbnail(),50)})):
(h.left+=c.left,h.top+=c.top,h.areaId=b)):(h.left+=c.left,h.top+=c.top,h.areaId=b);h.setCoords()}):(a=i.primaryCanvas.childCanvas[b].canvas.toDataURL("png"),g.Image.fromURL(a,function(f){f.set({height:c.height,width:c.width,top:c.top,left:c.left,selectable:!1});f.areaId=b;i.primaryCanvas.canvas.add(f);i.primaryCanvas.canvas.renderAll();d.debounce(i.updateThumbnail(),50)}));i.primaryCanvas.canvas.renderAll()};o?(i.primaryCanvas.childCanvas[b].canvas.deactivateAll(),f(),i.primaryCanvas.childCanvas[b].canvas.setActiveObject(o)):
f()}d.debounce(i.updateThumbnail(),50);i.primaryCanvas.childCanvas[b].enableBuyBox=!1;if(k)i.primaryCanvas.childCanvas[b].enableBuyBox=!0;l.buybox.verify()}};i.updateThumbnail=function(){if(!i.widget.showThumbnail)return null;try{if(i.customizationType==="TextPrinting"&&!E){var f=i.primaryCanvas.canvas.toDataURL("png");h(".thumbnail-container").find('.thumbnail-image[ac-target="'+i.id+'"]').html("<img src='"+f+"' class='thumbnail-image "+i.id+"' />")}else{var a,c,e,l,d;a=b.defaults.thumbnailHeight/
b.defaults.galHeight;d=h(".thumbnail-container").find('.thumbnail-image[ac-target="'+i.id+'"]');if(!d.find(".ieThumbnail-bg").length)c=h("<img />",{"class":"ieThumbnail-bg",src:i.data.preview.url,alt:"Thumbnail Image",height:b.defaults.thumbnailHeight+"px",width:b.defaults.thumbnailWidth="px"});d.html(c);e=function(b,f){var c,e,l,d,m,o;e=b.position.y*a;l=b.position.x*a;d=b.dimension.height*a;m=b.dimension.width*a;o=b.angle?k.specifications.angle:0;c=document.createElement("canvas");c.id="thumbnail-"+
i.id+"-area-"+f;c.className+="thumbnail-canvasArea";c.height=d;c.width=m;h(".thumbnail-container").find('.thumbnail-image[ac-target="'+i.id+'"]').append(c);c.getContext("2d");d=new g.Canvas(c.id);o="rotate("+o+"deg)";h(c).parent(".canvas-container").css({position:"absolute",top:e+"px",left:l+"px","-ms-transform":o,"-webkit-transform":o,transform:o});return d};for(f=0;f<i.childCanvasList.length;f++)h("#thumbnail-"+i.id+"-area-"+f).length?(l=i.miniThumbnailCanvas[f],l.clear()):(l=e(i.childCanvasList[f].data.specifications,
f),i.miniThumbnailCanvas[f]=l),i.customizationType==="ImagePrinting"?i.childCanvasList[f].canvas.forEachObject(function(b){var f=g.util.object.clone(b);l.calcOffset();l.add(f);f.top=b.top*a;f.left=b.left*a;f.scaleX*=a;f.scaleY*=a;f.selectable=!1;l.deactivateAll();f.type!=="text"&&f.sendToBack();f.setCoords();l.renderAll()}):i.customizationType==="TextPrinting"&&function(b,f){g.Image.fromURL(b,function(b){f.add(b);b.scaleX=a;b.scaleY=a;b.selectable=!1;f.renderAll()})}(i.childCanvasList[f].canvas.toDataURL("png"),
l);if(i.data.mask&&i.data.mask.url&&!d.find(".ieThumbnail-mask").length){var m=h("<img />",{"class":"ieThumbnail-mask",src:i.data.mask.url,alt:"Thumbnail Mask Image"});h(m).load(function(){var b,f;b=this.naturalHeight;f=this.naturalWidth;h(this).height(b*a).width(f*a)});d.find(".canvas-container").after(m)}}}catch(o){return console.log(o),null}};i.activateSurface=function(){l.setActiveSurface(i.id);i.customizationType==="ImagePrinting"&&(i.getActiveArea().resetControls(),i.getActiveArea().controlRenderingHandle());
i.customizationType==="TextPrinting"&&h("#ac-simple-text-font-picker",h("div[data-surface='"+i.id+"']")).val(i.font)};i.bindEvents=function(){h(".thumbnail-container .ac-thumbnail.surface-0").addClass("active");h(".thumbnail-container").delegate('[ac-target="'+i.id+'"]',"click",function(){if(h('.ac-preview-container[data-surface="'+i.id+'"]').css("display").toLowerCase()==="block")return null;h(".ac-thumbnail").removeClass("active");h(".ac-thumbnail."+i.id).addClass("active");h(".ac-preview-container").css("display",
"none").parent().find('[data-surface="'+i.id+'"]').css("display","block");i.customizationType==="ImagePrinting"?(h(".ac-controls-container").css("display","none").parent().find(".ac-controls-container.ac-image-text-control").css("display","block"),i.data.areas[0].customizationTypeSettings.ImagePrinting.galleries&&D(),h(".ac-single-text-preview-guideline").css({display:"none"})):(h(".ac-controls-container").css("display","none").parent().find('[data-surface="'+i.id+'"]').css("display","block"),h(".pc-two-column-layout .ac-delete-button").fadeOut(),
h(".ac-single-text-preview-guideline").css({display:"block"}));i.activateSurface()});return D};i.notifySubscribers=function(b,f){switch(b){case "colorpicker":i.color=f;for(var a=0;a<i.childCanvasList.length;a++)i.childCanvasList[a].controls.simpleTextInput&&(i.childCanvasList[a].controls.simpleTextInput.changePreview(),n.trigger("amazon-custom-log-ref-tag","FontColorChange"));break;case "fontpicker":i.font=f;for(a=0;a<i.childCanvasList.length;a++)i.childCanvasList[a].controls.simpleTextInput&&(i.childCanvasList[a].controls.simpleTextInput.changePreview(),
n.trigger("amazon-custom-log-ref-tag","FontChange"))}};i.bindControls=function(){var b=h(".ac-surface-control."+i.id),f;h.each(b,function(b,a){f=h(a).attr("data-control-template");switch(f){case "colorpicker":var l=new e(a,i);i.controls.colorPicker=l;break;case "fontpicker":l=new c(a,i),i.controls.fontPicker=l}})};i.initiateEvents=function(){};i.fulfillmentJSON=function(){var b={},a=[];b.name=i.name;if(h("#amazonCustomUseCaseId").length&&h("#amazonCustomUseCaseId").val()==="AC_ImgTxtPersonalization_3"){b.images=
{};if(f.preview&&f.preview.url)b.images.previewUrl=f.preview.url;if(f.mask&&f.mask.url)b.images.maskUrl=f.mask.url;if(i.customizationType==="TextPrinting"){b.font={};if(i.font.substring(0,3)==="ac_"){b.font.isDefault=0;var c=i.data.FontSettings.fonts.filter(function(b){if(b.name===i.fontName)return!0});if(c.length===1)b.font.fontUrl=c[0].fontURL}else b.font.isDefault=1;b.font.fontName=i.fontName}b.id=i.id}for(c=0;c<i.childCanvasList.length;c++)a.push(i.childCanvasList[c].fulfillmentJSON());b.areas=
a;return b};i.init=function(){i.name=f.name;i.isActive=f.isActive;i.id="surface-"+f.index;i.productImageUrl=f.preview.productImageUrl;i.maskImageUrl=f.preview.maskImageUrl;i.primaryCanvas=i.setPrimaryCanvas();i.childCanvasList=p(i.primaryCanvas);i.bindEvents();i.bindControls();i.initiateEvents()};i.init();return i}})})();(function(){u.when("A","ready").register("ac-utils",function(n){var j=n.$,g,d,a,e;g={};d=function(a){var b=null;try{b=n.state(a)?n.state(a):null}catch(h){b=null}finally{return b}};
e=function(){for(var a=j(".pc-customization-enabled script"),b=0,h=a.length;b<h;b++)if(!j.data(a[b],"a-eval")){var f=j(a[b]),e=f.attr("data-a-state");e&&(e=n.parseJSON(e),e.key&&(f=n.parseJSON(f.html()),n.state.replace(e.key,f)))}return!0};g.init=function(){e();a=d("wssStringArray")};g.getState=function(c,b){if(b){var h=!1,h=e();if(!h)return}a||(a=d("wssStringArray"));return d(c)};g.validator=function(){var a={AlphaNumeric:function(){return!0},Digits:function(b){return/^[\s\d]*$/.test(b)}};return{Validate:function(b,
h){return a[h]!==s&&typeof a[h]==="function"?a[h](b):!0}}};g.debounce=function(a,b,h){var f;return function(){var e=this,d=arguments,i=h&&!f;clearTimeout(f);f=setTimeout(function(){f=null;h||a.apply(e,d)},b);i&&a.apply(e,d)}};g.showDialog={show:function(a,b,h){h&&h.ok&&j(".ac-btn.ac-btn-dialog-ok").text(h.ok);h&&h.cancel&&j(".ac-btn.ac-btn-dialog-cancel").text(h.cancel);a&&j("#ac-dialog-confirm p").html(a);j("#ac-dialog-confirm").fadeIn();j(".ac-image-backdrop").fadeIn();j("#ac-dialog-confirm").undelegate(".ac-btn-dialog-ok",
"click");j("#ac-dialog-confirm").delegate(".ac-btn-dialog-ok","click",function(){j("#ac-dialog-confirm").fadeOut();j(".ac-image-backdrop").fadeOut();b()});j("#ac-dialog-confirm").undelegate(".ac-btn-dialog-cancel","click");j("#ac-dialog-confirm").delegate(".ac-btn-dialog-cancel","click",function(){j("#ac-dialog-confirm").fadeOut();j(".ac-image-backdrop").fadeOut();h&&h.cancelCallBack&&h.cancelCallBack();g.imageLoading.hide()})}};g.imageLoading={show:function(){j(".ac-image-loader").fadeIn();j(".ac-image-backdrop").fadeIn()},
hide:function(){j(".ac-image-loader").fadeOut();j(".ac-image-backdrop").fadeOut()}};g.arrFilterUnique=function(a){return a.filter(function(b,a,f){return f.indexOf(b)===a})};g.stringHandler=function(c){return a&&a[c]?a[c]:""};return g})})();(function(){u.when("A","fabric-js","ac-base","BuyBox","ac-constants","ac-surface","ac-utils","ac-gallery","ac-image-gallery","ready").register("ac-widget",function(n,j,g,d,a,e,c,b){var h=n.$;return function(){var f=this,l,k;f.surfaceList=[];f.data={};f.showThumbnail=
!0;f.acTempCanvas=new j.Canvas("acTempCanvas");k=function(){h(".pc-two-column-layout").delegate(".ac-delete-button","click",function(){var b=f.getActiveArea();b.canvas.forEachObject(function(f){var a;if(f&&f.active||f&&f.name&&f.name==="galImage"){if(f.type&&f.type==="text")a=b.controls.textInput.cleared;if(f.name&&f.name==="cusImage")a=b.controls.imageUpload.cleared;a&&a();b.canvas.remove(f)}});b.canvas.discardActiveGroup();h(".pc-two-column-layout .ac-delete-button").fadeOut();b.renderAll()})};
f.getActiveSurface=function(){for(var b=null,a=0;a<f.surfaceList.length;a++)f.surfaceList[a].isActive===!0&&(b=f.surfaceList[a]);return b};f.setActiveSurface=function(b){for(var a=0;a<f.surfaceList.length;a++)if(f.surfaceList[a].isActive=!1,f.surfaceList[a].id===b)f.surfaceList[a].isActive=!0};f.getActiveArea=function(){return f.getActiveSurface().getActiveArea()};f.fulfillmentJSON=function(){var b={},c=[],e=[],l,d;d=f.acTempCanvas;d.setDimensions(a.outputSVGDimention);l=function(b){var f=a.scaleRatio,
c,e,l,k;l=parseInt(h(b.lowerCanvasEl).parent(b.wrapperEl).css("top").replace("px",""),10);k=parseInt(h(b.lowerCanvasEl).parent(b.wrapperEl).css("left").replace("px",""),10);d.clear();b.forEachObject(function(b){b=j.util.object.clone(b);d.calcOffset();d.add(b);b.type==="image"&&(b.sendToBack(),c=b.getSrc());b.type==="text"&&b.text.replace(/\s/g,"")===""&&d.remove(b);b.top+=l;b.left+=k;b.scaleX*=f;b.scaleY*=f;b.left*=f;b.top*=f;b.setCoords()});d.renderAll();c&&c.indexOf("._")!==-1&&c.indexOf("._")!==
-1?(e=c.split("._")[0]+"."+c.split("_.")[1],b=h("#ac-enable-utf8-data").length!==0&&h("#ac-enable-utf8-data").val()==="true"?d.toSVG(null,function(b){var f=b.replace(RegExp(/xlink:href=\"\S*\"/),'xlink:href="'+e+'"');h(b).find("tspan").length>=1&&h(b).find("tspan").each(function(b,a){var c=h(a).html();f=f.replace(c,"<![CDATA["+c+"]]\>")});return f}):d.toSVG(null,function(b){return b.replace(RegExp(/xlink:href=\"\S*\"/),'xlink:href="'+e+'"')})):b=h("#ac-enable-utf8-data").length!==0&&h("#ac-enable-utf8-data").val()===
"true"?d.toSVG(null,function(b){var f=b;h(b).find("tspan").length>=1&&h(b).find("tspan").each(function(b,a){var c=h(a).html();f=f.replace(c,"<![CDATA["+c+"]]\>")});return f}):d.toSVG();return b};b.customizationInfo={fulfillmentDetails:f.data.fulfillmentDetails,"version3.0":{surfaces:[]}};b.merchantId=g.getMerchantID();for(var k=0;k<f.surfaceList.length;k++)c.push(f.surfaceList[k].fulfillmentJSON());for(k=0;k<c.length;k++)for(var E=0;E<c[k].areas.length;E++)c[k].areas[E].fulfillmentType==="SVG"?(c[k].areas[E].svgImage=
l(c[k].areas[E].canvas),delete c[k].areas[E].canvas):c[k].areas[E].fulfillmentType||c[k].areas.splice(E,1);for(k=0;k<c.length;k++)c[k].areas.length&&e.push(c[k]);b.customizationInfo["version3.0"].surfaces=e;return b};f.bindControls={galleryImage:function(){n.on("addGalleryImage",function(b){var a,h,e,l=!1;a=f.getActiveSurface();n.trigger("amazon-custom-log-ref-tag","logVendorGalleryTabClick");h=a.getActiveArea();if(h.getObjects().length===1&&h.getObjects()[0].name==="galImage"&&h.getObjects()[0].getSrc()===
b.imageUrl)return null;a=c.stringHandler("pc-clear-custom-msg");e=function(){f.surfaceList.forEach(function(f){f.childCanvasList.forEach(function(f){for(var a=f.getObjects(),h=!1,c=0;c<a.length;c++)a[c].name&&a[c].name==="galImage"&&a[c].getSrc()===b.imageUrl&&(h=!0);h||f.clear()})});h.addGalleryImage(b)};for(var d=0;d<f.surfaceList.length;d++){for(var k=0;k<f.surfaceList[d].childCanvasList.length;k++){var g,F=f.surfaceList[d].childCanvasList[k];g=F.getObjects();for(var j=F.canvas.size()-1;j>=0;j--)if(g[j].type===
"text"&&!g[j].text.replace(" ","").length)g[j].remove(),F.controls.textInput.isControlActive=!1;else if(g[j].name&&g[j].name==="cusImage"||g[j].type==="text"){l=!0;break}if(l)break}if(l)break}l?c.showDialog.show(a,e,{ok:"Clear"}):e()})},uploadImage:function(){n.off("addCustomerImage");n.on("addCustomerImage",function(b){var a,h,e,l=!1;a=f.getActiveSurface().getActiveArea();a.getObjects();h=c.stringHandler("pc-clear-design-msg");e=function(){f.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var f=
b.getObjects(),a=0;a<f.length;a++)f[a].name&&f[a].name==="galImage"&&b.clear()})});a.addCustomerImage(b)};f.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=b.getObjects(),f=0;f<b.length;f++)if(b[f].name&&b[f].name==="galImage"){l=!0;break}})});l?c.showDialog.show(h,e,{ok:"Clear"}):e()});h(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-imageUpload","click",function(){h(".ac-imageUpload-control").addClass("active");h(".ac-btn-makeOwn.ac-imageUpload").addClass("active");
h(".ac-textInput-control").removeClass("active");h(".ac-btn-makeOwn.ac-textInput").removeClass("active");f.getActiveSurface().getActiveArea().setActiveControl("imageUpload");n.trigger("amazon-custom-log-ref-tag","logCustomImageTabClick")})},textOnImage:function(){(function(){h("#pcTextArea").unbind().bind("keyup",function(){var b=h(this).val().replace('"',"''");h(this).val(b);if(b.length>50)return b=b.substring(0,50),h(this).val(b),null;f.getActiveArea().controls.textInput.imgText.updateText(b);h(this).val()});
h(".pc-textArea-fontStyle-li").unbind().bind("click",function(){h(this).toggleClass("button-active");var b=h(this).attr("data-style");b+=h(this).hasClass("button-active")?"on":"off";f.getActiveArea().controls.textInput.imgText.toggleStyle(b)});h(".pc-textArea-fontAlign-li").unbind().bind("click",function(){h(".pc-textArea-fontAlign-li").removeClass("button-active");h(this).addClass("button-active");var b=h(this).attr("data-align");f.getActiveArea().controls.textInput.imgText.changeAlign(b)});n.off("a:dropdown:fontPicker:select");
n.on("a:dropdown:fontPicker:select",function(b){f.getActiveArea().controls.textInput.imgText.changeFont(b.value)});h(".pc-textArea-fontColor-li").unbind().bind("click",function(){f.getActiveArea().controls.textInput.imgText.changeTextColor(h(this).find("div").attr("data-color"))});n.off("a:popover:show:text-color");n.on("a:popover:show:text-color",function(b){b.popover.$popover.css("z-index",999999)});n.off("slideUpTextArea");n.on("slideUpTextArea",function(){var b=h(".pc-textArea-overlay");b.parents().is(":hidden")?
b.hide():b.slideUp(100,function(){h("#pcTextArea").focus()})});n.off("slideDownTextArea");n.on("slideDownTextArea",function(){h(".pc-textArea-overlay").slideDown()})})();h(".ac-image-text-container").delegate(".ac-btn-makeOwn.ac-textInput","click",function(){var b;h(".ac-imageUpload-control").removeClass("active");h(".ac-btn-makeOwn.ac-imageUpload").removeClass("active");h(".ac-textInput-control").addClass("active");h(".ac-btn-makeOwn.ac-textInput").addClass("active");b=f.getActiveArea();b.controls.textInput.imgText.updateControl();
b.controls.textInput.imgText.select();b.setActiveControl("textInput");n.trigger("slideUpTextArea");n.trigger("amazon-custom-log-ref-tag","logAddTextTabClick")})}};f.initiateBuyBox=function(){(new d({controller:{getJSON:f.fulfillmentJSON}})).Init()};f.buybox={enable:function(){n.trigger("enableBuybox")},disable:function(){n.trigger("disableBuybox")},verify:function(){for(var b=!1,a=0;a<f.surfaceList.length;a++)if(f.surfaceList[a].enableBuyBox()){b=!0;break}b?f.buybox.enable():f.buybox.disable()}};
f.init=function(){var a,d,g=!1,t=[],p;c.init();d=c.getState("ctsStateData",!0);f.data=d;for(var D=0;D<d.surfaces.length;D++){a=d.surfaces[D];a.index=D;D===0?a.isActive=!0:a.isActive=!1;a=new e(a,f);if(D===0)a.isActive=!0,a.customizationType==="ImagePrinting"?(h(".ac-single-text-preview-guideline").css({display:"none"}),h(".ac-image-text-preview-guideline").css({display:"block"})):h(".ac-single-text-preview-guideline").css({display:"block"});if(a.customizationType==="ImagePrinting"){var g=!0,E=a.data.areas[0].customizationTypeSettings.ImagePrinting.galleries;
if(E&&E.length&&(t=t.concat(E),!p&&a.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery))p=a.data.areas[0].customizationTypeSettings.ImagePrinting.defaultGallery}f.surfaceList.push(a)}if(d.surfaces.length===1&&d.surfaces[0].areas[0].customizationType==="TextPrinting")h(".thumbnail-container").fadeOut("fast"),h(".ac-image-text-preview-guideline").fadeOut("fast"),h(".pc-two-column-layout .pc-input-controls").addClass("ac-single-text-only"),h(".pc-two-column-layout .ac-controls-container").addClass("ac-single-text-only"),
h(".pc-two-column-layout").addClass("ac-single-text-only"),h(".pc-atc-wrapper").addClass("a-button-span12"),h(".ac-price").addClass("ac-single-text-only"),h(".ac-quantity").addClass("ac-single-text-only"),f.showThumbnail=!1;t=c.arrFilterUnique(t);k();f.initiateBuyBox();g===!0&&(t.length&&(l=new b(null,t,p),l.Fetch()),f.bindControls.galleryImage(),f.bindControls.uploadImage(),f.bindControls.textOnImage())}}})})();u.when("A","ready").execute(function(n){function j(){g("html").hasClass("a-canvas")||
(g(".pc-customization-disabled").addClass("active"),g(".pc-customization-enabled").remove())}var g=n.$;n.on("pc-single-text-loaded",function(){j()});j()});u.when("A","a-modal","ac-widget","ready").execute(function(n,j,g){var d=n.$,a=[];n.on("a:popover:afterHide:pc-popover-content",function(){n.trigger("amazon-custom-log-ref-tag","CloseClick");n.trigger("amazon-custom-popup-close",new Date)});d("html").hasClass("a-canvas")&&(d(".pc-customization-disabled").remove(),n.declarative("popover-trigger",
"click",function(){var e=d(".pc-popover-button"),c=j.get(e);if(d("#is-aui-dropdown-available").length===0)n.on("a:popover:beforeShow:pc-popover-content",function(b){b=b.popover;d(".a-button-dropdown",d(".ac-simple-text-font-picker",b.$popover)).remove();d("select",d(".ac-simple-text-font-picker",b.$popover)).css("display","block")});n.trigger("amazon-custom-log-ref-tag","CustomizeNowClick");if(c===null){if(a.length>0){for(c=0;c<a.length;c++)j.remove(a[c]);a.length=0}c=j.create(e,{name:"pc-popover-content",
header:d(".pc-popover-header").html(),activate:"onclick"});d(".pc-popover-header").remove();c.lock().show();a.push(c);e=d("#ASIN",d(".pc-buy-box",d(".pc-two-column-layout"))).val();d(".pc-two-column-layout").attr("asin",e);(new g).init()}}))});(function(){u.when("A","fabric-js","ac-utils","ready").register("ac-simple-textInput",function(n,j,g){var d=n.$;return function(a,e,c){var b={},h,f,l;b.inputBox=d(a).find("input.pc-simple-text-input");b.maxLength=parseInt(b.inputBox.attr("maxLength"),10);b.textLimitElement=
d(a).find(".pc-char-limit-length");b.charType=d(b.inputBox).data("input-type");b.acCanvas=e;b.options=c;b.isEmpty=function(){var f=!1;b.inputBox.val().replace(/\s/g,"")===""&&(f=!0);return f};b.isValid=function(){return g.validator().Validate(b.inputBox.val(),b.charType)&&!b.isEmpty()};b.cleared=function(){b.inputBox.val("")};b.changePreview=function(a){a||(a=b.inputBox.val());if(b.acCanvas.canvasObjects[b.acCanvas.id]!==s){var h=b.acCanvas.canvasObjects[b.acCanvas.id];h.forEachObject(function(f){b.acCanvas.canvasObjects[b.acCanvas.id].removeWithUpdate(f)});
b.acCanvas.canvas.remove(h)}if(a&&a.replace(/\s+/g,"").length){var a=new j.Text(a,{fontFamily:b.acCanvas.surface.font,fontSize:b.acCanvas.canvas.height,fill:b.acCanvas.surface.color,selectable:!1,textAlign:"center",originX:"center",originY:"center",lockMovementX:!0,lockMovementY:!0,lineHeight:1.3/1.13}),h=new j.Rect({originX:"center",originY:"center",fill:"",opacity:0,width:b.acCanvas.canvas.width,height:b.acCanvas.canvas.height,selectable:!1,lockMovementX:!0,lockMovementY:!0,clipTo:function(f){f.rect(-(b.acCanvas.canvas.width/
2),-(b.acCanvas.canvas.height/2),b.acCanvas.canvas.width,b.acCanvas.canvas.height+5)}}),c=new j.Group([h,a],{left:0,top:0,width:b.acCanvas.canvas.width,height:b.acCanvas.canvas.height,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,selectable:!1,name:"simple-text"});b.acCanvas.canvasObjects[b.acCanvas.id]=c;b.acCanvas.canvas.add(c);f(a,h)}else b.acCanvas.renderAll()};f=function(f){var a,h;d(".parentReferenceDiv").length?a=d(".parentReferenceDiv"):(a=d(document.createElement("div")),
d(".ac-image-backdrop").after(d(a)));h=d(".referenceDiv").length?d(".referenceDiv"):d(document.createElement("div"));d(a).addClass("parentReferenceDiv");d(h).addClass("referenceDiv");d(h).css({"font-family":b.acCanvas.surface.font,"font-size":f.getFontSize()});d(h).text(f.text);for(d(a).html(d(h));f.getWidth()>b.acCanvas.canvas.width-b.acCanvas.canvas.width*0.1||d(h).height()>b.acCanvas.canvas.height-b.acCanvas.canvas.height*0.1;)if(a=f.getFontSize(),a>2)a-=1,f.setFontSize(a-1),d(h).css({"font-size":a+
"px"}),f.set({top:-a*(1.3/1.13)*(1-1/1.13)*0.5}),f.setCoords();else break;b.acCanvas.renderAll()};l=function(){var f=b.inputBox.val(),a=f.length;b.textLimitElement.length>0&&b.textLimitElement.html(b.maxLength-parseInt(a,10));b.isValid()?(b.inputBox.removeClass("a-form-error"),b.inputBox.siblings(".pc-input-invalid").removeClass("active"),b.changePreview(f)):(b.isEmpty()&&b.changePreview(f),b.isEmpty()?(b.inputBox.siblings(".pc-input-invalid").removeClass("active"),b.inputBox.removeClass("a-form-error")):
(b.inputBox.siblings(".pc-input-invalid").addClass("active"),b.inputBox.addClass("a-form-error")),b.changePreview(""))};h=function(){b.inputBox.bind("keyup",function(){l()});b.inputBox.bind("change",function(){l()})};b.init=function(){h()};b.init();return b}})})();(function(){u.when("A","a-popover","ac-utils","ready").register("ac-color-picker",function(n,j){var g=n.$;return function(d,a){var e={};e.elem=d;e.notify=function(c){a.notifySubscribers("colorpicker",c)};e.bindEvents=function(){g(".ac-color-li",
e.elem).bind("click",function(){var a=g(this).find("div").attr("data-color"),b=j.get(g(".ac-color-picker-trigger",e.elem).parent());g(".ac-simplecolorpicker",e.elem).css("background-color",a);e.notify(a);b.hide()})};e.init=function(){g(".ac-is-single-color").length===g(".ac-controls-container").length?e.notify(g(".ac-is-single-color").attr("data-color")):(e.bindEvents(),e.notify(g(".ac-color-li",e.elem).find("div").attr("data-color")))};e.init();return e}})})();(function(){u.when("A","a-dropdown",
"ac-utils","ready").register("ac-font-picker",function(n,j){var g=n.$;return function(d,a){var e={};e.elem=d;e.notify=function(c){a.notifySubscribers("fontpicker",c)};e.init=function(){g(".ac-simple-text-font-picker",d);var c;if(g("#is-aui-dropdown-available").length===0)g("select",g(".ac-simple-text-font-picker",g("div[data-surface='"+a.id+"']"))).change(function(){var b=g(this).val();a.fontName=g(this).find("option:selected").text();e.notify(b)}),g("select option:first-child",g(".ac-simple-text-font-picker")).click().change();
else{var b="ac-simple-text-font-dropdown-"+g("#ASIN",g(".pc-buy-box")).val();c=j.getSelect(b);n.on("a:dropdown:"+b+":select",function(b){e.notify(b.value)});e.notify(c.val())}};e.init();return e}})})();(function(){u.when("A","ready").register("ac-constants",function(){return{AssetType:{IMAGE:"image"},StatusCode:{NON_HTML5_BROWSER:"NON-HTML5-BROWSER",NON_IMAGE_TYPE:"NON-IMAGE-TYPE",INVALID_FILE_TYPE:"INVALID_FILE_TYPE",READ_SUCCESS:"READ-SUCCESS",READ_NOT_REQUIRED:"READ_NOT_REQUIRED",INVALIDFILESIZE:"INVALID-FILE-SIZE"},
defaults:{thumbnailWidth:80,thumbnailHeight:80,thresholdImageWidth:50,thresholdImageHeight:50,galWidth:400,galHeight:400},scaleRatio:8,outputSVGDimention:{height:3200,width:3200},textDefaults:{fontFamily:"Arial, Helvetica, sans-serif",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",textAlign:"left",fill:"#FF9900",text:"",angle:0,opacity:1,fontSize:20}}})})();(function(){u.when("A","ac-utils","ac-gallery-base","ac-constants","ac-error-handling","ready").register("ac-image-gallery",function(n,
j,g,d,a){var e=n.$,c=function(){};c.prototype=new g;c.prototype.Init=function(){};e.extend(c.prototype,{getMediaServerUrl:function(){var b="";return"https://images-na.ssl-images-amazon.com/images/S/"+this.bucket+"/"+this.getResourcePath()+"._SL80_"+this.extension},isValidFile:function(b,a){var f=d.StatusCode;if(typeof FileReader!=="undefined")if(/(jpg|jpeg|png)$/i.test(b.name.toLowerCase())){var c=new FileReader;c.onload=function(){var e=new Image,d=b.size/1024;d>7168?a({statusCode:f.INVALIDFILESIZE}):
(e.onload=function(){a&&typeof a==="function"&&a({statusCode:f.READ_SUCCESS,imageHeight:e.height,imageWidth:e.width,imageSize:d})},e.onerror=function(){a&&typeof a==="function"&&a({statusCode:f.INVALID_FILE_TYPE})},e.src=c.result)};c.readAsDataURL(b)}else a&&typeof a==="function"&&a({statusCode:f.INVALID_FILE_TYPE});else a&&typeof a==="function"&&a({statusCode:f.NON_HTML5_BROWSER})},setKey:function(){this.resourcePath=this.getResourcePath();this.extension=this.getFileExtension();this.key=this.resourcePath+
this.extension},isValidFileType:function(b){return/(jpg|jpeg|png)$/i.test(b.name.toLowerCase())?!0:!1},createResourceStub:function(b,a){var f=e(".ac-custom-image-container").clone();f.find("img").attr("id","ac-custom-image-"+a);b.parent().find("#ac-custom-upload-preview-container").append(f)},updateView:function(b,a){a===d.StatusCode.NON_HTML5_BROWSER?this.validateImage(b):this.updateImage(b)},displayWarningIfRequired:function(b){var h=d.defaults.thresholdImageWidth,f=d.defaults.thresholdImageHeight,
c=b.imageHeight,e=b.imageWidth,b=c>e?c:e,c=c>e?e:c;a.hide();c<h||b<f?a.show("pc-resolution-warning"):a.hide()},updateImage:function(b){var h=this.getMediaServerUrl(),f,c;f=e("<div>").addClass("customer-image-container");c=e("<img>").addClass("a-declarative customer-uploaded-image");c.attr({id:"#ac-custom-image-"+b.resourceIndex,src:h,"data-original-url":b.pcImageUrl,"data-original-width":b.imageWidth,"data-original-height":b.imageHeight,"data-preview-url":b.pcImageUrl,"data-action":"customer-uploaded-image",
"data-token":b.imageToken});b=e("<div>").addClass("swatch-arrow");f.append(c);f.append(b);c.load(function(){c.trigger("click");e(".ac-uploaded-image").prepend(f);e(".ac-select-uploaded-image").fadeIn()}).error(function(){c.parent(".customer-image-container").remove();a.show("pc-image-mime-type-incorrect");e(".ac-select-uploaded-image").fadeOut();j.imageLoading.hide()})},validateImage:function(b){var h={bucketName:this.getBucket(),fileKey:b.imageToken.split("/")[1]},f=this;j.imageLoading.show();n.ajax("/gp/product/features/callValidateImage.html/ref=dp_pc_val_img",
{method:"POST",params:h,success:function(h){h.result.isValid==="1"?(b.imageWidth=h.result.width,b.imageHeight=h.result.height,f.updateImage(b)):(j.imageLoading.hide(),h.result.errorString&&h.result.errorString.length?a.show(null,{type:"error",message:h.result.errorString}):a.show("pc-upload-error-message"))},error:function(){a.show("pc-upload-error-message");j.imageLoading.hide()}})},populateImageObject:function(b,a){var f={};f.imageUrl=b.attr("data-preview-url");f.isCustomerImage=a;f.element=b;return f},
imageSelection:function(){var b=this.populateImageObject,a=this.displayWarningIfRequired;n.declarative.remove("customer-uploaded-image","click");n.declarative("customer-uploaded-image","click",function(f){var c=b(f.$currentTarget,!0);e(".selected.customer-image-container").removeClass("selected");f.$currentTarget.parent().addClass("selected");n.trigger("addCustomerImage",c);a({imageWidth:f.$currentTarget.attr("data-original-width"),imageHeight:f.$currentTarget.attr("data-original-height")});j.imageLoading.show()})},
scaleImage:function(b){var a,f,c,k;f=parseInt(e(b.element).attr("data-original-width"),10)/d.scaleRatio;parseInt(e(b.element).attr("data-original-height"),10);a=/[.]/.exec(b.imageUrl)?/[^.]+$/.exec(b.imageUrl):s;b=b.imageUrl.split(a[0]);c=a[0];k="";c.toLowerCase()==="png"&&(k="_AL__FMPng_");return b[0]+"_SX"+f+"_"+k+"."+a[0]}});return c})})();(function(){u.when("A","ac-base").register("ac-gallery",function(n,j){var g=n.$,d;d=function(a,e,c){var b=this;this.options=g.extend({thumbnailWidth:80,thumbnailHeight:80,
pageSize:100,categoryContainerSelector:"#ac-gallery",enableLazyLoading:!0,confineToContainerSelector:"body"},a);var h=g(b.options.confineToContainerSelector),f,l={checkIfCategoryAlreadyLoaded:function(b){var f=!1,a="";g('.theme-image-container[data-theme="'+b+'"]').length>0?(a=g('.theme-image-container[data-theme="'+b+'"]'),f=!0):a=g("<div>").addClass("theme-image-container").attr({"data-theme":b});return{container:a,isEmpty:!f}},checkIfCategoryExistsInObject:function(b){for(var a=f.contentLibraryList.length,
h=0,c=!1,h=0;h<a;h+=1)if(f.contentLibraryList[h].title===b||f.contentLibraryList[h].contentLibraryId===b){c=!0;break}return c},formatResponseObject:function(b){if(b.inlineData!==s)b.contentLibraryList=b.inlineData.contentLibraryList,b.contentLibraryIds=b.inlineData.contentLibraryIds;for(var f=0;f<b.contentLibraryIds.length;f++){var a=b.contentLibraryIds[f];b.contentLibraryIds[f]=l.getFormattedName(a)}for(f=0;f<b.contentLibraryList.length;f++){var h=b.contentLibraryList[f],a=h.title;h.title=l.getFormattedName(a)}b.defaultLibrary=
l.getFormattedName(b.defaultLibrary);return b},formatNewResponseObject:function(b){if(b.contentList.length)b.contentLibraryList=[b],b.contentLibraryIds="/"+b.title;for(var f=0;f<b.contentLibraryIds.length;f++){var a=b.contentLibraryIds[f];b.contentLibraryIds[f]=l.getFormattedName(a)}for(f=0;f<b.contentLibraryList.length;f++){var h=b.contentLibraryList[f],a=h.title;h.title=l.getFormattedName(a)}b.defaultLibrary=l.getFormattedName(b.defaultLibrary);return b},getFormattedName:function(b){if(!b)return null;
var f=b;b.charAt(0)==="/"&&(f=b.substr(1,b.length));return f},getGalleryInputData:function(b){var f={};if(j.getOfferListingID()!==s)f.url="/gp/product/features/getContentLibrary.html",f.data={merchantId:j.getMerchantID(),contentLibraryName:String(b)};return f},getContentLibraryObject:function(b){if(f===s)return s;b=l.getIndexOfCategory(f.contentLibraryList,b);return b===-1?s:f.contentLibraryList[b]},getIndexOfCategory:function(b,f){var a=b.length,h;for(h=0;h<a;h+=1)if(b[h].title.toLowerCase()===f.toLowerCase())return h;
return-1},lazyload:function(){var b=g(".ac-gallery-container"),f=g(".pc-lazyload-error-message");return{success:function(){f.removeClass("active");b.show()},error:function(){b.hide();f.addClass("active");l.loading.hide()}}}(),loading:function(){var b=g(".pc-lazyload-image");return{show:function(){b.addClass("active")},hide:function(){b.removeClass("active")}}}(),populateImageObject:function(b,f){var a={},h=b.data("original-url"),h=h.substr(h.lastIndexOf("."),h.length);a.imageUrl=b.data("preview-url");
a.isCustomerImage=f;a.token=g(".pc-category-name.active").attr("data-themename")+"/"+b.attr("data-token")+h;return a}},d=s,i=function(){var f={categorySelection:function(){n.declarative.remove("category-selection","click");n.declarative("category-selection","click",function(f){var a=f.$currentTarget.attr("data-themename"),h=f.$currentTarget.attr("data-categoryid");o.BuildGallery(a);g(".ac-selected-gallery-name").html(a).attr({"data-contentId":h,title:a});g("a",g(b.options.categoryContainerSelector)).removeClass("active");
f.$currentTarget.addClass("active");g(".vendor-category",g(b.options.categoryContainerSelector)).removeClass("a-active");f.$currentTarget.parent(".vendor-category").addClass("a-active");d!==s&&d.hide()})},imageContainerScroll:function(){if(b.options.enableLazyLoading){var f=g(".ac-gallery-container");f.scroll(function(b){b.preventDefault();if(f.scrollTop()>=g(".ac-gallery-content").height()-f.height()){var b=g("a.active",g(".vendor-categories")).attr("data-themename"),a=l.checkIfCategoryAlreadyLoaded(b);
o.AppendImages(b,a,!1)}})}},imageSelection:function(){n.declarative.remove("ac-gallery-content-image","click");n.declarative("ac-gallery-content-image","click",function(b){var f=l.populateImageObject(b.$currentTarget,!1);f.vendorGalleryFileId=g(b.$target).attr("data-contentid");f.vendorGalleryId=g(".vendor-category .pc-category-name.active").attr("data-categoryid");f.originalURL=g(b.$target).attr("data-original-url");g(".selected.ac-gallery-content-container").removeClass("selected");b.$currentTarget.parent().addClass("selected");
n.trigger("hideWarningMessage");n.trigger("addGalleryImage",f);g("a.active",g(".vendor-category")).attr("data-themename")})},popover:function(){n.off("a:popover:show:vendor-categories");n.on("a:popover:show:vendor-categories",function(b){d=b.popover})}};return{Init:function(){f.categorySelection();f.imageSelection();f.imageContainerScroll();f.popover()}}}(),m=function(){function a(b,f,h){var c=g("<li>"),e=g("<a>");e.attr({"data-themename":b,"data-action":"category-selection","data-categoryId":f?f:
b,title:b});c.addClass("a-tab-heading vendor-category");e.addClass(" a-declarative ");e.attr("href","#").addClass("pc-category-name").html(b);c.append(e);h.append(c)}var c={defaultCategory:function(){g(".pc-category-name").each(function(b,a){if(g(a).attr("data-themename")===f.defaultLibrary||g(a).attr("data-categoyid")===f.defaultLibraryId)return g(a).trigger("click"),!1});g(".ac-selected-gallery-name").text(f.defaultLibrary).attr({"data-categoryid":f.defaultLibraryId,title:f.defaultLibrary})}};return{Build:function(){var e;
l.loading.hide();try{for(var d=f.contentLibraryIds.length,k=g("<div>"),m,o=0;o<f.contentLibraryList.length;o++){f.contentLibraryList[o].contentLibraryId=l.getFormattedName(f.contentLibraryList[o].contentLibraryId);if(f.contentLibraryList[o].contentLibraryId&&f.contentLibraryList[o].contentLibraryId===f.defaultLibrary)f.defaultLibraryId=f.contentLibraryList[o].contentLibraryId,f.defaultLibrary=f.contentLibraryList[o].title;if(!f.contentLibraryList[o].contentLibraryId)f.contentLibraryList[o].contentLibraryId=
f.contentLibraryList[o].title}if(!f.defaultLibraryId)f.defaultLibraryId=f.defaultLibrary;l.checkIfCategoryExistsInObject(f.defaultLibrary)&&a(f.defaultLibrary,f.defaultLibraryId,k);for(m=0;m<d;m+=1)e=f.contentLibraryList[m].title,e!==f.defaultLibrary&&l.checkIfCategoryExistsInObject(f.defaultLibrary)&&a(e,f.contentLibraryList[m].contentLibraryId,k);g(b.options.categoryContainerSelector,h).append(k.html());i.Init();c.defaultCategory()}catch(t){l.lazyload.error()}}}}(),o=function(){function f(a,h,c){var e=
l.getContentLibraryObject(a),a=e.contentList,e=e.contentList.length,d=g("<div>"),k;if(b.options.enableLazyLoading||c){b.options.enableLazyLoading?c?(k=0,c=e<b.options.pageSize?e:b.options.pageSize):(c=h.container.data("endIndex"),k=c+1,c=e<c+b.options.pageSize?e:c+b.options.pageSize):(k=0,c=e);for(;k<c;k+=1){var i=a[k],m=g("<div>").addClass("ac-gallery-content-container"),o=g("<img>"),p=g("<div>").addClass("swatch-arrow");i.status&&i.status!=="Active"||!i.isActive||!i.info||(o.attr({src:i.info.thumbnailURL,
"data-original-url":i.info.url,alt:i.description,"data-original-width":i.width?i.width:2500,"data-original-height":i.height?i.height:3500,"data-preview-url":i.info.previewURL,"data-thumbnail-url":i.info.thumbnailURL,"data-action":"ac-gallery-content-image","data-token":i.title,"data-contentId":i.ContentId?i.ContentId:i.title,isExclusive:1}),o.addClass("ac-gallery-content-image a-declarative"),m.append(o),m.append(p),d.append(m))}a=d.html();h.isEmpty?(g(".ac-gallery-content").append(h.container.append(a)),
h.container.data("endIndex",c),h.container.data("length",e)):(h.container.data("endIndex",c),h.container.append(a))}}return{AppendImages:f,BuildGallery:function(b){var a=l.checkIfCategoryAlreadyLoaded(b);g(".theme-image-container",h).hide();g(".ac-gallery-container").scrollTop(0);a.isEmpty?f(b,a,!0):(g(".ac-gallery-container").scrollTop(0),g('.theme-image-container[data-theme="'+b+'"]',h).show())}}}(),t=function(b,a){var h=l.getGalleryInputData(b),c=g.Deferred();h.data.contentLibraryName="/"+h.data.contentLibraryName.replace("/",
"");g.ajax({type:"GET",url:h.url,dataType:"json",data:h.data,success:function(b){l.lazyload.success();f=g.parseJSON(b.result);if(f===null||f.Status==="Error")l.lazyload.error();else return c.resolve(f,a)},error:function(b){return c.reject(b,a)}});return c.promise()};return{Fetch:function(){var b=[],a={},h=0,d;d=function(){++h;if(h===e.length){for(var d=0;d<b.length;d++)b[d]||(b.splice(d,1),e.splice(d,1));a.inlineData={contentLibraryList:b,contentLibraryIds:e};d=!1;if(c)for(var k=0;k<a.inlineData.contentLibraryList.length;k++)if(a.inlineData.contentLibraryList[k].contentLibraryId===
c||a.inlineData.contentLibraryList[k].title===c){d=!0;break}a.defaultLibrary=d?c:e[0];f=l.formatResponseObject(a);m.Build()}};for(var k=0;k<e.length;k++)g.when(t(e[k],k)).then(function(f,a){b[a]=f.status&&f.status==="Active"&&f.contentList||f.isActive&&f.contentList?f:null;d()},function(f,a){b[a]=null;d()})}}};d.prototype=j;return d})})();(function(){u.when("A","ac-utils","ac-constants","ac-image-gallery","ac-error-handling","ready").register("AssetUploader",function(n,j,g,d,a){var e=n.$,c=function(b){this.assetType=
b.assetType;this.$form=b.$form;this.mediaServer=b.mediaServer;this.index=0};c.prototype.getComponentName=function(){return"AssetUploader"};c.prototype.getUploadTypeObject=function(b){var a;b==="image"&&(a=new d);a.index=this.index++;return a};c.prototype.Init=function(){var b=this.$form,h=this.getUploadTypeObject(this.assetType);b.find("input[type='file']").attr("multiple",!1);h.imageSelection();b.fileupload({autoUpload:!0,url:e(".ac-custom-upload-form").attr("action"),dataType:"json",type:"POST",
add:function(f,c){var d=c.files[0];c.resourceIndex=h.index;h.isValidFile(d,function(f){e.extend(c,f);c.statusCode===g.StatusCode.INVALID_FILE_TYPE?a.show("pc-image-mime-type-incorrect",{timeOut:"6000"}):c.statusCode===g.StatusCode.INVALIDFILESIZE?a.show("pc-image-size-incorrect",{timeOut:"6000"}):(h.createResourceStub(b,c.resourceIndex),n.post("/gp/features/fetch-imageUpload-s3post-parameters.html",{dataType:"json",params:{contentType:"image",csrfToken:e(".ac-custom-upload-form").attr("data-csrf"),
uid:h.getResourcePath(),extension:"."+c.fileInput.val().split(".").pop().toLowerCase(),isDPX:1},success:function(f){c.uploadObject=h;h.setBucket(f.imageToken.split("/")[0]);h.setFileName(d.name);h.setKey(c.resourceIndex);h.setResourcePath(f.key.split(".")[0]);h.getKey();b.attr("action",f.action);e("#key",b).val(f.key);e("#AWSAccessKeyId",b).val(f.AWSAccessKeyId);e("#policy",b).val(f.policy);e("#signature",b).val(f.signature);e("#success_action_status",b).val(f.statusCode);e("#expires",b).val(f.expires);
c.pcImageUrl=f.thumbnailUrl;c.imageName=f.key;c.imageToken=f.imageToken;c.submit()},error:function(){a.show("pc-upload-error-message",{timeOut:"6000"});n.trigger("amazon-custom-log-ref-tag","logS3TextUploadError")}}))})},send:function(){e(".ac-upload-progress").text("0%");j.imageLoading.show()},fail:function(){j.imageLoading.hide();a.show("pc-upload-error-message",{timeOut:"6000"});e(".ac-upload-progress").text("");n.trigger("amazon-custom-log-ref-tag","logS3ImageUploadError")},done:function(b,a){e(".ac-upload-progress").text("100%");
j.imageLoading.hide();a.uploadObject.updateView(a,a.statusCode);e(".ac-upload-progress").text("")},progress:function(b,a){var h=parseInt(a.loaded/a.total*100,10);e(".ac-upload-progress").text(h+"%")}})};return c});u.when("A","AssetUploader","ac-constants","ready").execute(function(n,j){n.declarative("asset-upload","click",function(g){var d;g.$target.data("asset-upload")===s&&(d=new j({$form:g.$target.parentsUntil(".ac-custom-upload-container","form"),assetType:"image",uploadType:g.data["upload-type"],
mediaServer:"https://images-na.ssl-images-amazon.com/images/S/"}),d.Init(),g.$target.data("asset-upload",d))})})})();(function(){u.when("A","ready").register("ac-gallery-base",function(){var n=function(){};n.prototype={generateUUID:function(){function j(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return j()+j()+"-"+j()+"-"+j()+"-"+j()+"-"+j()+j()+j()},getTimeStamp:function(){var j=new Date;return j.getUTCFullYear()+"-"+j.getUTCMonth()+"-"+j.getUTCDate()+"-"+j.getUTCHours()+
"-"+j.getUTCMinutes()},getFileExtension:function(){var j=/^.+\.([^.]+)$/.exec(this.fileName);return j===null?"":"."+j[1].toLowerCase()},getFileNameWithoutExtension:function(){var j=this.fileName.split(".")[0];return j===null?"":j.toLowerCase()},getKey:function(){return this.key},isValidFile:function(){console.log("No Implementation - isValidFile")},setBucket:function(j){this.bucket=j},getBucket:function(){return this.bucket},setFileName:function(j){this.fileName=j},updateView:function(){console.log("No Implementation - ValidateAndUpdate")},
setResourcePath:function(j){this.ResourcePath=j},getResourcePath:function(){return this.ResourcePath}};return n})})();(function(){u.when("A","ac-base","ac-utils","ready").register("ac-error-handling",function(n,j,g){var d=n.$,a,e,c,b,h;a=function(){return d(".ac-error-container")};e=function(){return d(".ac-error-container .a-alert-heading")};c=function(){return d(".ac-error-container .a-alert-content")};b=function(b){var a;a={type:b.type?b.type:"error",message:b.message};if(h.indexOf(b.id)!==-1)a.type=
"warning";return a};h=["pc-error-generic-text","pc-resolution-warning","pc-scale-warning-message","pc-generic-warning-text"];return{show:function(f,h){var d={};f?d=b({id:f,message:g.stringHandler(f)}):(d.type=h.type,d.message=h.message);a().removeClass("a-alert-warning a-alert-error a-alert-success a-alert-info").addClass("a-alert-"+d.type);e().text(d.type.charAt(0).toUpperCase()+d.type.slice(1)+" Message");c().html(d.message);a().addClass("active");h&&h.timeOut&&setTimeout(function(){a().removeClass("active")},
parseInt(h.timeOut,10))},hide:function(){a().removeClass("active")}}})})();(function(){u.when("A","a-dropdown","ac-base","ac-utils","fabric-js","ac-constants","ready").register("ac-text-image",function(n,j,g,d,a,e){var c=n.$;return function(b){var h=this,f,l,k={},i;i=function(){k=c.extend({},e.textDefaults);l&&l.setText("")};h.isInitialized=!1;h.changeFont=function(b){h.updateText({fontFamily:b})};h.toggleStyle=function(b){var f={};switch(b){case "boldoff":f.fontWeight="normal";h.updateText(f);break;
case "boldon":f.fontWeight="bold";h.updateText(f);break;case "italicson":f.fontStyle="italic";h.updateText(f);break;case "italicsoff":f.fontStyle="normal";h.updateText(f);break;case "underlineon":f.textDecoration="underline";h.updateText(f);break;case "underlineoff":f.textDecoration="normal",h.updateText(f)}};h.style=function(){};h.changeAlign=function(b){var f={};switch(b){case "left":f.textAlign="left";h.updateText(f);break;case "center":f.textAlign="center";h.updateText(f);break;case "right":f.textAlign=
"right",h.updateText(f)}};h.changeTextColor=function(b){c(".simplecolorpicker.icon").css("background-color",b);h.updateText({fill:b})};h.editText=function(b){l.setText(b);h.updateText(null)};h.resetControl=function(){c("#pcTextArea").val("");c(".pc-textArea-fontStyle-li").removeClass("button-active");c(".pc-textArea-fontAlign-li").removeClass("button-active");c('.pc-textArea-fontAlign-li[data-align="left"]').addClass("button-active");j.getSelect("fontPicker").setValue("Arial");c(".simplecolorpicker.icon").css({"background-color":c("ul.pc-textArea-fontColor-ul li.pc-textArea-fontColor-li:first-child div").css("background-color")})};
h.updateControl=function(){if(h.isInitialized){h.resetControl();var f=b.getObjects();k.text="";for(var a=0;a<f.length;a++)if(f[a].type==="text")k.text=f[a].text;c("#pcTextArea").val(k.text);k.fontWeight==="bold"&&c('.pc-textArea-fontStyle-li[data-style="bold"]').addClass("button-active");k.textDecoration==="underline"&&c('.pc-textArea-fontStyle-li[data-style="underline"]').addClass("button-active");k.fontStyle==="italic"&&c('.pc-textArea-fontStyle-li[data-style="italics"]').addClass("button-active");
k.textAlign==="right"?(c(".pc-textArea-fontAlign-li").removeClass("button-active"),c('.pc-textArea-fontAlign-li[data-align="right"]').addClass("button-active")):k.textAlign==="center"&&(c(".pc-textArea-fontAlign-li").removeClass("button-active"),c('.pc-textArea-fontAlign-li[data-align="center"]').addClass("button-active"));j.getSelect(c("#fontPicker")).setValue(k.fontFamily);c(".simplecolorpicker.icon").css({"background-color":k.fill})}else h.init(),h.resetControl()};h.select=function(){for(var f=
b.getObjects(),a=b.canvas.size()-1;a>=0;a--)f[a].id&&f[a].id==="text-"+b.id&&b.canvas.setActiveObject(f[a])};h.deSelect=function(){for(var f=b.getObjects(),a=b.canvas.size()-1;a>=0;a--)f[a].id&&f[a].id==="text-"+b.id&&b.canvas.setActiveObject(f[a])};f=function(f){for(var l,d=b.getObjects(),i=b.canvas.size()-1;i>=0;i--)if(d[i].id&&d[i].id===f.id)return null;l=function(f){b.canvas.add(f);f.bringToFront();b.canvas.calcOffset();f.setCoords();b.canvas.setActiveObject(f);b.renderAll()};f=function(f){var a=
{};c.extend(a,f,e.textDefaults);a.id="text-"+b.id;return k=a}(f?f:{});f.fontSize=b.canvas.width/5;f.fill=b.surface.data.FontSettings.colors[0].value;c("#pcTextArea").val("");h.updateText(null);return function(){var h=new a.Text(f.text,{angle:f.angle,opacity:f.opacity,fontFamily:f.fontFamily,fontSize:f.fontSize,fontWeight:f.fontWeight,fontStyle:f.fontStyle,id:f.id,cursorColor:"#ffffff",fill:f.fill,transparentCorners:!1,centeredRotation:!0,centeredScaling:!0,padding:5,originX:"left",originY:"top",selectable:!0,
textAlign:f.textAlign});h.set({left:20,top:b.canvas.height/2-f.fontSize/2});l(h);return h}()};var g=function(f){for(var a=b.getObjects(),h=a.length-1;h>=0;h--)a[h].name&&a[h].name==="galImage"&&b.canvas.remove(a[h]);if(l){l.bringToFront();b.canvas.calcOffset();if(typeof f==="object")l.set(f),c.extend(k,k,f);else if(typeof f==="string")l.setText(f),k.text=f,c("#pcTextArea").val(f);l.setCoords();b.canvas.setActiveObject(l);k.text===""?c(".pc-two-column-layout .ac-delete-button").fadeOut():c(".pc-two-column-layout .ac-delete-button").fadeIn()}b.renderAll()};
h.updateText=function(f){var a,c,e,l,k=!1;a=b.getObjects();c=d.stringHandler("pc-clear-design-msg");e=function(){b.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var f=b.getObjects(),a=0;a<f.length;a++)f[a].name&&f[a].name==="galImage"&&b.clear()})});g(f)};l=function(){for(var f=b.canvas.size()-1;f>=0;f--)if(a[f].type==="text"){a[f].remove();break}h.cleared();b.controls.textInput.isControlActive=!1};b.surface.widget.surfaceList.forEach(function(b){b.childCanvasList.forEach(function(b){for(var b=
b.getObjects(),f=0;f<b.length;f++)if(b[f].name&&b[f].name==="galImage"){k=!0;break}})});k?d.showDialog.show(c,e,{ok:"Clear",cancelCallBack:l}):e()};h.cleared=function(){h.resetControl();i();h.isInitialized=!1};h.init=function(){h.isInitialized=!0;l=f()}}})})()})})(function(){var u=window.AmazonUIPageJS||window.P,y=u._namespace||u.attributeErrors;return y?y("ProductCustomizationSingleTextAssets"):u}(),window);
(function(u,y,s){u.execute(function(){u.when("A").register("fabric-js",function(n){var j=j||{};if(!n.capabilities.canvas)return{};var g=g||{version:"1.4.13"};if(typeof j!=="undefined")j.fabric=g;typeof document!=="undefined"&&typeof y!=="undefined"?(g.document=document,g.window=y):(g.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),g.window=g.document.createWindow?g.document.createWindow():g.document.parentWindow);g.isTouchSupported="ontouchstart"in g.document.documentElement;
g.isLikelyNode=typeof Buffer!=="undefined"&&typeof y==="undefined";g.SHARED_ATTRIBUTES="display,transform,fill,fill-opacity,fill-rule,opacity,stroke,stroke-dasharray,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width".split(",");g.DPI=96;g.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function d(b,a){if(this.__eventListeners[b])a?g.util.removeFromArray(this.__eventListeners[b],a):this.__eventListeners[b].length=0}function a(b,a){if(!this.__eventListeners)this.__eventListeners=
{};if(arguments.length===1)for(var f in b)this.on(f,b[f]);else this.__eventListeners[b]||(this.__eventListeners[b]=[]),this.__eventListeners[b].push(a);return this}function e(b,a){if(this.__eventListeners){if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]==="object")for(var f in b)d.call(this,f,b[f]);else d.call(this,b,a);return this}}function c(b,a){if(this.__eventListeners){var f=this.__eventListeners[b];if(f){for(var c=0,e=f.length;c<e;c++)f[c].call(this,
a||{});return this}}}g.Observable={observe:a,stopObserving:e,fire:c,on:a,off:e,trigger:c}})();g.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var d=0,a=arguments.length;d<a;d++)this._onObjectAdded(arguments[d]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(d,a,e){var c=this.getObjects();e?c[a]=d:c.splice(a,0,d);this._onObjectAdded(d);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var d=this.getObjects(),a,e=
0,c=arguments.length;e<c;e++)a=d.indexOf(arguments[e]),a!==-1&&(d.splice(a,1),this._onObjectRemoved(arguments[e]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(d,a){for(var e=this.getObjects(),c=e.length;c--;)d.call(a,e[c],c,e);return this},getObjects:function(d){return typeof d==="undefined"?this._objects:this._objects.filter(function(a){return a.type===d})},item:function(d){return this.getObjects()[d]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},
contains:function(d){return this.getObjects().indexOf(d)>-1},complexity:function(){return this.getObjects().reduce(function(d,a){d+=a.complexity?a.complexity():0;return d},0)}};(function(d){var a=Math.sqrt,e=Math.atan2,c=Math.PI/180;g.util={removeFromArray:function(b,a){var f=b.indexOf(a);f!==-1&&b.splice(f,1);return b},getRandomInt:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},degreesToRadians:function(b){return b*c},radiansToDegrees:function(b){return b/c},rotatePoint:function(b,a,f){var c=
Math.sin(f),f=Math.cos(f);b.subtractEquals(a);return(new g.Point(b.x*f-b.y*c,b.x*c+b.y*f)).addEquals(a)},transformPoint:function(b,a,f){return f?new g.Point(a[0]*b.x+a[1]*b.y,a[2]*b.x+a[3]*b.y):new g.Point(a[0]*b.x+a[1]*b.y+a[4],a[2]*b.x+a[3]*b.y+a[5])},invertTransform:function(b){var a=b.slice(),a=1/(b[0]*b[3]-b[1]*b[2]),a=[a*b[3],-a*b[1],-a*b[2],a*b[0],0,0],b=g.util.transformPoint({x:b[4],y:b[5]},a);a[4]=-b.x;a[5]=-b.y;return a},toFixed:function(b,a){return parseFloat(Number(b).toFixed(a))},parseUnit:function(b,
a){var f=/\D{0,2}$/.exec(b),c=parseFloat(b);if(!a)a=g.Text.DEFAULT_SVG_FONT_SIZE;switch(f[0]){case "mm":return c*g.DPI/25.4;case "cm":return c*g.DPI/2.54;case "in":return c*g.DPI;case "pt":return c*g.DPI/72;case "pc":return c*g.DPI/72*12;case "em":return c*a;default:return c}},falseFunction:function(){return!1},getKlass:function(b,a){b=g.util.string.camelize(b.charAt(0).toUpperCase()+b.slice(1));return g.util.resolveNamespace(a)[b]},resolveNamespace:function(b){if(!b)return g;for(var b=b.split("."),
a=b.length,f=d||g.window,c=0;c<a;++c)f=f[b[c]];return f},loadImage:function(b,a,f,c){if(b){var e=g.util.createImage();e.onload=function(){var h;a&&a.call(f,e);h=e.onload=e.onerror=null,e=h};e.onerror=function(){var h;g.log("Error loading "+e.src);a&&a.call(f,null,!0);h=e.onload=e.onerror=null,e=h};if(b.indexOf("data")!==0&&typeof c!=="undefined")e.crossOrigin=c;e.src=b}else a&&a.call(f,b)},enlivenObjects:function(b,a,f,c){function e(){++m===o&&a&&a(d)}var b=b||[],d=[],m=0,o=b.length;o?b.forEach(function(b,
a){if(!b||!b.type)e();else{var h=g.util.getKlass(b.type,f);h.async?h.fromObject(b,function(f,h){h||(d[a]=f,c&&c(b,d[a]));e()}):(d[a]=h.fromObject(b),c&&c(b,d[a]),e())}}):a&&a(d)},groupSVGElements:function(b,a,f){b=new g.PathGroup(b,a);typeof f!=="undefined"&&b.setSourcePath(f);return b},populateWithProperties:function(b,a,f){if(f&&Object.prototype.toString.call(f)==="[object Array]")for(var c=0,e=f.length;c<e;c++)f[c]in b&&(a[f[c]]=b[f[c]])},drawDashedLine:function(b,c,f,l,d,i){l-=c;var g=d-f,d=a(l*
l+g*g),l=e(g,l),g=i.length,o=0,t=!0;b.save();b.translate(c,f);b.moveTo(0,0);b.rotate(l);for(c=0;d>c;)c+=i[o++%g],c>d&&(c=d),b[t?"lineTo":"moveTo"](c,0),t=!t;b.restore()},createCanvasElement:function(b){b||(b=g.document.createElement("canvas"));!b.getContext&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(b);return b},createImage:function(){return g.isLikelyNode?new (require("canvas").Image):g.document.createElement("img")},createAccessors:function(b){for(var b=b.prototype,
a=b.stateProperties.length;a--;){var f=b.stateProperties[a],c=f.charAt(0).toUpperCase()+f.slice(1),e="set"+c,c="get"+c;b[c]||(b[c]=new Function('return this.get("'+f+'")'));b[e]||(b[e]=new Function("value",'return this.set("'+f+'", value)'))}},clipContext:function(b,a){a.save();a.beginPath();b.clipTo(a);a.clip()},multiplyTransformMatrices:function(b,a){for(var f=[[b[0],b[2],b[4]],[b[1],b[3],b[5]],[0,0,1]],c=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],e=[],d=0;d<3;d++){e[d]=[];for(var g=0;g<3;g++){for(var o=
0,t=0;t<3;t++)o+=f[d][t]*c[t][g];e[d][g]=o}}return[e[0][0],e[1][0],e[0][1],e[1][1],e[0][2],e[1][2]]},getFunctionBody:function(b){return(String(b).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(b,a,f,c){c>0&&(a>c?a-=c:a=0,f>c?f-=c:f=0);for(var e=!0,b=b.getImageData(a,f,c*2||1,c*2||1),a=3,f=b.data.length;a<f;a+=4)if(e=b.data[a]<=0,e===!1)break;return e}}})(typeof j!=="undefined"?j:this);(function(){function d(f,c,h,d,g,p,D){var E=l.call(arguments);if(b[E])return b[E];var z=Math.PI,
j=D*z/180,v=Math.sin(j),j=Math.cos(j),x=0,n=0,h=Math.abs(h),d=Math.abs(d),B=-j*f*0.5-v*c*0.5,r=-j*c*0.5+v*f*0.5,q=h*h,w=d*d,C=r*r,A=B*B,G=q*w-q*C-w*A,K=0;G<0?(q=Math.sqrt(1-G/(q*w)),h*=q,d*=q):K=(g===p?-1:1)*Math.sqrt(G/(q*C+w*A));C=K*h*r/d;A=-K*d*B/h;K=j*C-v*A+f*0.5;q=v*C+j*A+c*0.5;w=e(1,0,(B-C)/h,(r-A)/d);r=e((B-C)/h,(r-A)/d,(-B-C)/h,(-r-A)/d);p===0&&r>0?r-=2*z:p===1&&r<0&&(r+=2*z);z=Math.ceil(Math.abs(r/z*2));B=[];r/=z;C=8/3*Math.sin(r/4)*Math.sin(r/4)/Math.sin(r/2);A=w+r;for(G=0;G<z;G++)B[G]=
a(w,A,j,v,h,d,K,q,C,x,n),x=B[G][4],n=B[G][5],w=A,A+=r;return b[E]=B}function a(b,f,a,c,e,d,g,E,z,j,v){var x=l.call(arguments);if(h[x])return h[x];var n=Math.cos(b),B=Math.sin(b),r=Math.cos(f),q=Math.sin(f),w=a*e*r-c*d*q+g,C=c*e*r+a*d*q+E;h[x]=[j+z*(-a*e*B-c*d*n),v+z*(-c*e*B+a*d*n),w+z*(a*e*q+c*d*r),C+z*(c*e*q-a*d*r),w,C];return h[x]}function e(b,f,a,c){b=Math.atan2(f,b);a=Math.atan2(c,a);return a>=b?a-b:2*Math.PI-(b-a)}function c(b,a,c,h,e,d,g,E){var z=l.call(arguments);if(f[z])return f[z];var j=
Math.sqrt,v=Math.min,x=Math.max,n=Math.abs,B=[],r=[[],[]],q,w,C,A,G;w=6*b-12*c+6*e;q=-3*b+9*c-9*e+3*g;C=3*c-3*b;for(var K=0;K<2;++K)K>0&&(w=6*a-12*h+6*d,q=-3*a+9*h-9*d+3*E,C=3*h-3*a),n(q)<1.0E-12?n(w)<1.0E-12||(A=-C/w,0<A&&A<1&&B.push(A)):(A=w*w-4*C*q,A<0||(G=j(A),A=(-w+G)/(2*q),0<A&&A<1&&B.push(A),A=(-w-G)/(2*q),0<A&&A<1&&B.push(A)));for(n=j=B.length;j--;)A=B[j],w=1-A,q=w*w*w*b+3*w*w*A*c+3*w*A*A*e+A*A*A*g,r[0][j]=q,q=w*w*w*a+3*w*w*A*h+3*w*A*A*d+A*A*A*E,r[1][j]=q;r[0][n]=b;r[1][n]=a;r[0][n+1]=g;r[1][n+
1]=E;v=[{x:v.apply(null,r[0]),y:v.apply(null,r[1])},{x:x.apply(null,r[0]),y:x.apply(null,r[1])}];return f[z]=v}var b={},h={},f={},l=Array.prototype.join;g.util.drawArc=function(b,f,a,c){for(var h=[[],[],[],[]],c=d(c[5]-f,c[6]-a,c[0],c[1],c[3],c[4],c[2]),e=0,l=c.length;e<l;e++)h[e][0]=c[e][0]+f,h[e][1]=c[e][1]+a,h[e][2]=c[e][2]+f,h[e][3]=c[e][3]+a,h[e][4]=c[e][4]+f,h[e][5]=c[e][5]+a,b.bezierCurveTo.apply(b,h[e])};g.util.getBoundsOfArc=function(b,f,a,h,e,l,g,E,z){for(var j=0,v=0,x=[],n=[],a=d(E-b,z-
f,a,h,l,g,e),h=0,e=a.length;h<e;h++)x=c(j,v,a[h][0],a[h][1],a[h][2],a[h][3],a[h][4],a[h][5]),x[0].x+=b,x[0].y+=f,x[1].x+=b,x[1].y+=f,n.push(x[0]),n.push(x[1]),j=a[h][4],v=a[h][5];return n};g.util.getBoundsOfCurve=c})();(function(){function d(a,c,b){if(a&&a.length!==0){var h=a.length-1,f=c?a[h][c]:a[h];if(c)for(;h--;)b(a[h][c],f)&&(f=a[h][c]);else for(;h--;)b(a[h],f)&&(f=a[h]);return f}}var a=Array.prototype.slice;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){if(this===void 0||this===
null)throw new TypeError;var c=Object(this),b=c.length>>>0;if(b===0)return-1;var h=0;arguments.length>0&&(h=Number(arguments[1]),h!==h?h=0:h!==0&&h!==Number.POSITIVE_INFINITY&&h!==Number.NEGATIVE_INFINITY&&(h=(h>0||-1)*Math.floor(Math.abs(h))));if(h>=b)return-1;for(h=h>=0?h:Math.max(b-Math.abs(h),0);h<b;h++)if(h in c&&c[h]===a)return h;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,c){for(var b=0,h=this.length>>>0;b<h;b++)b in this&&a.call(c,this[b],b,this)};if(!Array.prototype.map)Array.prototype.map=
function(a,c){for(var b=[],h=0,f=this.length>>>0;h<f;h++)h in this&&(b[h]=a.call(c,this[h],h,this));return b};if(!Array.prototype.every)Array.prototype.every=function(a,c){for(var b=0,h=this.length>>>0;b<h;b++)if(b in this&&!a.call(c,this[b],b,this))return!1;return!0};if(!Array.prototype.some)Array.prototype.some=function(a,c){for(var b=0,h=this.length>>>0;b<h;b++)if(b in this&&a.call(c,this[b],b,this))return!0;return!1};if(!Array.prototype.filter)Array.prototype.filter=function(a,c){for(var b=[],
h,f=0,l=this.length>>>0;f<l;f++)f in this&&(h=this[f],a.call(c,h,f,this)&&b.push(h));return b};if(!Array.prototype.reduce)Array.prototype.reduce=function(a){var c=this.length>>>0,b=0,h;if(arguments.length>1)h=arguments[1];else{do{if(b in this){h=this[b++];break}if(++b>=c)throw new TypeError;}while(1)}for(;b<c;b++)b in this&&(h=a.call(null,h,this[b],b,this));return h};g.util.array={invoke:function(e,c){for(var b=a.call(arguments,2),h=[],f=0,l=e.length;f<l;f++)h[f]=b.length?e[f][c].apply(e[f],b):e[f][c].call(e[f]);
return h},min:function(a,c){return d(a,c,function(b,a){return b<a})},max:function(a,c){return d(a,c,function(b,a){return b>=a})}}})();(function(){function d(a,e){for(var c in e)a[c]=e[c];return a}g.util.object={extend:d,clone:function(a){return d({},a)}}})();(function(){if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")};g.util.string={camelize:function(d){return d.replace(/-+(.)?/g,function(a,e){return e?e.toUpperCase():""})},
capitalize:function(d,a){return d.charAt(0).toUpperCase()+(a?d.slice(1):d.slice(1).toLowerCase())},escapeXml:function(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var d=Array.prototype.slice,a=Function.prototype.apply,e=function(){};if(!Function.prototype.bind)Function.prototype.bind=function(c){var b=this,h=d.call(arguments,1),f;f=h.length?function(){return a.call(b,this instanceof e?this:c,h.concat(d.call(arguments)))}:
function(){return a.call(b,this instanceof e?this:c,arguments)};e.prototype=this.prototype;f.prototype=new e;return f}})();(function(){function d(){}function a(b){var a=this.constructor.superclass.prototype[b];return arguments.length>1?a.apply(this,e.call(arguments,1)):a.call(this)}var e=Array.prototype.slice,c=function(){},b=function(){for(var b in{toString:1})if(b==="toString")return!1;return!0}(),h=function(f,a,c){for(var h in a)if(f.prototype[h]=h in f.prototype&&typeof f.prototype[h]==="function"&&
(a[h]+"").indexOf("callSuper")>-1?function(b){return function(){var f=this.constructor.superclass;this.constructor.superclass=c;var h=a[b].apply(this,arguments);this.constructor.superclass=f;if(b!=="initialize")return h}}(h):a[h],b){if(a.toString!==Object.prototype.toString)f.prototype.toString=a.toString;if(a.valueOf!==Object.prototype.valueOf)f.prototype.valueOf=a.valueOf}};g.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var l=null,k=e.call(arguments,0);typeof k[0]===
"function"&&(l=k.shift());b.superclass=l;b.subclasses=[];if(l)d.prototype=l.prototype,b.prototype=new d,l.subclasses.push(b);for(var g=0,m=k.length;g<m;g++)h(b,k[g],l);if(!b.prototype.initialize)b.prototype.initialize=c;b.prototype.constructor=b;b.prototype.callSuper=a;return b}})();(function(){function d(b){var f=Array.prototype.slice.call(arguments,1),a,c,h=f.length;for(c=0;c<h;c++)if(a=typeof b[f[c]],!/^(?:function|object|unknown)$/.test(a))return!1;return!0}function a(f,a){return function(c){a.call(b(f),
c||g.window.event)}}function e(b,f){return function(a){if(m[b]&&m[b][f])for(var c=m[b][f],h=0,e=c.length;h<e;h++)c[h].call(this,a||g.window.event)}}function c(b,f,a){var c=b.type==="touchend"?"changedTouches":"touches";return b[c]&&b[c][0]?b[c][0][f]-(b[c][0][f]-b[c][0][a])||b[a]:b[a]}var b,h,f=function(){var b=0;return function(f){return f.__uniqueID||(f.__uniqueID="uniqueID__"+b++)}}();(function(){var f={};b=function(b){return f[b]};h=function(b,a){f[b]=a}})();var l=d(g.document.documentElement,
"addEventListener","removeEventListener")&&d(g.window,"addEventListener","removeEventListener"),k=d(g.document.documentElement,"attachEvent","detachEvent")&&d(g.window,"attachEvent","detachEvent"),i={},m={};l?(l=function(b,f,a){b.addEventListener(f,a,!1)},k=function(b,f,a){b.removeEventListener(f,a,!1)}):k?(l=function(b,c,e){var l=f(b);h(l,b);i[l]||(i[l]={});i[l][c]||(i[l][c]=[]);e={handler:e,wrappedHandler:a(l,e)};i[l][c].push(e);b.attachEvent("on"+c,e.wrappedHandler)},k=function(b,a,c){var h=f(b),
e;if(i[h]&&i[h][a])for(var l=0,d=i[h][a].length;l<d;l++)if((e=i[h][a][l])&&e.handler===c)b.detachEvent("on"+a,e.wrappedHandler),i[h][a][l]=null}):(l=function(b,a,c){var h=f(b);m[h]||(m[h]={});if(!m[h][a]){m[h][a]=[];var l=b["on"+a];l&&m[h][a].push(l);b["on"+a]=e(h,a)}m[h][a].push(c)},k=function(b,a,c){b=f(b);if(m[b]&&m[b][a])for(var a=m[b][a],b=0,h=a.length;b<h;b++)a[b]===c&&a.splice(b,1)});g.util.addListener=l;g.util.removeListener=k;var o=function(b){return typeof b.clientX!=="unknown"?b.clientX:
0},t=function(b){return typeof b.clientY!=="unknown"?b.clientY:0};g.isTouchSupported&&(o=function(b){return c(b,"pageX","clientX")},t=function(b){return c(b,"pageY","clientY")});g.util.getPointer=function(b,f){b||(b=g.window.event);var a=g.util.getScrollLeftTop(b.target||(typeof b.srcElement!=="unknown"?b.srcElement:null),f);return{x:o(b)+a.left,y:t(b)+a.top}};g.util.object.extend(g.util,g.Observable)})();(function(){var d=g.document.createElement("div"),a=typeof d.style.filter==="string",e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,
c=function(b){return b};typeof d.style.opacity==="string"?c=function(b,a){b.style.opacity=a;return b}:a&&(c=function(b,a){var f=b.style;if(b.currentStyle&&!b.currentStyle.hasLayout)f.zoom=1;e.test(f.filter)?f.filter=f.filter.replace(e,a>=0.9999?"":"alpha(opacity="+a*100+")"):f.filter+=" alpha(opacity="+a*100+")";return b});g.util.setStyle=function(b,a){var f=b.style;if(!f)return b;if(typeof a==="string")return b.style.cssText+=";"+a,a.indexOf("opacity")>-1?c(b,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):
b;for(var e in a)e==="opacity"?c(b,a[e]):f[e==="float"||e==="cssFloat"?typeof f.styleFloat==="undefined"?"cssFloat":"styleFloat":e]=a[e];return b}})();(function(){function d(b,a){var c=g.document.createElement(b),h;for(h in a)h==="class"?c.className=a[h]:h==="for"?c.htmlFor=a[h]:c.setAttribute(h,a[h]);return c}var a=Array.prototype.slice,e,c=function(b){return a.call(b,0)};try{e=c(g.document.childNodes)instanceof Array}catch(b){}e||(c=function(b){for(var a=Array(b.length),c=b.length;c--;)a[c]=b[c];
return a});var h;h=g.document.defaultView&&g.document.defaultView.getComputedStyle?function(b,a){var c=g.document.defaultView.getComputedStyle(b,null);return c?c[a]:s}:function(b,a){var c=b.style[a];!c&&b.currentStyle&&(c=b.currentStyle[a]);return c};(function(){var b=g.document.documentElement.style,a="userSelect"in b?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"";g.util.makeElementUnselectable=function(b){if(typeof b.onselectstart!==
"undefined")b.onselectstart=g.util.falseFunction;if(a)b.style[a]="none";else if(typeof b.unselectable==="string")b.unselectable="on";return b};g.util.makeElementSelectable=function(b){if(typeof b.onselectstart!=="undefined")b.onselectstart=null;if(a)b.style[a]="";else if(typeof b.unselectable==="string")b.unselectable="";return b}})();(function(){g.util.getScript=function(b,a){var c=g.document.getElementsByTagName("head")[0],h=g.document.createElement("script"),e=!0;h.onload=h.onreadystatechange=
function(b){var f;if(e&&!(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"))e=!1,a(b||g.window.event),f=h.onload=h.onreadystatechange=null,h=f};h.src=b;c.appendChild(h)}})();g.util.getById=function(b){return typeof b==="string"?g.document.getElementById(b):b};g.util.toArray=c;g.util.makeElement=d;g.util.addClass=function(b,a){b&&(" "+b.className+" ").indexOf(" "+a+" ")===-1&&(b.className+=(b.className?" ":"")+a)};g.util.wrapElement=function(b,a,c){typeof a===
"string"&&(a=d(a,c));b.parentNode&&b.parentNode.replaceChild(a,b);a.appendChild(b);return a};g.util.getScrollLeftTop=function(b,a){var c,h,e=0,d=0,t=g.document.documentElement,p=g.document.body||{scrollLeft:0,scrollTop:0};for(h=b;b&&b.parentNode&&!c;)b=b.parentNode,b.nodeType===1&&g.util.getElementStyle(b,"position")==="fixed"&&(c=b),b.nodeType===1&&h!==a&&g.util.getElementStyle(b,"position")==="absolute"?d=e=0:b===g.document?(e=p.scrollLeft||t.scrollLeft||0,d=p.scrollTop||t.scrollTop||0):(e+=b.scrollLeft||
0,d+=b.scrollTop||0);return{left:e,top:d}};g.util.getElementOffset=function(b){var a;a=b&&b.ownerDocument;var c={left:0,top:0},e={left:0,top:0},d={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!a)return{left:0,top:0};for(var o in d)e[d[o]]+=parseInt(h(b,o),10)||0;a=a.documentElement;typeof b.getBoundingClientRect!=="undefined"&&(c=b.getBoundingClientRect());b=g.util.getScrollLeftTop(b,null);return{left:c.left+b.left-(a.clientLeft||0)+e.left,top:c.top+b.top-(a.clientTop||
0)+e.top}};g.util.getElementStyle=h})();(function(){function d(){}var a=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(b){}}();g.util.request=function(e,c){c||(c={});var b=c.method?c.method.toUpperCase():"GET",h=c.onComplete||function(){},f=a(),l;f.onreadystatechange=
function(){if(f.readyState===4)h(f),f.onreadystatechange=d};b==="GET"&&(l=null,typeof c.parameters==="string"&&(e=e+(/\?/.test(e)?"&":"?")+c.parameters));f.open(b,e,!0);(b==="POST"||b==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded");f.send(l);return f}})();g.log=function(){};g.warn=function(){};typeof console!=="undefined"&&["log","warn"].forEach(function(d){typeof console[d]!=="undefined"&&console[d].apply&&(g[d]=function(){return console[d].apply(console,arguments)})});
(function(){function d(){return a.apply(g.window,arguments)}var a=g.window.requestAnimationFrame||g.window.webkitRequestAnimationFrame||g.window.mozRequestAnimationFrame||g.window.oRequestAnimationFrame||g.window.msRequestAnimationFrame||function(a){g.window.setTimeout(a,1E3/60)};g.util.animate=function(a){d(function(c){a||(a={});var b=c||+new Date,h=a.duration||500,f=b+h,l,g=a.onChange||function(){},i=a.abort||function(){return!1},m=a.easing||function(b,a,f,c){return-f*Math.cos(b/c*(Math.PI/2))+
f+a},o="startValue"in a?a.startValue:0,c="endValue"in a?a.endValue:100,t=a.byValue||c-o;a.onStart&&a.onStart();(function D(c){l=c||+new Date;c=l>f?h:l-b;i()?a.onComplete&&a.onComplete():(g(m(c,o,t,h)),l>f?a.onComplete&&a.onComplete():d(D))})(b)})};g.util.requestAnimFrame=d})();(function(){function d(b,a,f,c){b<Math.abs(a)?(b=a,c=f/4):c=f/(2*Math.PI)*Math.asin(a/b);return{a:b,c:a,p:f,s:c}}function a(b,a,f){return b.a*Math.pow(2,10*(a-=1))*Math.sin((a*f-b.s)*2*Math.PI/b.p)}function e(b,a,f,e){return f-
c(e-b,0,f,e)+a}function c(b,a,f,c){return(b/=c)<1/2.75?f*7.5625*b*b+a:b<2/2.75?f*(7.5625*(b-=1.5/2.75)*b+0.75)+a:b<2.5/2.75?f*(7.5625*(b-=2.25/2.75)*b+0.9375)+a:f*(7.5625*(b-=2.625/2.75)*b+0.984375)+a}g.util.ease={easeInQuad:function(b,a,f,c){return f*(b/=c)*b+a},easeOutQuad:function(b,a,f,c){return-f*(b/=c)*(b-2)+a},easeInOutQuad:function(b,a,f,c){b/=c/2;return b<1?f/2*b*b+a:-f/2*(--b*(b-2)-1)+a},easeInCubic:function(b,a,f,c){return f*(b/=c)*b*b+a},easeOutCubic:function(b,a,f,c){return f*((b=b/c-
1)*b*b+1)+a},easeInOutCubic:function(b,a,f,c){b/=c/2;return b<1?f/2*b*b*b+a:f/2*((b-=2)*b*b+2)+a},easeInQuart:function(b,a,f,c){return f*(b/=c)*b*b*b+a},easeOutQuart:function(b,a,f,c){return-f*((b=b/c-1)*b*b*b-1)+a},easeInOutQuart:function(b,a,f,c){b/=c/2;return b<1?f/2*b*b*b*b+a:-f/2*((b-=2)*b*b*b-2)+a},easeInQuint:function(b,a,f,c){return f*(b/=c)*b*b*b*b+a},easeOutQuint:function(b,a,f,c){return f*((b=b/c-1)*b*b*b*b+1)+a},easeInOutQuint:function(b,a,f,c){b/=c/2;return b<1?f/2*b*b*b*b*b+a:f/2*((b-=
2)*b*b*b*b+2)+a},easeInSine:function(b,a,f,c){return-f*Math.cos(b/c*(Math.PI/2))+f+a},easeOutSine:function(b,a,f,c){return f*Math.sin(b/c*(Math.PI/2))+a},easeInOutSine:function(b,a,f,c){return-f/2*(Math.cos(Math.PI*b/c)-1)+a},easeInExpo:function(b,a,f,c){return b===0?a:f*Math.pow(2,10*(b/c-1))+a},easeOutExpo:function(b,a,f,c){return b===c?a+f:f*(-Math.pow(2,-10*b/c)+1)+a},easeInOutExpo:function(b,a,f,c){if(b===0)return a;if(b===c)return a+f;b/=c/2;return b<1?f/2*Math.pow(2,10*(b-1))+a:f/2*(-Math.pow(2,
-10*--b)+2)+a},easeInCirc:function(b,a,f,c){return-f*(Math.sqrt(1-(b/=c)*b)-1)+a},easeOutCirc:function(b,a,f,c){return f*Math.sqrt(1-(b=b/c-1)*b)+a},easeInOutCirc:function(b,a,f,c){b/=c/2;return b<1?-f/2*(Math.sqrt(1-b*b)-1)+a:f/2*(Math.sqrt(1-(b-=2)*b)+1)+a},easeInElastic:function(b,c,f,e){var g=0;if(b===0)return c;b/=e;if(b===1)return c+f;g||(g=e*0.3);f=d(f,f,g,1.70158);return-a(f,b,e)+c},easeOutElastic:function(b,a,f,c){var e=0;if(b===0)return a;b/=c;if(b===1)return a+f;e||(e=c*0.3);f=d(f,f,e,
1.70158);return f.a*Math.pow(2,-10*b)*Math.sin((b*c-f.s)*2*Math.PI/f.p)+f.c+a},easeInOutElastic:function(b,c,f,e){var g=0;if(b===0)return c;b/=e/2;if(b===2)return c+f;g||(g=e*0.3*1.5);f=d(f,f,g,1.70158);return b<1?-0.5*a(f,b,e)+c:f.a*Math.pow(2,-10*(b-=1))*Math.sin((b*e-f.s)*2*Math.PI/f.p)*0.5+f.c+c},easeInBack:function(b,a,f,c,e){e===s&&(e=1.70158);return f*(b/=c)*b*((e+1)*b-e)+a},easeOutBack:function(b,a,f,c,e){e===s&&(e=1.70158);return f*((b=b/c-1)*b*((e+1)*b+e)+1)+a},easeInOutBack:function(b,
a,f,c,e){e===s&&(e=1.70158);b/=c/2;return b<1?f/2*b*b*(((e*=1.525)+1)*b-e)+a:f/2*((b-=2)*b*(((e*=1.525)+1)*b+e)+2)+a},easeInBounce:e,easeOutBounce:c,easeInOutBounce:function(b,a,f,l){return b<l/2?e(b*2,0,f,l)*0.5+a:c(b*2-l,0,f,l)*0.5+f*0.5+a}}})();(function(d){function a(b){return b in v?v[b]:b}function e(b,a,f,c){var h=Object.prototype.toString.call(a)==="[object Array]",e;(b==="fill"||b==="stroke")&&a==="none"?a="":b==="strokeDashArray"?a=a.replace(/,/g," ").split(/\s+/).map(function(b){return parseFloat(b)}):
b==="transformMatrix"?a=f&&f.transformMatrix?j(f.transformMatrix,o.parseTransformAttribute(a)):o.parseTransformAttribute(a):b==="visible"?(a=a==="none"||a==="hidden"?!1:!0,f&&f.visible===!1&&(a=!1)):b==="originX"?a=a==="start"?"left":a==="end"?"right":"center":e=h?a.map(z):z(a,c);return!h&&isNaN(e)?a:e}function c(b){for(var a in x)if(b[a]&&typeof b[x[a]]!=="undefined"&&b[a].indexOf("url(")!==0){var f=new o.Color(b[a]);b[a]=f.setAlpha(E(f.getAlpha()*b[x[a]],2)).toRgba()}return b}function b(b,f){var c,
h;b.replace(/;$/,"").split(";").forEach(function(b){b=b.split(":");c=a(b[0].trim().toLowerCase());h=e(c,b[1].trim());f[c]=h})}function h(b,a){var c={},h;for(h in o.cssRules[a]){var e=b,l=h.split(" "),d=void 0,g=!0;if((d=f(e,l.pop()))&&l.length){for(var g=l,i=void 0,k=!0;e.parentNode&&e.parentNode.nodeType===1&&g.length;)k&&(i=g.pop()),e=e.parentNode,k=f(e,i);g=g.length===0}if(d&&g&&l.length===0)for(var m in o.cssRules[a][h])c[m]=o.cssRules[a][h][m]}return c}function f(b,a){var f=b.nodeName,c=b.getAttribute("class"),
h=b.getAttribute("id"),a=a.replace(RegExp("^"+f,"i"),"");h&&a.length&&(a=a.replace(RegExp("#"+h+"(?![a-zA-Z\\-]+)","i"),""));if(c&&a.length){c=c.split(" ");for(h=c.length;h--;)f=RegExp("\\."+c[h]+"(?![a-zA-Z\\-]+)","i"),a=a.replace(f,"")}return a.length===0}function l(b){for(var a=b.getElementsByTagName("use");a.length;){for(var f=a[0],c=f.getAttribute("xlink:href").substr(1),h=f.getAttribute("x")||0,e=f.getAttribute("y")||0,c=b.getElementById(c).cloneNode(!0),h=(c.getAttribute("transform")||"")+
" translate("+h+", "+e+")",e=0,l=f.attributes,d=l.length;e<d;e++){var g=l.item(e);g.nodeName==="x"||g.nodeName==="y"||g.nodeName==="xlink:href"||(g.nodeName==="transform"?h=g.nodeValue+" "+h:c.setAttribute(g.nodeName,g.nodeValue))}c.setAttribute("transform",h);c.setAttribute("instantiated_by_use","1");c.removeAttribute("id");f.parentNode.replaceChild(c,f)}}function g(b,a,f){var c=RegExp("^\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*$"),h=b.getAttribute("viewBox"),
e=1,l=1,d=0,i=0;if(h&&(h=h.match(c)))if(d=-parseFloat(h[1]),i=-parseFloat(h[2]),c=parseFloat(h[3]),h=parseFloat(h[4]),a&&a!==c&&(e=a/c),f&&f!==h&&(l=f/h),l=e=e>l?l:e,e!==1||l!==1||d!==0||i!==0){a="matrix("+e+" 0 0 "+l+" "+d*e+" "+i*l+")";if(b.tagName==="svg"){for(f=b.ownerDocument.createElement("g");b.firstChild!=null;)f.appendChild(b.firstChild);b.appendChild(f)}else f=b,a+=f.getAttribute("transform");f.setAttribute("transform",a)}}function i(b){var a=b.objects,b=b.options,a=a.map(function(b){return o[p(b.type)].fromObject(b)});
return{objects:a,options:b}}function m(b,a,f){a[f]&&a[f].toSVG&&b.push('<pattern x="0" y="0" id="',f,'Pattern" ','width="',a[f].source.width,'" height="',a[f].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',a[f].source.width,'" height="',a[f].source.height,'" xlink:href="',a[f].source.src,'"></image></pattern>')}var o=d.fabric||(d.fabric={}),t=o.util.object.extend,p=o.util.string.capitalize,D=o.util.object.clone,E=o.util.toFixed,z=o.util.parseUnit,j=o.util.multiplyTransformMatrices,
v={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",
"text-anchor":"originX"},x={stroke:"strokeOpacity",fill:"fillOpacity"};o.cssRules={};o.gradientDefs={};o.parseTransformAttribute=function(){function b(a,f){var c=f[0];a[0]=Math.cos(c);a[1]=Math.sin(c);a[2]=-Math.sin(c);a[3]=Math.cos(c)}function a(b,f){var c=f.length===2?f[1]:f[0];b[0]=f[0];b[3]=c}function f(b,a){b[4]=a[0];a.length===2&&(b[5]=a[1])}var c=[1,0,0,1,0,0],h=o.reNum,e="(?:"+("(?:(matrix)\\s*\\(\\s*("+h+")(?:\\s+,?\\s*|,\\s*)("+h+")(?:\\s+,?\\s*|,\\s*)("+h+")(?:\\s+,?\\s*|,\\s*)("+h+")(?:\\s+,?\\s*|,\\s*)("+
h+")(?:\\s+,?\\s*|,\\s*)("+h+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+h+")(?:(?:\\s+,?\\s*|,\\s*)("+h+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+h+")(?:(?:\\s+,?\\s*|,\\s*)("+h+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+h+")(?:(?:\\s+,?\\s*|,\\s*)("+h+")(?:\\s+,?\\s*|,\\s*)("+h+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+h+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+h+")\\s*\\))")+")",l=RegExp("^\\s*(?:"+("(?:"+e+"(?:(?:\\s+,?\\s*|,\\s*)"+e+")*)")+"?)\\s*$"),d=RegExp(e,"g");return function(h){var g=
c.concat(),i=[];if(!h||h&&!l.test(h))return g;h.replace(d,function(h){var l=RegExp(e).exec(h).filter(function(b){return b!==""&&b!=null}),h=l[1],l=l.slice(2).map(parseFloat);switch(h){case "translate":f(g,l);break;case "rotate":l[0]=o.util.degreesToRadians(l[0]);b(g,l);break;case "scale":a(g,l);break;case "skewX":g[2]=Math.tan(o.util.degreesToRadians(l[0]));break;case "skewY":g[1]=Math.tan(o.util.degreesToRadians(l[0]));break;case "matrix":g=l}i.push(g.concat());g=c.concat()});for(h=i[0];i.length>
1;)i.shift(),h=o.util.multiplyTransformMatrices(h,i[0]);return h}}();o.parseSVGDocument=function(){var b=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,a=/^(symbol|image|marker|pattern|view)$/;return function(f,c,h){if(f){l(f);var e=new Date,d=o.Object.__uid++,i=z(f.getAttribute("width")||"100%"),m=z(f.getAttribute("height")||"100%");g(f,i,m);var t=o.util.toArray(f.getElementsByTagName("*"));if(t.length===0&&o.isLikelyNode){for(var t=f.selectNodes('//*[name(.)!="svg"]'),p=[],E=0,
j=t.length;E<j;E++)p[E]=t[E];t=p}t=t.filter(function(f){a.test(f.tagName)&&g(f,0,0);var c;if(c=b.test(f.tagName)){a:{for(c=/^(?:pattern|defs|symbol)$/;f&&(f=f.parentNode);)if(c.test(f.nodeName)&&!f.getAttribute("instantiated_by_use")){f=!0;break a}f=!1}c=!f}return c});if(!t||t&&!t.length)c&&c([],{});else{var F={width:i,height:m,widthAttr:i,heightAttr:m,svgUid:d};o.gradientDefs[d]=o.getGradientDefs(f);o.cssRules[d]=o.getCSSRules(f);o.parseElements(t,function(b){o.documentParsingTime=new Date-e;c&&
c(b,F)},D(F),h)}}}}();var n={has:function(b,a){a(!1)},get:function(){},set:function(){}};t(o,{parseFontDeclaration:function(b,a){var f=b.match("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+o.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+o.reNum+"))?\\s+(.*)");if(f){var c=f[1],h=f[3],e=f[4],l=f[5],f=f[6];if(c)a.fontStyle=c;if(h)a.fontWeight=isNaN(parseFloat(h))?h:parseFloat(h);if(e)a.fontSize=z(e);if(f)a.fontFamily=f;if(l)a.lineHeight=
l==="normal"?1:l}},getGradientDefs:function(b){var a=b.getElementsByTagName("linearGradient"),f=b.getElementsByTagName("radialGradient"),c,h=0,e,l=[],b={},d={};l.length=a.length+f.length;for(c=a.length;c--;)l[h++]=a[c];for(c=f.length;c--;)l[h++]=f[c];for(;h--;)a=l[h],f=a.getAttribute("xlink:href"),e=a.getAttribute("id"),f&&(d[e]=f.substr(1)),b[e]=a;for(e in d){h=b[d[e]].cloneNode(!0);for(a=b[e];h.firstChild;)a.appendChild(h.firstChild)}return b},parseAttributes:function(b,f,l){if(b){var d,g={},i;
typeof l==="undefined"&&(l=b.getAttribute("svgUid"));b.parentNode&&/^symbol|[g|a]$/i.test(b.parentNode.nodeName)&&(g=o.parseAttributes(b.parentNode,f,l));i=g&&g.fontSize||b.getAttribute("font-size")||o.Text.DEFAULT_SVG_FONT_SIZE;f=f.reduce(function(f,c){if(d=b.getAttribute(c))c=a(c),d=e(c,d,g,i),f[c]=d;return f},{});f=t(f,t(h(b,l),o.parseStyleAttribute(b)));f.font&&o.parseFontDeclaration(f.font,f);return c(t(g,f))}},parseElements:function(b,a,f,c){(new o.ElementsParser(b,a,f,c)).parse()},parseStyleAttribute:function(f){var c=
{},f=f.getAttribute("style");if(!f)return c;if(typeof f==="string")b(f,c);else{var h,l,d;for(d in f)typeof f[d]!=="undefined"&&(h=a(d.toLowerCase()),l=e(h,f[d]),c[h]=l)}return c},parsePointsAttribute:function(b){if(!b)return null;var b=b.replace(/,/g," ").trim(),b=b.split(/\s+/),a=[],f,c;f=0;for(c=b.length;f<c;f+=2)a.push({x:parseFloat(b[f]),y:parseFloat(b[f+1])});return a},getCSSRules:function(b){for(var b=b.getElementsByTagName("style"),f={},c,h=0,l=b.length;h<l;h++)c=b[h].textContent,c=c.replace(/\/\*[\s\S]*?\*\//g,
""),c.trim()!==""&&(c=c.match(/[^{]*\{[\s\S]*?\}/g),c=c.map(function(b){return b.trim()}),c.forEach(function(b){for(var b=b.match(/([\s\S]*?)\s*\{([^}]*)\}/),c={},h=b[2].trim().replace(/;$/,"").split(/\s*;\s*/),l=0,d=h.length;l<d;l++){var g=h[l].split(/\s*:\s*/),i=a(g[0]),g=e(i,g[1],g[0]);c[i]=g}b=b[1];b.split(",").forEach(function(b){b=b.replace(/^svg/i,"").trim();b!==""&&(f[b]=o.util.object.clone(c))})}));return f},loadSVGFromURL:function(b,a,f){function c(h){var e=h.responseXML;if(e&&!e.documentElement&&
o.window.ActiveXObject&&h.responseText)e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(h.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""));e&&e.documentElement&&o.parseSVGDocument(e.documentElement,function(f,c){n.set(b,{objects:o.util.array.invoke(f,"toObject"),options:c});a(f,c)},f)}b=b.replace(/^\n\s*/,"").trim();n.has(b,function(f){f?n.get(b,function(b){b=i(b);a(b.objects,b.options)}):new o.util.request(b,{method:"get",onComplete:c})})},loadSVGFromString:function(b,
a,f){var b=b.trim(),c;if(typeof DOMParser!=="undefined"){var h=new DOMParser;h&&h.parseFromString&&(c=h.parseFromString(b,"text/xml"))}else if(o.window.ActiveXObject)c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""));o.parseSVGDocument(c.documentElement,function(b,f){a(b,f)},f)},createSVGFontFacesMarkup:function(b){for(var a="",f=0,c=b.length;f<c;f++)b[f].type==="text"&&b[f].path&&(a+=["@font-face {font-family: ",b[f].fontFamily,"; src: url('",
b[f].path,"')}"].join(""));a&&(a=['<style type="text/css"><![CDATA[',a,"]]\></style>"].join(""));return a},createSVGRefElementsMarkup:function(b){var a=[];m(a,b,"backgroundColor");m(a,b,"overlayColor");return a.join("")}})})(typeof j!=="undefined"?j:this);g.ElementsParser=function(d,a,e,c){this.elements=d;this.callback=a;this.options=e;this.reviver=c;this.svgUid=e&&e.svgUid||0};g.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;
this.createObjects()};g.ElementsParser.prototype.createObjects=function(){for(var d=0,a=this.elements.length;d<a;d++)this.elements[d].setAttribute("svgUid",this.svgUid),function(a,c){setTimeout(function(){a.createObject(a.elements[c],c)},0)}(this,d)};g.ElementsParser.prototype.createObject=function(d,a){var e=g[g.util.string.capitalize(d.tagName)];if(e&&e.fromElement)try{this._createObject(e,d,a)}catch(c){g.log(c)}else this.checkIfDone()};g.ElementsParser.prototype._createObject=function(d,a,e){d.async?
d.fromElement(a,this.createCallback(e,a),this.options):(d=d.fromElement(a,this.options),this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(a,d),this.instances[e]=d,this.checkIfDone())};g.ElementsParser.prototype.createCallback=function(d,a){var e=this;return function(c){e.resolveGradient(c,"fill");e.resolveGradient(c,"stroke");e.reviver&&e.reviver(a,c);e.instances[d]=c;e.checkIfDone()}};g.ElementsParser.prototype.resolveGradient=function(d,a){var e=d.get(a);
/^url\(/.test(e)&&(e=e.slice(5,e.length-1),g.gradientDefs[this.svgUid][e]&&d.set(a,g.Gradient.fromElement(g.gradientDefs[this.svgUid][e],d)))};g.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0)this.instances=this.instances.filter(function(d){return d!=null}),this.callback(this.instances)};(function(d){function a(a,c){this.x=a;this.y=c}d=d.fabric||(d.fabric={});d.Point?d.warn("fabric.Point is already defined"):(d.Point=a,a.prototype={constructor:a,add:function(e){return new a(this.x+
e.x,this.y+e.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(e){return new a(this.x+e,this.y+e)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(e){return new a(this.x-e.x,this.y-e.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},scalarSubtract:function(e){return new a(this.x-e,this.y-e)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(e){return new a(this.x*e,this.y*e)},multiplyEquals:function(a){this.x*=
a;this.y*=a;return this},divide:function(e){return new a(this.x/e,this.y/e)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(e,c){return new a(this.x+(e.x-this.x)*c,this.y+(e.y-this.y)*c)},distanceFrom:function(a){var c=this.x-a.x,a=this.y-
a.y;return Math.sqrt(c*c+a*a)},midPointFrom:function(e){return new a(this.x+(e.x-this.x)/2,this.y+(e.y-this.y)/2)},min:function(e){return new a(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new a(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(a,c){this.x=a;this.y=c},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var c=this.x,b=this.y;this.x=a.x;this.y=a.y;a.x=c;a.y=b}})})(typeof j!=="undefined"?j:this);
(function(d){function a(a){this.status=a;this.points=[]}var e=d.fabric||(d.fabric={});e.Intersection?e.warn("fabric.Intersection is already defined"):(e.Intersection=a,e.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},e.Intersection.intersectLineLine=function(c,b,h,f){var l,d=(f.x-h.x)*(c.y-h.y)-(f.y-h.y)*(c.x-h.x);l=(b.x-c.x)*(c.y-h.y)-(b.y-c.y)*(c.x-h.x);h=(f.y-h.y)*(b.x-c.x)-(f.x-h.x)*(b.y-c.y);h!==0?(d/=h,l/=h,0<=
d&&d<=1&&0<=l&&l<=1?(l=new a("Intersection"),l.points.push(new e.Point(c.x+d*(b.x-c.x),c.y+d*(b.y-c.y)))):l=new a):l=d===0||l===0?new a("Coincident"):new a("Parallel");return l},e.Intersection.intersectLinePolygon=function(c,b,h){for(var f=new a,e=h.length,d=0;d<e;d++){var g=a.intersectLineLine(c,b,h[d],h[(d+1)%e]);f.appendPoints(g.points)}if(f.points.length>0)f.status="Intersection";return f},e.Intersection.intersectPolygonPolygon=function(c,b){for(var h=new a,f=c.length,e=0;e<f;e++){var d=a.intersectLinePolygon(c[e],
c[(e+1)%f],b);h.appendPoints(d.points)}if(h.points.length>0)h.status="Intersection";return h},e.Intersection.intersectPolygonRectangle=function(c,b,h){var f=b.min(h),l=b.max(h),h=new e.Point(l.x,f.y),d=new e.Point(f.x,l.y),b=a.intersectLinePolygon(f,h,c),h=a.intersectLinePolygon(h,l,c),l=a.intersectLinePolygon(l,d,c),c=a.intersectLinePolygon(d,f,c),f=new a;f.appendPoints(b.points);f.appendPoints(h.points);f.appendPoints(l.points);f.appendPoints(c.points);if(f.points.length>0)f.status="Intersection";
return f})})(typeof j!=="undefined"?j:this);(function(d){function a(b){b?this._tryParsingColor(b):this.setSource([0,0,0,1])}function e(b,a,f){f<0&&(f+=1);f>1&&(f-=1);return f<1/6?b+(a-b)*6*f:f<0.5?a:f<2/3?b+(a-b)*(2/3-f)*6:b}var c=d.fabric||(d.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=a,c.Color.prototype={_tryParsingColor:function(b){var c;b in a.colorNameMap&&(b=a.colorNameMap[b]);b==="transparent"?this.setSource([255,255,255,0]):((c=a.sourceFromHex(b))||(c=a.sourceFromRgb(b)),
c||(c=a.sourceFromHsl(b)),c&&this.setSource(c))},_rgbToHsl:function(b,a,f){b/=255;a/=255;f/=255;var e,d,g,m=c.util.array.max([b,a,f]);d=c.util.array.min([b,a,f]);g=(m+d)/2;if(m===d)e=d=0;else{var o=m-d;d=g>0.5?o/(2-m-d):o/(m+d);switch(m){case b:e=(a-f)/o+(a<f?6:0);break;case a:e=(f-b)/o+2;break;case f:e=(b-a)/o+4}e/=6}return[Math.round(e*360),Math.round(d*100),Math.round(g*100)]},getSource:function(){return this._source},setSource:function(b){this._source=b},toRgb:function(){var b=this.getSource();
return"rgb("+b[0]+","+b[1]+","+b[2]+")"},toRgba:function(){var b=this.getSource();return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"},toHsl:function(){var b=this.getSource(),b=this._rgbToHsl(b[0],b[1],b[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var b=this.getSource(),a=this._rgbToHsl(b[0],b[1],b[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+b[3]+")"},toHex:function(){var b=this.getSource(),a,f;a=b[0].toString(16);a=a.length===1?"0"+a:a;f=b[1].toString(16);f=f.length===1?"0"+
f:f;b=b[2].toString(16);b=b.length===1?"0"+b:b;return a.toUpperCase()+f.toUpperCase()+b.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(b){var a=this.getSource();a[3]=b;this.setSource(a);return this},toGrayscale:function(){var b=this.getSource(),a=parseInt((b[0]*0.3+b[1]*0.59+b[2]*0.11).toFixed(0),10);this.setSource([a,a,a,b[3]]);return this},toBlackWhite:function(b){var a=this.getSource(),f=(a[0]*0.3+a[1]*0.59+a[2]*0.11).toFixed(0),a=a[3],f=Number(f)<Number(b||127)?
0:255;this.setSource([f,f,f,a]);return this},overlayWith:function(b){b instanceof a||(b=new a(b));for(var c=[],f=this.getAlpha(),e=this.getSource(),b=b.getSource(),d=0;d<3;d++)c.push(Math.round(e[d]*0.5+b[d]*0.5));c[3]=f;this.setSource(c);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,
c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(b){return a.fromSource(a.sourceFromRgb(b))},c.Color.sourceFromRgb=function(b){if(b=b.match(a.reRGBa)){var c=parseInt(b[1],10)/(/%$/.test(b[1])?
100:1)*(/%$/.test(b[1])?255:1),f=parseInt(b[2],10)/(/%$/.test(b[2])?100:1)*(/%$/.test(b[2])?255:1),e=parseInt(b[3],10)/(/%$/.test(b[3])?100:1)*(/%$/.test(b[3])?255:1);return[parseInt(c,10),parseInt(f,10),parseInt(e,10),b[4]?parseFloat(b[4]):1]}},c.Color.fromRgba=a.fromRgb,c.Color.fromHsl=function(b){return a.fromSource(a.sourceFromHsl(b))},c.Color.sourceFromHsl=function(b){if(b=b.match(a.reHSLa)){var c=(parseFloat(b[1])%360+360)%360/360,f=parseFloat(b[2])/(/%$/.test(b[2])?100:1),l=parseFloat(b[3])/
(/%$/.test(b[3])?100:1);if(f===0)l=f=c=l;else var d=l<=0.5?l*(f+1):l+f-l*f,g=l*2-d,l=e(g,d,c+1/3),f=e(g,d,c),c=e(g,d,c-1/3);return[Math.round(l*255),Math.round(f*255),Math.round(c*255),b[4]?parseFloat(b[4]):1]}},c.Color.fromHsla=a.fromHsl,c.Color.fromHex=function(b){return a.fromSource(a.sourceFromHex(b))},c.Color.sourceFromHex=function(b){if(b.match(a.reHex)){var c=b.slice(b.indexOf("#")+1),f=c.length===3,b=f?c.charAt(0)+c.charAt(0):c.substring(0,2),e=f?c.charAt(1)+c.charAt(1):c.substring(2,4),c=
f?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(b,16),parseInt(e,16),parseInt(c,16),1]}},c.Color.fromSource=function(b){var c=new a;c.setSource(b);return c})})(typeof j!=="undefined"?j:this);(function(){function d(a){var c=a.getAttribute("style"),b=a.getAttribute("offset"),h,f,b=parseFloat(b)/(/%$/.test(b)?100:1),b=b<0?0:b>1?1:b;if(c){c=c.split(/\s*;\s*/);c[c.length-1]===""&&c.pop();for(var l=c.length;l--;){var d=c[l].split(/\s*:\s*/),i=d[0].trim(),d=d[1].trim();i==="stop-color"?h=d:i===
"stop-opacity"&&(f=d)}}h||(h=a.getAttribute("stop-color")||"rgb(0,0,0)");f||(f=a.getAttribute("stop-opacity"));h=new g.Color(h);a=h.getAlpha();f=isNaN(parseFloat(f))?1:parseFloat(f);f*=a;return{offset:b,color:h.toRgb(),opacity:f}}function a(a,c,b){var h,f=0,l=1,d="",g;for(g in c){h=parseFloat(c[g],10);l=typeof c[g]==="string"&&/^\d+%$/.test(c[g])?0.01:1;if(g==="x1"||g==="x2"||g==="r2")l*=b==="objectBoundingBox"?a.width:1,f=b==="objectBoundingBox"?a.left||0:0;else if(g==="y1"||g==="y2")l*=b==="objectBoundingBox"?
a.height:1,f=b==="objectBoundingBox"?a.top||0:0;c[g]=h*l+f}a.type==="ellipse"&&c.r2!==null&&b==="objectBoundingBox"&&a.rx!==a.ry&&(a=a.ry/a.rx,d=" scale(1, "+a+")",c.y1&&(c.y1/=a),c.y2&&(c.y2/=a));return d}g.Gradient=g.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var c={};this.id=g.Object.__uid++;this.type=a.type||"linear";c={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0};if(this.type==="radial")c.r1=a.coords.r1||0,c.r2=a.coords.r2||0;this.coords=
c;this.colorStops=a.colorStops.slice();if(a.gradientTransform)this.gradientTransform=a.gradientTransform;this.offsetX=a.offsetX||this.offsetX;this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var c in a){var b=new g.Color(a[c]);this.colorStops.push({offset:c,color:b.toRgb(),opacity:b.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(a){var c=g.util.object.clone(this.coords),
b;this.colorStops.sort(function(b,a){return b.offset-a.offset});if(!(a.group&&a.group.type==="path-group"))for(var h in c)if(h==="x1"||h==="x2"||h==="r2")c[h]+=this.offsetX-a.width/2;else if(h==="y1"||h==="y2")c[h]+=this.offsetY-a.height/2;a='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(a+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');this.type==="linear"?b=["<linearGradient ",a,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'">\n']:
this.type==="radial"&&(b=["<radialGradient ",a,' cx="',c.x2,'" cy="',c.y2,'" r="',c.r2,'" fx="',c.x1,'" fy="',c.y1,'">\n']);for(c=0;c<this.colorStops.length;c++)b.push("<stop ",'offset="',this.colorStops[c].offset*100+"%",'" style="stop-color:',this.colorStops[c].color,this.colorStops[c].opacity!=null?";stop-opacity: "+this.colorStops[c].opacity:";",'"/>\n');b.push(this.type==="linear"?"</linearGradient>\n":"</radialGradient>\n");return b.join("")},toLive:function(a,c){var b,h=g.util.object.clone(this.coords);
if(this.type){if(c.group&&c.group.type==="path-group")for(var f in h)if(f==="x1"||f==="x2")h[f]+=-this.offsetX+c.width/2;else if(f==="y1"||f==="y2")h[f]+=-this.offsetY+c.height/2;this.type==="linear"?b=a.createLinearGradient(h.x1,h.y1,h.x2,h.y2):this.type==="radial"&&(b=a.createRadialGradient(h.x1,h.y1,h.r1,h.x2,h.y2,h.r2));h=0;for(f=this.colorStops.length;h<f;h++){var l=this.colorStops[h].color,d=this.colorStops[h].opacity,i=this.colorStops[h].offset;typeof d!=="undefined"&&(l=(new g.Color(l)).setAlpha(d).toRgba());
b.addColorStop(parseFloat(i),l)}return b}}});g.util.object.extend(g.Gradient,{fromElement:function(e,c){var b=e.getElementsByTagName("stop"),h=e.nodeName==="linearGradient"?"linear":"radial",f=e.getAttribute("gradientUnits")||"objectBoundingBox",l=e.getAttribute("gradientTransform"),k=[],i={};h==="linear"?i={x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}:h==="radial"&&(i={x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||
e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"});for(var m=b.length;m--;)k.push(d(b[m]));b=a(c,i,f);h=new g.Gradient({type:h,coords:i,colorStops:k,offsetX:-c.left,offsetY:-c.top});if(l||b!=="")h.gradientTransform=g.parseTransformAttribute((l||"")+b);return h},forObject:function(e,c){c||(c={});a(e,c.coords,"userSpaceOnUse");return new g.Gradient(c)}})})();g.Pattern=g.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,
initialize:function(d){d||(d={});this.id=g.Object.__uid++;if(d.source)if(typeof d.source==="string")if(typeof g.util.getFunctionBody(d.source)!=="undefined")this.source=new Function(g.util.getFunctionBody(d.source));else{var a=this;this.source=g.util.createImage();g.util.loadImage(d.source,function(e){a.source=e})}else this.source=d.source;if(d.repeat)this.repeat=d.repeat;if(d.offsetX)this.offsetX=d.offsetX;if(d.offsetY)this.offsetY=d.offsetY},toObject:function(){var d;if(typeof this.source==="function")d=
String(this.source);else if(typeof this.source.src==="string")d=this.source.src;return{source:d,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(d){var a=typeof this.source==="function"?this.source():this.source,e=a.width/d.getWidth(),c=a.height/d.getHeight(),b=this.offsetX/d.getWidth(),d=this.offsetY/d.getHeight(),h="";if(this.repeat==="repeat-x"||this.repeat==="no-repeat")c=1;if(this.repeat==="repeat-y"||this.repeat==="no-repeat")e=1;a.src?h=a.src:a.toDataURL&&(h=a.toDataURL());
return'<pattern id="SVGID_'+this.id+'" x="'+b+'" y="'+d+'" width="'+e+'" height="'+c+'">\n<image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+h+'"></image>\n</pattern>\n'},toLive:function(d){var a=typeof this.source==="function"?this.source():this.source;if(!a)return"";if(typeof a.src!=="undefined"){if(!a.complete)return"";if(a.naturalWidth===0||a.naturalHeight===0)return""}return d.createPattern(a,this.repeat)}});(function(d){var a=d.fabric||(d.fabric={});a.Shadow?a.warn("fabric.Shadow is already defined."):
(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(e){typeof e==="string"&&(e=this._parseShadow(e));for(var c in e)this[c]=e[c];this.id=a.Object.__uid++},_parseShadow:function(e){var e=e.trim(),c=a.Shadow.reOffsetsAndBlur.exec(e)||[];return{color:(e.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(c[1],10)||0,offsetY:parseInt(c[2],10)||0,blur:parseInt(c[3],10)||0}},toString:function(){return[this.offsetX,
this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var c="SourceAlpha",b=40,h=40;if(a&&(a.fill===this.color||a.stroke===this.color))c="SourceGraphic";a.width&&a.height&&(b=Math.abs(this.offsetX/a.getWidth())*100+20,h=Math.abs(this.offsetY/a.getHeight())*100+20);return'<filter id="SVGID_'+this.id+'" y="-'+h+'%" height="'+(100+2*h)+'%" x="-'+b+'%" width="'+(100+2*b)+'%" >\n\t<feGaussianBlur in="'+c+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur>\n\t<feOffset dx="'+this.offsetX+
'" dy="'+this.offsetY+'"></feOffset>\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var e={},c=a.Shadow.prototype;if(this.color!==c.color)e.color=this.color;if(this.blur!==c.blur)e.blur=this.blur;if(this.offsetX!==c.offsetX)e.offsetX=this.offsetX;if(this.offsetY!==c.offsetY)e.offsetY=this.offsetY;
return e}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)})(typeof j!=="undefined"?j:this);(function(){if(g.StaticCanvas)g.warn("fabric.StaticCanvas is already defined.");else{var d=g.util.object.extend,a=g.util.getElementOffset,e=g.util.removeFromArray,c=Error("Could not initialize `canvas` element");g.StaticCanvas=g.util.createClass({initialize:function(b,a){a||(a={});this._initStatic(b,a);g.StaticCanvas.activeInstance=this},
backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(b,a){this._objects=[];this._createLowerCanvas(b);this._initOptions(a);this._setImageSmoothing();a.overlayImage&&this.setOverlayImage(a.overlayImage,this.renderAll.bind(this));
a.backgroundImage&&this.setBackgroundImage(a.backgroundImage,this.renderAll.bind(this));a.backgroundColor&&this.setBackgroundColor(a.backgroundColor,this.renderAll.bind(this));a.overlayColor&&this.setOverlayColor(a.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=a(this.lowerCanvasEl);return this},setOverlayImage:function(b,a,f){return this.__setBgOverlayImage("overlayImage",b,a,f)},setBackgroundImage:function(b,a,f){return this.__setBgOverlayImage("backgroundImage",
b,a,f)},setOverlayColor:function(b,a){return this.__setBgOverlayColor("overlayColor",b,a)},setBackgroundColor:function(b,a){return this.__setBgOverlayColor("backgroundColor",b,a)},_setImageSmoothing:function(){var b=this.getContext();b.imageSmoothingEnabled=this.imageSmoothingEnabled;b.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;b.mozImageSmoothingEnabled=this.imageSmoothingEnabled;b.msImageSmoothingEnabled=this.imageSmoothingEnabled;b.oImageSmoothingEnabled=this.imageSmoothingEnabled},
__setBgOverlayImage:function(b,a,f,c){typeof a==="string"?g.util.loadImage(a,function(a){this[b]=new g.Image(a,c);f&&f()},this,c&&c.crossOrigin):(this[b]=a,f&&f());return this},__setBgOverlayColor:function(b,a,f){if(a&&a.source){var c=this;g.util.loadImage(a.source,function(e){c[b]=new g.Pattern({source:e,repeat:a.repeat,offsetX:a.offsetX,offsetY:a.offsetY});f&&f()})}else this[b]=a,f&&f();return this},_createCanvasElement:function(){var b=g.document.createElement("canvas");if(!b.style)b.style={};
if(!b)throw c;this._initCanvasElement(b);return b},_initCanvasElement:function(b){g.util.createCanvasElement(b);if(typeof b.getContext==="undefined")throw c;},_initOptions:function(b){for(var a in b)this[a]=b[a];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(this.lowerCanvasEl.style)this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=
this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(b){this.lowerCanvasEl=g.util.getById(b)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);g.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(b,a){return this.setDimensions({width:b},
a)},setHeight:function(b,a){return this.setDimensions({height:b},a)},setDimensions:function(b,a){var f,a=a||{},c;for(c in b)f=b[c],a.cssOnly||(this._setBackstoreDimension(c,b[c]),f+="px"),a.backstoreOnly||this._setCssDimension(c,f);a.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(b,a){this.lowerCanvasEl[b]=a;this.upperCanvasEl&&(this.upperCanvasEl[b]=a);this.cacheCanvasEl&&(this.cacheCanvasEl[b]=a);this[b]=a;return this},_setCssDimension:function(b,a){this.lowerCanvasEl.style[b]=
a;this.upperCanvasEl&&(this.upperCanvasEl.style[b]=a);this.wrapperEl&&(this.wrapperEl.style[b]=a);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(b){this.viewportTransform=b;this.renderAll();for(var b=0,a=this._objects.length;b<a;b++)this._objects[b].setCoords();return this},zoomToPoint:function(b,a){var f=b,b=g.util.transformPoint(b,g.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=a;this.viewportTransform[3]=
a;var c=g.util.transformPoint(b,this.viewportTransform);this.viewportTransform[4]+=f.x-c.x;this.viewportTransform[5]+=f.y-c.y;this.renderAll();f=0;for(c=this._objects.length;f<c;f++)this._objects[f].setCoords();return this},setZoom:function(b){this.zoomToPoint(new g.Point(0,0),b);return this},absolutePan:function(b){this.viewportTransform[4]=-b.x;this.viewportTransform[5]=-b.y;this.renderAll();for(var b=0,a=this._objects.length;b<a;b++)this._objects[b].setCoords();return this},relativePan:function(b){return this.absolutePan(new g.Point(-b.x-
this.viewportTransform[4],-b.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(b,a){if(a){b.save();var f=this.viewportTransform;b.transform(f[0],f[1],f[2],f[3],f[4],f[5]);this._shouldRenderObject(a)&&a.render(b);b.restore();this.controlsAboveOverlay||a._renderControls(b)}},_shouldRenderObject:function(b){return!b?!1:b!==this.getActiveGroup()||!this.preserveObjectStacking},_onObjectAdded:function(b){this.stateful&&
b.setupState();b.canvas=this;b.setCoords();this.fire("object:added",{target:b});b.fire("added")},_onObjectRemoved:function(b){this.getActiveObject()===b&&(this.fire("before:selection:cleared",{target:b}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:b});b.fire("removed")},clearContext:function(b){b.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&
this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(b){var a=this[b===!0&&this.interactive?"contextTop":"contextContainer"],f=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);b||this.clearContext(a);this.fire("before:render");this.clipTo&&g.util.clipContext(this,
a);this._renderBackground(a);this._renderObjects(a,f);this._renderActiveGroup(a,f);this.clipTo&&a.restore();this._renderOverlay(a);this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render");return this},_renderObjects:function(b,a){var f,c;if(!a||this.preserveObjectStacking)for(f=0,c=this._objects.length;f<c;++f)this._draw(b,this._objects[f]);else for(f=0,c=this._objects.length;f<c;++f)this._objects[f]&&!a.contains(this._objects[f])&&this._draw(b,this._objects[f])},
_renderActiveGroup:function(b,a){if(a){var f=[];this.forEachObject(function(b){a.contains(b)&&f.push(b)});a._set("objects",f);this._draw(b,a)}},_renderBackground:function(b){if(this.backgroundColor)b.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(b):this.backgroundColor,b.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height);this.backgroundImage&&this._draw(b,this.backgroundImage)},_renderOverlay:function(b){if(this.overlayColor)b.fillStyle=
this.overlayColor.toLive?this.overlayColor.toLive(b):this.overlayColor,b.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height);this.overlayImage&&this._draw(b,this.overlayImage)},renderTop:function(){var b=this.contextTop||this.contextContainer;this.clearContext(b);this.selection&&this._groupSelector&&this._drawSelection();var a=this.getActiveGroup();a&&a.render(b);this._renderOverlay(b);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(b){this._centerObject(b,new g.Point(this.getCenter().left,b.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(b){this._centerObject(b,new g.Point(b.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(b){var a=this.getCenter();this._centerObject(b,new g.Point(a.left,a.top));this.renderAll();return this},_centerObject:function(b,a){b.setPositionByOrigin(a,"center","center");return this},
toDatalessJSON:function(b){return this.toDatalessObject(b)},toObject:function(b){return this._toObjectMethod("toObject",b)},toDatalessObject:function(b){return this._toObjectMethod("toDatalessObject",b)},_toObjectMethod:function(b,a){var f=this.getActiveGroup();f&&this.discardActiveGroup();var c={objects:this._toObjects(b,a)};d(c,this.__serializeBgOverlay());g.util.populateWithProperties(this,c,a);if(f&&(this.setActiveGroup(new g.Group(f.getObjects(),{originX:"center",originY:"center"})),f.forEachObject(function(b){b.set("active",
!0)}),this._currentTransform))this._currentTransform.target=this.getActiveGroup();return c},_toObjects:function(b,a){return this.getObjects().map(function(f){return this._toObject(f,b,a)},this)},_toObject:function(b,a,f){var c;if(!this.includeDefaultValues)c=b.includeDefaultValues,b.includeDefaultValues=!1;a=b[a](f);if(!this.includeDefaultValues)b.includeDefaultValues=c;return a},__serializeBgOverlay:function(){var b={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():
this.backgroundColor};if(this.overlayColor)b.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor;if(this.backgroundImage)b.backgroundImage=this.backgroundImage.toObject();if(this.overlayImage)b.overlayImage=this.overlayImage.toObject();return b},svgViewportTransformation:!0,toSVG:function(b,a){b||(b={});var f=[];this._setSVGPreamble(f,b);this._setSVGHeader(f,b);this._setSVGBgOverlayColor(f,"backgroundColor");this._setSVGBgOverlayImage(f,"backgroundImage");this._setSVGObjects(f,
a);this._setSVGBgOverlayColor(f,"overlayColor");this._setSVGBgOverlayImage(f,"overlayImage");f.push("</svg>");return f.join("")},_setSVGPreamble:function(b,a){a.suppressPreamble||b.push('<?xml version="1.0" encoding="',a.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(b,a){var f,c,e;if(a.viewBox)f=a.viewBox.width,c=a.viewBox.height;else if(f=this.width,c=this.height,!this.svgViewportTransformation)e=
this.viewportTransform,f/=e[0],c/=e[3];b.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',f,'" ','height="',c,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,a.viewBox?'viewBox="'+a.viewBox.x+" "+a.viewBox.y+" "+a.viewBox.width+" "+a.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",g.version,"</desc>","<defs>",g.createSVGFontFacesMarkup(this.getObjects()),
g.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(b,a){var f=this.getActiveGroup();f&&this.discardActiveGroup();for(var c=0,e=this.getObjects(),d=e.length;c<d;c++)b.push(e[c].toSVG(a));f&&(this.setActiveGroup(new g.Group(f.getObjects())),f.forEachObject(function(b){b.set("active",!0)}))},_setSVGBgOverlayImage:function(b,a){this[a]&&this[a].toSVG&&b.push(this[a].toSVG())},_setSVGBgOverlayColor:function(b,a){this[a]&&this[a].source?b.push('<rect x="',this[a].offsetX,'" y="',this[a].offsetY,
'" ','width="',this[a].repeat==="repeat-y"||this[a].repeat==="no-repeat"?this[a].source.width:this.width,'" height="',this[a].repeat==="repeat-x"||this[a].repeat==="no-repeat"?this[a].source.height:this.height,'" fill="url(#'+a+'Pattern)"',"></rect>"):this[a]&&a==="overlayColor"&&b.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[a],'"',"></rect>")},sendToBack:function(b){e(this._objects,b);this._objects.unshift(b);return this.renderAll&&this.renderAll()},bringToFront:function(b){e(this._objects,
b);this._objects.push(b);return this.renderAll&&this.renderAll()},sendBackwards:function(b,a){var f=this._objects.indexOf(b);f!==0&&(f=this._findNewLowerIndex(b,f,a),e(this._objects,b),this._objects.splice(f,0,b),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(b,a,f){if(f){f=a;for(a-=1;a>=0;--a)if(b.intersectsWithObject(this._objects[a])||b.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(b)){f=a;break}}else f=a-1;return f},bringForward:function(b,
a){var f=this._objects.indexOf(b);f!==this._objects.length-1&&(f=this._findNewUpperIndex(b,f,a),e(this._objects,b),this._objects.splice(f,0,b),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(b,a,f){if(f){f=a;for(a+=1;a<this._objects.length;++a)if(b.intersectsWithObject(this._objects[a])||b.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(b)){f=a;break}}else f=a+1;return f},moveTo:function(b,a){e(this._objects,b);this._objects.splice(a,
0,b);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});d(g.StaticCanvas.prototype,g.Observable);d(g.StaticCanvas.prototype,g.Collection);d(g.StaticCanvas.prototype,g.DataURLExporter);d(g.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(b){var a=g.util.createCanvasElement();
if(!a||!a.getContext)return null;var f=a.getContext("2d");if(!f)return null;switch(b){case "getImageData":return typeof f.getImageData!=="undefined";case "setLineDash":return typeof f.setLineDash!=="undefined";case "toDataURL":return typeof a.toDataURL!=="undefined";case "toDataURLWithQuality":try{return a.toDataURL("image/jpeg",0),!0}catch(c){}return!1;default:return null}}});g.StaticCanvas.prototype.toJSON=g.StaticCanvas.prototype.toObject}})();g.BaseBrush=g.util.createClass({color:"rgb(0, 0, 0)",
width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(d){this.shadow=new g.Shadow(d);return this},_setBrushStyles:function(){var d=this.canvas.contextTop;d.strokeStyle=this.color;d.lineWidth=this.width;d.lineCap=this.strokeLineCap;d.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var d=this.canvas.contextTop;d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur;d.shadowOffsetX=this.shadow.offsetX;d.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var d=
this.canvas.contextTop;d.shadowColor="";d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}});(function(){g.PencilBrush=g.util.createClass(g.BaseBrush,{initialize:function(d){this.canvas=d;this._points=[]},onMouseDown:function(d){this._prepareForDrawing(d);this._captureDrawingPath(d);this._render()},onMouseMove:function(d){this._captureDrawingPath(d);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){d=new g.Point(d.x,
d.y);this._reset();this._addPoint(d);this.canvas.contextTop.moveTo(d.x,d.y)},_addPoint:function(d){this._points.push(d)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(d){this._addPoint(new g.Point(d.x,d.y))},_render:function(){var d=this.canvas.contextTop,a=this.canvas.viewportTransform,e=this._points[0],c=this._points[1];d.save();d.transform(a[0],a[1],a[2],a[3],a[4],a[5]);d.beginPath();this._points.length===2&&e.x===c.x&&e.y===c.y&&
(e.x-=0.5,c.x+=0.5);d.moveTo(e.x,e.y);for(var a=1,b=this._points.length;a<b;a++)c=e.midPointFrom(c),d.quadraticCurveTo(e.x,e.y,c.x,c.y),e=this._points[a],c=this._points[a+1];d.lineTo(e.x,e.y);d.stroke();d.restore()},convertPointsToSVGPath:function(d){var a=[],e=new g.Point(d[0].x,d[0].y),c=new g.Point(d[1].x,d[1].y);a.push("M ",d[0].x," ",d[0].y," ");for(var b=1,h=d.length;b<h;b++){var f=e.midPointFrom(c);a.push("Q ",e.x," ",e.y," ",f.x," ",f.y," ");e=new g.Point(d[b].x,d[b].y);b+1<d.length&&(c=new g.Point(d[b+
1].x,d[b+1].y))}a.push("L ",e.x," ",e.y," ");return a},createPath:function(d){d=new g.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,originX:"center",originY:"center"});if(this.shadow)this.shadow.affectStroke=!0,d.setShadow(this.shadow);return d},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var d=this.convertPointsToSVGPath(this._points).join("");d==="M 0 0 Q 0 0 0 0 L 0 0"?this.canvas.renderAll():
(d=this.createPath(d),this.canvas.add(d),d.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:d}))}})})();g.CircleBrush=g.util.createClass(g.BaseBrush,{width:10,initialize:function(d){this.canvas=d;this.points=[]},drawDot:function(d){var d=this.addPoint(d),a=this.canvas.contextTop,e=this.canvas.viewportTransform;a.save();a.transform(e[0],e[1],e[2],e[3],e[4],e[5]);a.fillStyle=d.fill;a.beginPath();a.arc(d.x,
d.y,d.radius,0,Math.PI*2,!1);a.closePath();a.fill();a.restore()},onMouseDown:function(d){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(d)},onMouseMove:function(d){this.drawDot(d)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],e=0,c=this.points.length;e<c;e++){var b=this.points[e],b=new g.Circle({radius:b.radius,left:b.x,top:b.y,originX:"center",originY:"center",fill:b.fill});this.shadow&&
b.setShadow(this.shadow);a.push(b)}a=new g.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},addPoint:function(d){var d=new g.Point(d.x,d.y),a=g.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,e=(new g.Color(this.color)).setAlpha(g.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=
e;this.points.push(d);return d}});g.SprayBrush=g.util.createClass(g.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d;this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(d);this.render()},onMouseMove:function(d){this.addSprayChunk(d);this.render()},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var a=[],e=0,c=this.sprayChunks.length;e<c;e++)for(var b=this.sprayChunks[e],h=0,f=b.length;h<f;h++){var l=new g.Rect({width:b[h].width,height:b[h].width,left:b[h].x+1,top:b[h].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&l.setShadow(this.shadow);a.push(l)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));a=new g.Group(a,{originX:"center",originY:"center"});a.canvas=this.canvas;this.canvas.add(a);this.canvas.fire("path:created",{path:a});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},_getOptimizedRects:function(d){for(var a={},e,c=0,b=d.length;c<b;c++)e=d[c].left+""+d[c].top,a[e]||(a[e]=d[c]);d=[];for(e in a)d.push(a[e]);return d},render:function(){var d=this.canvas.contextTop;d.fillStyle=this.color;var a=this.canvas.viewportTransform;d.save();d.transform(a[0],a[1],a[2],a[3],a[4],a[5]);for(var a=0,e=this.sprayChunkPoints.length;a<e;a++){var c=this.sprayChunkPoints[a];if(typeof c.opacity!=="undefined")d.globalAlpha=
c.opacity;d.fillRect(c.x,c.y,c.width,c.width)}d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];for(var a,e,c,b=this.width/2,h=0;h<this.density;h++){a=g.util.getRandomInt(d.x-b,d.x+b);e=g.util.getRandomInt(d.y-b,d.y+b);c=this.dotWidthVariance?g.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;a=new g.Point(a,e);a.width=c;if(this.randomOpacity)a.opacity=g.util.getRandomInt(0,100)/100;this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}});
g.PatternBrush=g.util.createClass(g.PencilBrush,{getPatternSrc:function(){var d=g.document.createElement("canvas"),a=d.getContext("2d");d.width=d.height=25;a.fillStyle=this.color;a.beginPath();a.arc(10,10,10,0,Math.PI*2,!1);a.closePath();a.fill();return d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(d){d=this.callSuper("createPath",d);d.stroke=new g.Pattern({source:this.source||this.getPatternSrcFunction()});return d}});(function(){var d=g.util.getPointer,a=g.util.degreesToRadians,e=g.util.radiansToDegrees,c=Math.atan2,b=Math.abs;g.Canvas=g.util.createClass(g.StaticCanvas,{initialize:function(b,a){a||(a={});this._initStatic(b,a);this._initInteractive();this._createCacheCanvas();g.Canvas.activeInstance=this},uniScaleTransform:!1,
centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();
this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=g.PencilBrush&&new g.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(b){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,left:a.original.left,top:a.original.top});if(this._shouldCenterTransform(b,a.target))if(a.action==="rotate")this._setOriginToCenter(a.target);else{if(a.originX!=="center")a.mouseXSign=a.originX==="right"?-1:1;if(a.originY!=="center")a.mouseYSign=
a.originY==="bottom"?-1:1;a.originX="center";a.originY="center"}else a.originX=a.original.originX,a.originY=a.original.originY},containsPoint:function(b,a){var c=this.getPointer(b,!0),e=this._normalizePointer(a,c);return a.containsPoint(e)||a._findTargetCorner(c)},_normalizePointer:function(b,a){var c=this.getActiveGroup(),e=a.x,h=a.y;c&&b.type!=="group"&&c.contains(b)&&(c=new g.Point(c.left,c.top),c=g.util.transformPoint(c,this.viewportTransform,!0),e-=c.x,h-=c.y);return{x:e,y:h}},isTargetTransparent:function(b,
a,c){var e=b.hasBorders,h=b.transparentCorners;b.hasBorders=b.transparentCorners=!1;this._draw(this.contextCache,b);b.hasBorders=e;b.transparentCorners=h;b=g.util.isTransparent(this.contextCache,a,c,this.targetFindTolerance);this.clearContext(this.contextCache);return b},_shouldClearSelection:function(b,a){var c=this.getActiveGroup(),e=this.getActiveObject();return!a||a&&c&&!c.contains(a)&&c!==a&&!b.shiftKey||a&&!a.evented||a&&!a.selectable&&e&&e!==a},_shouldCenterTransform:function(b,a){if(a){var c=
this._currentTransform,e;c.action==="scale"||c.action==="scaleX"||c.action==="scaleY"?e=this.centeredScaling||a.centeredScaling:c.action==="rotate"&&(e=this.centeredRotation||a.centeredRotation);return e?!b.altKey:b.altKey}},_getOriginFromCorner:function(b,a){var c={x:b.originX,y:b.originY};if(a==="ml"||a==="tl"||a==="bl")c.x="right";else if(a==="mr"||a==="tr"||a==="br")c.x="left";if(a==="tl"||a==="mt"||a==="tr")c.y="bottom";else if(a==="bl"||a==="mb"||a==="br")c.y="top";return c},_getActionFromCorner:function(b,
a){var c="drag";a&&(c=a==="ml"||a==="mr"?"scaleX":a==="mt"||a==="mb"?"scaleY":a==="mtr"?"rotate":"scale");return c},_setupCurrentTransform:function(b,c){if(c){var e=this.getPointer(b),h=c._findTargetCorner(this.getPointer(b,!0)),d=this._getActionFromCorner(c,h),h=this._getOriginFromCorner(c,h);this._currentTransform={target:c,action:d,scaleX:c.scaleX,scaleY:c.scaleY,offsetX:e.x-c.left,offsetY:e.y-c.top,originX:h.x,originY:h.y,ex:e.x,ey:e.y,left:c.left,top:c.top,theta:a(c.angle),width:c.width*c.scaleX,
mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,originX:h.x,originY:h.y};this._resetCurrentTransform(b)}},_translateObject:function(b,a){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",b-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",a-this._currentTransform.offsetY)},_scaleObject:function(b,a,c){var e=this._currentTransform,h=e.target,d=h.get("lockScalingX"),t=h.get("lockScalingY"),p=h.get("lockScalingFlip");
if(!d||!t){var D=h.translateToOriginPoint(h.getCenterPoint(),e.originX,e.originY),b=h.toLocalPoint(new g.Point(b,a),e.originX,e.originY);this._setLocalMouse(b,e);this._setObjectScale(b,e,d,t,c,p);h.setPositionByOrigin(D,e.originX,e.originY)}},_setObjectScale:function(b,a,c,e,h,d){var g=a.target,p=!1,D=!1,E=g.stroke?g.strokeWidth:0;a.newScaleX=b.x/(g.width+E/2);a.newScaleY=b.y/(g.height+E/2);d&&a.newScaleX<=0&&a.newScaleX<g.scaleX&&(p=!0);d&&a.newScaleY<=0&&a.newScaleY<g.scaleY&&(D=!0);h==="equally"&&
!c&&!e?p||D||this._scaleObjectEqually(b,g,a):h?h==="x"&&!g.get("lockUniScaling")?p||c||g.set("scaleX",a.newScaleX):h==="y"&&!g.get("lockUniScaling")&&(D||e||g.set("scaleY",a.newScaleY)):(p||c||g.set("scaleX",a.newScaleX),D||e||g.set("scaleY",a.newScaleY));p||D||this._flipObject(a,h)},_scaleObjectEqually:function(b,a,c){var b=b.y+b.x,e=a.stroke?a.strokeWidth:0,e=(a.height+e/2)*c.original.scaleY+(a.width+e/2)*c.original.scaleX;c.newScaleX=c.original.scaleX*b/e;c.newScaleY=c.original.scaleY*b/e;a.set("scaleX",
c.newScaleX);a.set("scaleY",c.newScaleY)},_flipObject:function(b,a){if(b.newScaleX<0&&a!=="y")if(b.originX==="left")b.originX="right";else if(b.originX==="right")b.originX="left";if(b.newScaleY<0&&a!=="x")if(b.originY==="top")b.originY="bottom";else if(b.originY==="bottom")b.originY="top"},_setLocalMouse:function(a,c){var e=c.target;if(c.originX==="right")a.x*=-1;else if(c.originX==="center"&&(a.x*=c.mouseXSign*2,a.x<0))c.mouseXSign=-c.mouseXSign;if(c.originY==="bottom")a.y*=-1;else if(c.originY===
"center"&&(a.y*=c.mouseYSign*2,a.y<0))c.mouseYSign=-c.mouseYSign;b(a.x)>e.padding?a.x<0?a.x+=e.padding:a.x-=e.padding:a.x=0;b(a.y)>e.padding?a.y<0?a.y+=e.padding:a.y-=e.padding:a.y=0},_rotateObject:function(b,a){var h=this._currentTransform;if(!h.target.get("lockRotation")){var d=c(h.ey-h.top,h.ex-h.left),g=c(a-h.top,b-h.left),d=e(g-d+h.theta);d<0&&(d=360+d);h.target.angle=d%360}},setCursor:function(b){this.upperCanvasEl.style.cursor=b},_resetObjectTransform:function(b){b.scaleX=1;b.scaleY=1;b.setAngle(0)},
_drawSelection:function(){var a=this.contextTop,c=this._groupSelector,e=c.left,h=c.top,d=b(e),o=b(h);a.fillStyle=this.selectionColor;a.fillRect(c.ex-(e>0?0:-e),c.ey-(h>0?0:-h),d,o);a.lineWidth=this.selectionLineWidth;a.strokeStyle=this.selectionBorderColor;this.selectionDashArray.length>1?(e=c.ex+0.5-(e>0?0:d),c=c.ey+0.5-(h>0?0:o),a.beginPath(),g.util.drawDashedLine(a,e,c,e+d,c,this.selectionDashArray),g.util.drawDashedLine(a,e,c+o-1,e+d,c+o-1,this.selectionDashArray),g.util.drawDashedLine(a,e,c,
e,c+o,this.selectionDashArray),g.util.drawDashedLine(a,e+d-1,c,e+d-1,c+o,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(c.ex+0.5-(e>0?0:d),c.ey+0.5-(h>0?0:o),d,o)},_isLastRenderedObject:function(b){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(b,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(b,
!0))},findTarget:function(b,a){if(!this.skipTargetFind){if(this._isLastRenderedObject(b))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!a&&this.containsPoint(b,c))return c;c=this._searchPossibleTargets(b);this._fireOverOutEvents(c);return c}},_fireOverOutEvents:function(b){if(b){if(this._hoveredTarget!==b)this.fire("mouse:over",{target:b}),b.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),
this._hoveredTarget=b}else if(this._hoveredTarget)this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null},_checkTarget:function(b,a,c){if(a&&a.visible&&a.evented&&this.containsPoint(b,a))if((this.perPixelTargetFind||a.perPixelTargetFind)&&!a.isEditing){if(!this.isTargetTransparent(a,c.x,c.y))return!0}else return!0},_searchPossibleTargets:function(b){for(var a,c=this.getPointer(b,!0),e=this._objects.length;e--;)if(this._checkTarget(b,this._objects[e],
c)){this.relatedTarget=this._objects[e];a=this._objects[e];break}return a},getPointer:function(b,a,c){var e,h;if(!c)c=this.upperCanvasEl;var b=d(b,c),o=c.getBoundingClientRect(),t=o.width||0,p=o.height||0;if(!t||!p)"top"in o&&"bottom"in o&&(p=Math.abs(o.top-o.bottom)),"right"in o&&"left"in o&&(t=Math.abs(o.right-o.left));this.calcOffset();b.x-=this._offset.left;b.y-=this._offset.top;a||(b=g.util.transformPoint(b,g.util.invertTransform(this.viewportTransform)));t===0||p===0?(e=1,h=1):(e=c.width/t,
h=c.height/p);return{x:b.x*e,y:b.y*h}},_createUpperCanvas:function(){var b=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();g.util.addClass(this.upperCanvasEl,"upper-canvas "+b);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();
this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=g.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});g.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});g.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(b){var a=this.getWidth()||b.width,
c=this.getHeight()||b.height;g.util.setStyle(b,{position:"absolute",width:a+"px",height:c+"px",left:0,top:0});b.width=a;b.height=c;g.util.makeElementUnselectable(b)},_copyCanvasStyle:function(b,a){a.style.cssText=b.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(b){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=b;b.set("active",!0)},setActiveObject:function(b,a){this._setActiveObject(b);
this.renderAll();this.fire("object:selected",{target:b,e:a});b.fire("selected",{e:a});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(b){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:b});return this},_setActiveGroup:function(b){(this._activeGroup=b)&&b.set("active",!0)},setActiveGroup:function(b,a){this._setActiveGroup(b);
b&&(this.fire("object:selected",{target:b,e:a}),b.fire("selected",{e:a}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var b=this.getActiveGroup();b&&b.destroy();this.setActiveGroup(null)},discardActiveGroup:function(b){this._discardActiveGroup();this.fire("selection:cleared",{e:b});return this},deactivateAll:function(){for(var b=this.getObjects(),a=0,c=b.length;a<c;a++)b[a].set("active",!1);this._discardActiveGroup();this._discardActiveObject();
return this},deactivateAllWithDispatch:function(b){var a=this.getActiveGroup()||this.getActiveObject();a&&this.fire("before:selection:cleared",{target:a,e:b});this.deactivateAll();a&&this.fire("selection:cleared",{e:b});return this},drawControls:function(b){var a=this.getActiveGroup();a?this._drawGroupControls(b,a):this._drawObjectsControls(b)},_drawGroupControls:function(b,a){a._renderControls(b)},_drawObjectsControls:function(b){for(var a=0,c=this._objects.length;a<c;++a)if(this._objects[a]&&this._objects[a].active)this._objects[a]._renderControls(b),
this.lastRenderedObjectWithControlsAboveOverlay=this._objects[a]}});for(var h in g.StaticCanvas)h!=="prototype"&&(g.Canvas[h]=g.StaticCanvas[h]);if(g.isTouchSupported)g.Canvas.prototype._setCursorFromEvent=function(){};g.Element=g.Canvas})();(function(){var d={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},a=g.util.addListener,e=g.util.removeListener;g.util.object.extend(g.Canvas.prototype,{cursorMap:"n-resize,ne-resize,e-resize,se-resize,s-resize,sw-resize,w-resize,nw-resize".split(","),_initEventListeners:function(){this._bindEvents();
a(g.window,"resize",this._onResize);a(this.upperCanvasEl,"mousedown",this._onMouseDown);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"mousewheel",this._onMouseWheel);a(this.upperCanvasEl,"touchstart",this._onMouseDown);a(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),
Event.add(this.upperCanvasEl,"shake",this._onShake),Event.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=
this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){e(g.window,"resize",this._onResize);e(this.upperCanvasEl,"mousedown",this._onMouseDown);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(this.upperCanvasEl,"mousewheel",this._onMouseWheel);e(this.upperCanvasEl,"touchstart",this._onMouseDown);e(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof Event!=="undefined"&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",
this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake),Event.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,
b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onMouseDown:function(c){this.__onMouseDown(c);a(g.document,"touchend",this._onMouseUp);a(g.document,"touchmove",this._onMouseMove);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(this.upperCanvasEl,"touchmove",this._onMouseMove);c.type==="touchstart"?e(this.upperCanvasEl,"mousedown",this._onMouseDown):
(a(g.document,"mouseup",this._onMouseUp),a(g.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);e(g.document,"mouseup",this._onMouseUp);e(g.document,"touchend",this._onMouseUp);e(g.document,"mousemove",this._onMouseMove);e(g.document,"touchmove",this._onMouseMove);a(this.upperCanvasEl,"mousemove",this._onMouseMove);a(this.upperCanvasEl,"touchmove",this._onMouseMove);if(c.type==="touchend"){var b=this;setTimeout(function(){a(b.upperCanvasEl,"mousedown",b._onMouseDown)},
400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var e=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==e)||!a&&e||!a&&!e&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);
else{this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var e=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a);if(b)b.isMoving=!1;e&&this.renderAll();this._handleCursorAndEvent(a,b)}},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var e=this;setTimeout(function(){e._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=
this._currentTransform.target;if(a._scaling)a._scaling=!1;a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},
_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&g.util.clipContext(this,this.contextTop);var b=g.util.invertTransform(this.viewportTransform);this.freeDrawingBrush.onMouseDown(g.util.transformPoint(this.getPointer(a,!0),b));this.fire("mouse:down",{e:a});b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mousedown",{e:a,target:b})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=g.util.invertTransform(this.viewportTransform);
this.freeDrawingBrush.onMouseMove(g.util.transformPoint(this.getPointer(a,!0),b))}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:a});b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mousemove",{e:a,target:b})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);typeof b!=="undefined"&&b.fire("mouseup",{e:a,target:b})},__onMouseDown:function(a){if(("which"in
a?a.which===1:a.button===1)||g.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var b=this.findTarget(a),e=this.getPointer(a,!0);this._previousPointer=e;var f=this._shouldRender(b,e),d=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,e):d&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&!d&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));f&&this.renderAll();this.fire("mouse:down",
{target:b,e:a});b&&b.fire("mousedown",{e:a})}},_beforeTransform:function(a,b){this.stateful&&b.saveState();if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,e){this.deactivateAllWithDispatch(a);if(b&&b.selectable)this.setActiveObject(b,a);else if(this.selection)this._groupSelector={ex:e.x,ey:e.y,top:0,left:0}},_setOriginToCenter:function(a){this._previousOriginX=
this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=
null},__onMouseMove:function(a){var b,e;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(!(typeof a.touches!=="undefined"&&a.touches.length>1)){var f=this._groupSelector;f?(e=this.getPointer(a,!0),f.left=e.x-f.ex,f.top=e.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b));this.fire("mouse:move",{target:b,e:a});b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=
this.getPointer(a),e=this._currentTransform;e.reset=!1;e.target.isMoving=!0;this._beforeScaleTransform(a,e);this._performTransformAction(a,e,b);this.renderAll()},_performTransformAction:function(a,b,e){var f=e.x,e=e.y,d=b.target,g=b.action;g==="rotate"?(this._rotateObject(f,e),this._fire("rotating",d,a)):g==="scale"?(this._onScale(a,b,f,e),this._fire("scaling",d,a)):g==="scaleX"?(this._scaleObject(f,e,"x"),this._fire("scaling",d,a)):g==="scaleY"?(this._scaleObject(f,e,"y"),this._fire("scaling",d,
a)):(this._translateObject(f,e),this._fire("moving",d,a),this.setCursor(this.moveCursor))},_fire:function(a,b,e){this.fire("object:"+a,{target:b,e:e});b.fire(a,{e:e})},_beforeScaleTransform:function(a,b){if(b.action==="scale"||b.action==="scaleX"||b.action==="scaleY"){var e=this._shouldCenterTransform(a,b.target);if(e&&(b.originX!=="center"||b.originY!=="center")||!e&&b.originX==="center"&&b.originY==="center")this._resetCurrentTransform(a),b.reset=!0}},_onScale:function(a,b,e,f){(a.shiftKey||this.uniScaleTransform)&&
!b.target.get("lockUniScaling")?(b.currentAction="scale",this._scaleObject(e,f)):(!b.reset&&b.currentAction==="scale"&&this._resetCurrentTransform(a,b.target),b.currentAction="scaleEqually",this._scaleObject(e,f,"equally"))},_setCursorFromEvent:function(a,b){if(!b||!b.selectable)return this.setCursor(this.defaultCursor),!1;else{var e=this.getActiveGroup();(e=b._findTargetCorner&&(!e||!e.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(e,b):this.setCursor(b.hoverCursor||
this.hoverCursor)}return!0},_setCornerCursor:function(a,b){if(a in d)this.setCursor(this._getRotatedCornerCursor(a,b));else if(a==="mtr"&&b.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(a,b){var e=Math.round(b.getAngle()%360/45);e<0&&(e+=8);e+=d[a];e%=8;return this.cursorMap[e]}})})();(function(){var d=Math.min,a=Math.max;g.util.object.extend(g.Canvas.prototype,{_shouldGroup:function(a,c){var b=this.getActiveObject();
return a.shiftKey&&(this.getActiveGroup()||b&&b!==c)&&this.selection},_handleGrouping:function(a,c){if(c===this.getActiveGroup()&&(c=this.findTarget(a,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,a):this._createActiveGroup(c,a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,c){var b=this.getActiveGroup();if(b.contains(a)){if(b.removeWithUpdate(a),this._resetObjectTransform(b),a.set("active",!1),b.size()===1){this.discardActiveGroup(c);
this.setActiveObject(b.item(0));return}}else b.addWithUpdate(a),this._resetObjectTransform(b);this.fire("selection:created",{target:b,e:c});b.set("active",!0)},_createActiveGroup:function(a,c){if(this._activeObject&&a!==this._activeObject){var b=this._createGroup(a);b.addWithUpdate();this.setActiveGroup(b);this._activeObject=null;this.fire("selection:created",{target:b,e:c})}a.set("active",!0)},_createGroup:function(a){var c=this.getObjects(),a=c.indexOf(this._activeObject)<c.indexOf(a)?[this._activeObject,
a]:[a,this._activeObject];return new g.Group(a,{canvas:this})},_groupSelectedObjects:function(a){var c=this._collectObjects();c.length===1?this.setActiveObject(c[0],a):c.length>1&&(c=new g.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,a),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var e=[],c;c=this._groupSelector.ex;for(var b=this._groupSelector.ey,h=c+this._groupSelector.left,f=b+this._groupSelector.top,l=new g.Point(d(c,
h),d(b,f)),k=new g.Point(a(c,h),a(b,f)),b=c===h&&b===f,h=this._objects.length;h--;)if((c=this._objects[h])&&c.selectable&&c.visible&&(c.intersectsWithRect(l,k)||c.isContainedWithinRect(l,k)||c.containsPoint(l)||c.containsPoint(k)))if(c.set("active",!0),e.push(c),b)break;return e},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=
this._groupSelector=null}})})();g.util.object.extend(g.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var a=d.format||"png",e=d.quality||1,c=d.multiplier||1,d={left:d.left,top:d.top,width:d.width,height:d.height};return c!==1?this.__toDataURLWithMultiplier(a,e,d,c):this.__toDataURL(a,e,d)},__toDataURL:function(d,a,e){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl,e=this.__getCroppedCanvas(c,e);d==="jpg"&&(d="jpeg");d=g.StaticCanvas.supports("toDataURLWithQuality")?(e||c).toDataURL("image/"+
d,a):(e||c).toDataURL("image/"+d);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},__getCroppedCanvas:function(d,a){var e,c;if("left"in a||"top"in a||"width"in a||"height"in a)e=g.util.createCanvasElement(),c=e.getContext("2d"),e.width=a.width||this.width,e.height=a.height||this.height,c.drawImage(d,-a.left||0,-a.top||0);return e},__toDataURLWithMultiplier:function(d,a,e,c){var b=this.getWidth(),h=this.getHeight(),f=b*c,l=h*c,g=this.getActiveObject(),i=this.getActiveGroup(),
m=this.contextTop||this.contextContainer;c>1&&this.setWidth(f).setHeight(l);m.scale(c,c);e.left&&(e.left*=c);e.top&&(e.top*=c);if(e.width)e.width*=c;else if(c<1)e.width=f;if(e.height)e.height*=c;else if(c<1)e.height=l;i?this._tempRemoveBordersControlsFromGroup(i):g&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);d=this.__toDataURL(d,a,e);this.width=b;this.height=h;m.scale(1/c,1/c);this.setWidth(b).setHeight(h);i?this._restoreBordersControlsOnGroup(i):g&&this.setActiveObject&&this.setActiveObject(g);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},toDataURLWithMultiplier:function(d,a,e){return this.toDataURL({format:d,multiplier:a,quality:e})},_tempRemoveBordersControlsFromGroup:function(d){d.origHasControls=d.hasControls;d.origBorderColor=d.borderColor;d.hasControls=!0;d.borderColor="rgba(0,0,0,0)";d.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(d){d.hideControls=d.origHideControls;
d.borderColor=d.origBorderColor;d.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});g.util.object.extend(g.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,a,e){return this.loadFromJSON(d,a,e)},loadFromJSON:function(d,a,e){if(d){var c=typeof d==="string"?JSON.parse(d):d;this.clear();var b=this;this._enlivenObjects(c.objects,function(){b._setBgOverlay(c,a)},e);return this}},_setBgOverlay:function(d,a){var e=this,c={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,
overlayImage:!1};if(!d.backgroundImage&&!d.overlayImage&&!d.background&&!d.overlay)a&&a();else{var b=function(){c.backgroundImage&&c.overlayImage&&c.backgroundColor&&c.overlayColor&&(e.renderAll(),a&&a())};this.__setBgOverlay("backgroundImage",d.backgroundImage,c,b);this.__setBgOverlay("overlayImage",d.overlayImage,c,b);this.__setBgOverlay("backgroundColor",d.background,c,b);this.__setBgOverlay("overlayColor",d.overlay,c,b);b()}},__setBgOverlay:function(d,a,e,c){var b=this;if(a)if(d==="backgroundImage"||
d==="overlayImage")g.Image.fromObject(a,function(a){b[d]=a;e[d]=!0;c&&c()});else this["set"+g.util.string.capitalize(d,!0)](a,function(){e[d]=!0;c&&c()});else e[d]=!0},_enlivenObjects:function(d,a,e){var c=this;if(!d||d.length===0)a&&a();else{var b=this.renderOnAddRemove;this.renderOnAddRemove=!1;g.util.enlivenObjects(d,function(e){e.forEach(function(b,a){c.insertAt(b,a,!0)});c.renderOnAddRemove=b;a&&a()},null,e)}},_toDataURL:function(d,a){this.clone(function(e){a(e.toDataURL(d))})},_toDataURLWithMultiplier:function(d,
a,e){this.clone(function(c){e(c.toDataURLWithMultiplier(d,a))})},clone:function(d,a){var e=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(a){a.loadFromJSON(e,function(){d&&d(a)})})},cloneWithoutData:function(d){var a=g.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var e=new g.Canvas(a);e.clipTo=this.clipTo;this.backgroundImage?(e.setBackgroundImage(this.backgroundImage.src,function(){e.renderAll();d&&d(e)}),e.backgroundImageOpacity=this.backgroundImageOpacity,
e.backgroundImageStretch=this.backgroundImageStretch):d&&d(e)}});(function(d){var a=d.fabric||(d.fabric={}),d=a.util.object.extend,e=a.util.toFixed,c=a.util.string.capitalize,b=a.util.degreesToRadians,h=a.StaticCanvas.supports("setLineDash");if(!a.Object)a.Object=a.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",
cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,
includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(b){b&&this.setOptions(b)},_initGradient:function(b){b.fill&&
b.fill.colorStops&&!(b.fill instanceof a.Gradient)&&this.set("fill",new a.Gradient(b.fill))},_initPattern:function(b){b.fill&&b.fill.source&&!(b.fill instanceof a.Pattern)&&this.set("fill",new a.Pattern(b.fill));b.stroke&&b.stroke.source&&!(b.stroke instanceof a.Pattern)&&this.set("stroke",new a.Pattern(b.stroke))},_initClipping:function(b){if(b.clipTo&&typeof b.clipTo==="string"&&(b=a.util.getFunctionBody(b.clipTo),typeof b!=="undefined"))this.clipTo=new Function("ctx",b)},setOptions:function(b){for(var a in b)this.set(a,
b[a]);this._initGradient(b);this._initPattern(b);this._initClipping(b)},transform:function(a,c){this.group&&this.group.transform(a,c);var e=c?this._getLeftTopCoords():this.getCenterPoint();a.translate(e.x,e.y);a.rotate(b(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(b){var c=a.Object.NUM_FRACTION_DIGITS,c={type:this.type,originX:this.originX,originY:this.originY,left:e(this.left,c),top:e(this.top,c),width:e(this.width,c),height:e(this.height,
c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:e(this.strokeWidth,c),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:e(this.strokeMiterLimit,c),scaleX:e(this.scaleX,c),scaleY:e(this.scaleY,c),angle:e(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:e(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?
this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(c=this._removeDefaultValues(c));a.util.populateWithProperties(this,c,b);return c},toDatalessObject:function(b){return this.toObject(b)},_removeDefaultValues:function(b){var c=a.util.getKlass(b.type).prototype;c.stateProperties.forEach(function(a){b[a]===c[a]&&delete b[a]});
return b},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(b){return this[b]},_setObject:function(b){for(var a in b)this._set(a,b[a])},set:function(b,a){typeof b==="object"?this._setObject(b):typeof a==="function"&&b!=="clipTo"?this._set(b,a(this.get(b))):this._set(b,a);return this},_set:function(b,c){(b==="scaleX"||b==="scaleY")&&(c=this._constrainScale(c));b==="scaleX"&&c<0?(this.flipX=!this.flipX,c*=-1):b==="scaleY"&&c<0?(this.flipY=!this.flipY,c*=-1):b==="width"||b==="height"?
this.minScaleLimit=e(Math.min(0.1,1/Math.max(this.width,this.height)),2):b==="shadow"&&c&&!(c instanceof a.Shadow)&&(c=new a.Shadow(c));this[b]=c;return this},toggle:function(b){var a=this.get(b);typeof a==="boolean"&&this.set(b,!a);return this},setSourcePath:function(b){this.sourcePath=b;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(b,c){!(this.width===0&&this.height===0)&&this.visible&&
(b.save(),this._setupCompositeOperation(b),c||this.transform(b),this._setStrokeStyles(b),this._setFillStyles(b),this.group&&this.group.type==="path-group"&&b.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._setOpacity(b),this._setShadow(b),this.clipTo&&a.util.clipContext(this,b),this._render(b,c),this.clipTo&&b.restore(),this._removeShadow(b),this._restoreCompositeOperation(b),b.restore())},_setOpacity:function(b){this.group&&
this.group._setOpacity(b);b.globalAlpha*=this.opacity},_setStrokeStyles:function(b){if(this.stroke)b.lineWidth=this.strokeWidth,b.lineCap=this.strokeLineCap,b.lineJoin=this.strokeLineJoin,b.miterLimit=this.strokeMiterLimit,b.strokeStyle=this.stroke.toLive?this.stroke.toLive(b,this):this.stroke},_setFillStyles:function(b){if(this.fill)b.fillStyle=this.fill.toLive?this.fill.toLive(b,this):this.fill},_renderControls:function(f,c){var e=this.getViewportTransform();f.save();if(this.active&&!c){var h;this.group&&
(h=a.util.transformPoint(this.group.getCenterPoint(),e),f.translate(h.x,h.y),f.rotate(b(this.group.angle)));h=a.util.transformPoint(this.getCenterPoint(),e,null!=this.group);this.group&&(h.x*=this.group.scaleX,h.y*=this.group.scaleY);f.translate(h.x,h.y);f.rotate(b(this.angle));this.drawBorders(f);this.drawControls(f)}f.restore()},_setShadow:function(b){if(this.shadow){var a=this.canvas&&this.canvas._currentMultiplier||1;b.shadowColor=this.shadow.color;b.shadowBlur=this.shadow.blur*a*(this.scaleX+
this.scaleY)/2;b.shadowOffsetX=this.shadow.offsetX*a*this.scaleX;b.shadowOffsetY=this.shadow.offsetY*a*this.scaleY}},_removeShadow:function(b){if(this.shadow)b.shadowColor="",b.shadowBlur=b.shadowOffsetX=b.shadowOffsetY=0},_renderFill:function(b){this.fill&&(b.save(),this.fill.gradientTransform&&b.transform.apply(b,this.fill.gradientTransform),this.fill.toLive&&b.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),this.fillRule==="evenodd"?b.fill("evenodd"):b.fill(),
b.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(b))},_renderStroke:function(b){this.stroke&&this.strokeWidth!==0&&(b.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),h?(b.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(b)):this._renderDashedStroke&&this._renderDashedStroke(b),b.stroke()):(this.stroke.gradientTransform&&b.transform.apply(b,this.stroke.gradientTransform),this._stroke?
this._stroke(b):b.stroke()),this._removeShadow(b),b.restore())},clone:function(b,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),b):new a.Object(this.toObject(c))},cloneAsImage:function(b){var c=this.toDataURL();a.util.loadImage(c,function(c){b&&b(new a.Image(c))});return this},toDataURL:function(b){b||(b={});var c=a.util.createCanvasElement(),e=this.getBoundingRect();c.width=e.width;c.height=e.height;a.util.wrapElement(c,"div");e=new a.Canvas(c);if(b.format==="jpg")b.format=
"jpeg";if(b.format==="jpeg")e.backgroundColor="#fff";var h={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new a.Point(c.width/2,c.height/2),"center","center");c=this.canvas;e.add(this);b=e.toDataURL(b);this.set(h).setCoords();this.canvas=c;e.dispose();return b},isType:function(b){return this.type===b},complexity:function(){return 0},toJSON:function(b){return this.toObject(b)},setGradient:function(b,c){c||(c={});var e={colorStops:[]};
e.type=c.type||(c.r1||c.r2?"radial":"linear");e.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)e.coords.r1=c.r1,e.coords.r2=c.r2;for(var h in c.colorStops){var d=new a.Color(c.colorStops[h]);e.colorStops.push({offset:h,color:d.toRgb(),opacity:d.getAlpha()})}return this.set(b,a.Gradient.forObject(this,e))},setPatternFill:function(b){return this.set("fill",new a.Pattern(b))},setShadow:function(b){return this.set("shadow",b?new a.Shadow(b):null)},setColor:function(b){this.set("fill",b);return this},
setAngle:function(b){var a=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;a&&this._setOriginToCenter();this.set("angle",b);a&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(b,a){var a=a||this.canvas.getPointer(b),c=this.translateToOriginPoint(this.getCenterPoint(),
"left","top");return{x:a.x-c.x,y:a.y-c.y}},_setupCompositeOperation:function(b){if(this.globalCompositeOperation)this._prevGlobalCompositeOperation=b.globalCompositeOperation,b.globalCompositeOperation=this.globalCompositeOperation},_restoreCompositeOperation:function(b){if(this.globalCompositeOperation&&this._prevGlobalCompositeOperation)b.globalCompositeOperation=this._prevGlobalCompositeOperation}}),a.util.createAccessors(a.Object),a.Object.prototype.rotate=a.Object.prototype.setAngle,d(a.Object.prototype,
a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.__uid=0})(typeof j!=="undefined"?j:this);(function(){var d=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{translateToCenterPoint:function(a,e,c){var b=a.x,h=a.y,f=this.stroke?this.strokeWidth:0;e==="left"?b=a.x+(this.getWidth()+f*this.scaleX)/2:e==="right"&&(b=a.x-(this.getWidth()+f*this.scaleX)/2);c==="top"?h=a.y+(this.getHeight()+f*this.scaleY)/2:c==="bottom"&&(h=a.y-(this.getHeight()+f*this.scaleY)/2);return g.util.rotatePoint(new g.Point(b,
h),a,d(this.angle))},translateToOriginPoint:function(a,e,c){var b=a.x,h=a.y,f=this.stroke?this.strokeWidth:0;e==="left"?b=a.x-(this.getWidth()+f*this.scaleX)/2:e==="right"&&(b=a.x+(this.getWidth()+f*this.scaleX)/2);c==="top"?h=a.y-(this.getHeight()+f*this.scaleY)/2:c==="bottom"&&(h=a.y+(this.getHeight()+f*this.scaleY)/2);return g.util.rotatePoint(new g.Point(b,h),a,d(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new g.Point(this.left,this.top),this.originX,this.originY)},
getPointByOrigin:function(a,e){return this.translateToOriginPoint(this.getCenterPoint(),a,e)},toLocalPoint:function(a,e,c){var b=this.getCenterPoint(),h=this.stroke?this.strokeWidth:0;e&&c?(e=e==="left"?b.x-(this.getWidth()+h*this.scaleX)/2:e==="right"?b.x+(this.getWidth()+h*this.scaleX)/2:b.x,c=c==="top"?b.y-(this.getHeight()+h*this.scaleY)/2:c==="bottom"?b.y+(this.getHeight()+h*this.scaleY)/2:b.y):(e=this.left,c=this.top);return g.util.rotatePoint(new g.Point(a.x,a.y),b,-d(this.angle)).subtractEquals(new g.Point(e,
c))},setPositionByOrigin:function(a,e,c){a=this.translateToOriginPoint(this.translateToCenterPoint(a,e,c),this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(a){var e=d(this.angle),c=this.getWidth()/2,b=Math.cos(e)*c;c*=Math.sin(e);var h=this.getWidth(),f=Math.cos(e)*h,e=Math.sin(e)*h;this.originX==="center"&&a==="left"||this.originX==="right"&&a==="center"?(this.left-=b,this.top-=c):this.originX==="left"&&a==="center"||this.originX==="center"&&a==="right"?
(this.left+=b,this.top+=c):this.originX==="left"&&a==="right"?(this.left+=f,this.top+=e):this.originX==="right"&&a==="left"&&(this.left-=f,this.top-=e);this.setCoords();this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);
this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var d=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{oCoords:null,intersectsWithRect:function(a,e){var c=this.oCoords,b=new g.Point(c.tl.x,c.tl.y),h=new g.Point(c.tr.x,c.tr.y),f=new g.Point(c.bl.x,c.bl.y),c=new g.Point(c.br.x,
c.br.y);return g.Intersection.intersectPolygonRectangle([b,h,c,f],a,e).status==="Intersection"},intersectsWithObject:function(a){function e(b){return{tl:new g.Point(b.tl.x,b.tl.y),tr:new g.Point(b.tr.x,b.tr.y),bl:new g.Point(b.bl.x,b.bl.y),br:new g.Point(b.br.x,b.br.y)}}var c=e(this.oCoords),a=e(a.oCoords);return g.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinObject:function(a){var e=a.getBoundingRect(),a=new g.Point(e.left,
e.top),e=new g.Point(e.left+e.width,e.top+e.height);return this.isContainedWithinRect(a,e)},isContainedWithinRect:function(a,e){var c=this.getBoundingRect();return c.left>=a.x&&c.left+c.width<=e.x&&c.top>=a.y&&c.top+c.height<=e.y},containsPoint:function(a){var e=this._getImageLines(this.oCoords),a=this._findCrossPoints(a,e);return a!==0&&a%2===1},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,
e){var c,b,h,f=0,d;for(d in e)if(h=e[d],!(h.o.y<a.y&&h.d.y<a.y)&&!(h.o.y>=a.y&&h.d.y>=a.y)&&(h.o.x===h.d.x&&h.o.x>=a.x?c=h.o.x:(c=(h.d.y-h.o.y)/(h.d.x-h.o.x),b=a.y-0*a.x,h=h.o.y-c*h.o.x,c=-(b-h)/(0-c)),c>=a.x&&(f+=1),f===2))break;return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],
e=g.util.array.min(a),a=g.util.array.max(a),a=Math.abs(e-a),c=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],b=g.util.array.min(c),c=g.util.array.max(c),c=Math.abs(b-c);return{left:e,top:b,width:a,height:c}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);if(a<0)this.flipX=
!this.flipX,this.flipY=!this.flipY,a*=-1;this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var e=this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/e)},scaleToHeight:function(a){var e=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/e)},setCoords:function(){var a=this.strokeWidth,e=d(this.angle),c=this.getViewportTransform(),b=function(b){return g.util.transformPoint(b,c)},h=this.width,f=this.height,l=this.strokeLineCap===
"round"||this.strokeLineCap==="square",k=this.type==="line"&&this.width===0,i=this.type==="line"&&this.height===0,m=k||i;k?h=a:i&&(f=a);(l&&i||!m)&&(h+=h>0?a:-a);(l&&k||!m)&&(f+=f>0?a:-a);this.currentWidth=h*this.scaleX;this.currentHeight=f*this.scaleY;if(this.currentWidth<0)this.currentWidth=Math.abs(this.currentWidth);f=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));a=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0);h=
Math.cos(a+e)*f;f*=Math.sin(a+e);var i=Math.sin(e),m=Math.cos(e),l=this.getCenterPoint(),o=new g.Point(this.currentWidth,this.currentHeight),t=new g.Point(l.x-h,l.y-f),p=new g.Point(t.x+o.x*m,t.y+o.x*i),D=new g.Point(t.x-o.y*i,t.y+o.y*m),E=new g.Point(t.x+o.x/2*m,t.y+o.x/2*i),h=b(t),f=b(p),l=b(new g.Point(p.x-o.y*i,p.y+o.y*m)),k=b(D),t=b(new g.Point(t.x-o.y/2*i,t.y+o.y/2*m)),z=b(E),p=b(new g.Point(p.x-o.y/2*i,p.y+o.y/2*m)),i=b(new g.Point(D.x+o.x/2*m,D.y+o.x/2*i)),b=b(new g.Point(E.x,E.y)),m=Math.cos(a+
e)*this.padding*Math.sqrt(2),e=Math.sin(a+e)*this.padding*Math.sqrt(2),h=h.add(new g.Point(-m,-e)),f=f.add(new g.Point(e,-m)),l=l.add(new g.Point(m,e)),k=k.add(new g.Point(-e,m)),t=t.add(new g.Point((-m-e)/2,(-e+m)/2)),z=z.add(new g.Point((e-m)/2,-(e+m)/2)),p=p.add(new g.Point((e+m)/2,(e-m)/2)),i=i.add(new g.Point((m-e)/2,(m+e)/2)),b=b.add(new g.Point((e-m)/2,-(e+m)/2));this.oCoords={tl:h,tr:f,br:l,bl:k,ml:t,mt:z,mr:p,mb:i,mtr:b};this._setCornerCoords&&this._setCornerCoords();return this}})})();g.util.object.extend(g.Object.prototype,
{sendToBack:function(){this.group?g.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?g.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(d){this.group?g.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas.sendBackwards(this,d);return this},bringForward:function(d){this.group?g.StaticCanvas.prototype.bringForward.call(this.group,
this,d):this.canvas.bringForward(this,d);return this},moveTo:function(d){this.group?g.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas.moveTo(this,d);return this}});g.util.object.extend(g.Object.prototype,{getSvgStyles:function(){var d=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",a=this.fillRule,e=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",c=this.strokeWidth?this.strokeWidth:"0",b=this.strokeDashArray?this.strokeDashArray.join(" "):
"";return["stroke: ",e,"; stroke-width: ",c,"; stroke-dasharray: ",b,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",d,"; fill-rule: ",a,"; opacity: ",typeof this.opacity!=="undefined"?this.opacity:"1",";",this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},
getSvgTransform:function(){if(this.group&&this.group.type==="path-group")return"";var d=g.util.toFixed,a=this.getAngle(),e=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],c=g.util.transformPoint(this.getCenterPoint(),e),b=g.Object.NUM_FRACTION_DIGITS,c=this.type==="path-group"?"":"translate("+d(c.x,b)+" "+d(c.y,b)+")",a=a!==0?" rotate("+d(a,b)+")":"",d=this.scaleX===1&&this.scaleY===1&&e[0]===1&&e[3]===1?"":" scale("+d(this.scaleX*e[0],b)+" "+d(this.scaleY*
e[3],b)+")",b=this.type==="path-group"?this.width*e[0]:0,e=this.type==="path-group"?this.height*e[3]:0;return[c,a,d,this.flipX?" matrix(-1 0 0 1 "+b+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+e+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_createBaseSVGMarkup:function(){var d=[];this.fill&&this.fill.toLive&&d.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&d.push(this.stroke.toSVG(this,!1));this.shadow&&
d.push(this.shadow.toSVG(this));return d}});g.util.object.extend(g.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(d){return this.get(d)!==this.originalState[d]},this)},saveState:function(d){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);d&&d.stateProperties&&d.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var d=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var e=a.x,a=a.y,c,b;for(b in this.oCoords)if(this.isControlVisible(b)&&(b!=="mtr"||this.hasRotatingPoint))if(!this.get("lockUniScaling")||!(b==="mt"||b==="mr"||b==="mb"||b==="ml"))if(c=this._getImageLines(this.oCoords[b].corner),c=this._findCrossPoints({x:e,y:a},c),c!==0&&c%2===1)return this.__corner=b;return!1},_setCornerCoords:function(){var a=
this.oCoords,e=d(this.angle),c=d(45-this.angle),b=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,h=b*Math.cos(c),c=b*Math.sin(c),b=Math.sin(e),e=Math.cos(e);a.tl.corner={tl:{x:a.tl.x-c,y:a.tl.y-h},tr:{x:a.tl.x+h,y:a.tl.y-c},bl:{x:a.tl.x-h,y:a.tl.y+c},br:{x:a.tl.x+c,y:a.tl.y+h}};a.tr.corner={tl:{x:a.tr.x-c,y:a.tr.y-h},tr:{x:a.tr.x+h,y:a.tr.y-c},br:{x:a.tr.x+c,y:a.tr.y+h},bl:{x:a.tr.x-h,y:a.tr.y+c}};a.bl.corner={tl:{x:a.bl.x-c,y:a.bl.y-h},bl:{x:a.bl.x-h,y:a.bl.y+c},br:{x:a.bl.x+c,y:a.bl.y+h},tr:{x:a.bl.x+
h,y:a.bl.y-c}};a.br.corner={tr:{x:a.br.x+h,y:a.br.y-c},bl:{x:a.br.x-h,y:a.br.y+c},br:{x:a.br.x+c,y:a.br.y+h},tl:{x:a.br.x-c,y:a.br.y-h}};a.ml.corner={tl:{x:a.ml.x-c,y:a.ml.y-h},tr:{x:a.ml.x+h,y:a.ml.y-c},bl:{x:a.ml.x-h,y:a.ml.y+c},br:{x:a.ml.x+c,y:a.ml.y+h}};a.mt.corner={tl:{x:a.mt.x-c,y:a.mt.y-h},tr:{x:a.mt.x+h,y:a.mt.y-c},bl:{x:a.mt.x-h,y:a.mt.y+c},br:{x:a.mt.x+c,y:a.mt.y+h}};a.mr.corner={tl:{x:a.mr.x-c,y:a.mr.y-h},tr:{x:a.mr.x+h,y:a.mr.y-c},bl:{x:a.mr.x-h,y:a.mr.y+c},br:{x:a.mr.x+c,y:a.mr.y+h}};
a.mb.corner={tl:{x:a.mb.x-c,y:a.mb.y-h},tr:{x:a.mb.x+h,y:a.mb.y-c},bl:{x:a.mb.x-h,y:a.mb.y+c},br:{x:a.mb.x+c,y:a.mb.y+h}};a.mtr.corner={tl:{x:a.mtr.x-c+b*this.rotatingPointOffset,y:a.mtr.y-h-e*this.rotatingPointOffset},tr:{x:a.mtr.x+h+b*this.rotatingPointOffset,y:a.mtr.y-c-e*this.rotatingPointOffset},bl:{x:a.mtr.x-h+b*this.rotatingPointOffset,y:a.mtr.y+c-e*this.rotatingPointOffset},br:{x:a.mtr.x+c+b*this.rotatingPointOffset,y:a.mtr.y+h-e*this.rotatingPointOffset}}},drawBorders:function(a){if(!this.hasBorders)return this;
var e=this.padding,c=e*2,b=this.getViewportTransform();a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var h=1/this._constrainScale(this.scaleX),f=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;var d=this.getWidth(),k=this.getHeight(),i=this.strokeWidth,m=this.strokeLineCap==="round"||this.strokeLineCap==="square",o=this.type==="line"&&this.width===0,t=this.type==="line"&&this.height===0,p=o||t;o?d=i/h:t&&(k=i/f);(m&&t||
!p)&&(d+=i/h);(m&&o||!p)&&(k+=i/f);h=g.util.transformPoint(new g.Point(d,k),b,!0);b=h.x;h=h.y;this.group&&(b*=this.group.scaleX,h*=this.group.scaleY);a.strokeRect(~~(-(b/2)-e)-0.5,~~(-(h/2)-e)-0.5,~~(b+c)+1,~~(h+c)+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(e=(-h-e*2)/2,a.beginPath(),a.moveTo(0,e),a.lineTo(0,e-this.rotatingPointOffset),a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;
var e=this.cornerSize,c=e/2,b=this.getViewportTransform(),h=this.strokeWidth,f=this.width,d=this.height,k=this.strokeLineCap==="round"||this.strokeLineCap==="square",i=this.type==="line"&&this.width===0,m=this.type==="line"&&this.height===0,o=i||m;i?f=h:m&&(d=h);(k&&m||!o)&&(f+=h);(k&&i||!o)&&(d+=h);f*=this.scaleX;d*=this.scaleY;h=g.util.transformPoint(new g.Point(f,d),b,!0);b=h.x;h=h.y;f=-(b/2);d=-(h/2);k=this.padding;e=c-e;i=this.transparentCorners?"strokeRect":"fillRect";a.save();a.lineWidth=1;
a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,i,f-c-k,d-c-k);this._drawControl("tr",a,i,f+b-c+k,d-c-k);this._drawControl("bl",a,i,f-c-k,d+h+e+k);this._drawControl("br",a,i,f+b+e+k,d+h+e+k);this.get("lockUniScaling")||(this._drawControl("mt",a,i,f+b/2-c,d-c-k),this._drawControl("mb",a,i,f+b/2-c,d+h+e+k),this._drawControl("mr",a,i,f+b+e+k,d+h/2-c),this._drawControl("ml",a,i,f-c-k,d+h/2-c));this.hasRotatingPoint&&this._drawControl("mtr",
a,i,f+b/2-c,d-this.rotatingPointOffset-this.cornerSize/2-k);a.restore();return this},_drawControl:function(a,e,c,b,h){var f=this.cornerSize;this.isControlVisible(a)&&(typeof G_vmlCanvasManager!=="undefined"||this.transparentCorners||e.clearRect(b,h,f,f),e[c](b,h,f,f))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,e){this._getControlsVisibility()[a]=e;return this},setControlsVisibility:function(a){a||(a={});for(var e in a)this.setControlVisible(e,
a[e]);return this},_getControlsVisibility:function(){if(!this._controlsVisibility)this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0};return this._controlsVisibility}})})();g.util.object.extend(g.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,a){var a=a||{},e=function(){},c=a.onComplete||e,b=a.onChange||e,h=this;g.util.animate({startValue:d.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){d.set("left",a);h.renderAll();
b()},onComplete:function(){d.setCoords();c()}});return this},fxCenterObjectV:function(d,a){var a=a||{},e=function(){},c=a.onComplete||e,b=a.onChange||e,h=this;g.util.animate({startValue:d.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){d.set("top",a);h.renderAll();b()},onComplete:function(){d.setCoords();c()}});return this},fxRemove:function(d,a){var a=a||{},e=function(){},c=a.onComplete||e,b=a.onChange||e,h=this;g.util.animate({startValue:d.get("opacity"),
endValue:0,duration:this.FX_DURATION,onStart:function(){d.set("active",!1)},onChange:function(a){d.set("opacity",a);h.renderAll();b()},onComplete:function(){h.remove(d);c()}});return this}});g.util.object.extend(g.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var d=[],a,e;for(a in arguments[0])d.push(a);for(var c=0,b=d.length;c<b;c++)a=d[c],e=c!==b-1,this._animate(a,arguments[0][a],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(d,
a,e,c){var b=this,h,a=a.toString(),e=e?g.util.object.clone(e):{};~d.indexOf(".")&&(h=d.split("."));var f=h?this.get(h[0])[h[1]]:this.get(d);if(!("from"in e))e.from=f;a=~a.indexOf("=")?f+parseFloat(a.replace("=","")):parseFloat(a);g.util.animate({startValue:e.from,endValue:a,byValue:e.by,easing:e.easing,duration:e.duration,abort:e.abort&&function(){return e.abort.call(b)},onChange:function(a){h?b[h[0]][h[1]]=a:b.set(d,a);c||e.onChange&&e.onChange()},onComplete:function(){c||(b.setCoords(),e.onComplete&&
e.onComplete())}})}});(function(d){function a(b,a){var c=b.origin,e=b.axis1,h=b.axis2,d=b.dimension,g=a.nearest,p=a.center,D=a.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(e),this.get(h));case p:return Math.min(this.get(e),this.get(h))+0.5*this.get(d);case D:return Math.max(this.get(e),this.get(h))}}}var e=d.fabric||(d.fabric={}),c=e.util.object.extend,b={x1:1,x2:1,y1:1,y2:1},h=e.StaticCanvas.supports("setLineDash");e.Line?e.warn("fabric.Line is already defined"):
(e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(b,a){a=a||{};b||(b=[0,0,0,0]);this.callSuper("initialize",a);this.set("x1",b[0]);this.set("y1",b[1]);this.set("x2",b[2]);this.set("y2",b[3]);this._setWidthHeight(a)},_setWidthHeight:function(b){b||(b={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in b?b.left:this._getLeftToOriginX();this.top="top"in b?b.top:this._getTopToOriginY()},_set:function(a,c){this.callSuper("_set",
a,c);typeof b[a]!=="undefined"&&this._setWidthHeight();return this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(b,a){b.beginPath();if(a){var c=this.getCenterPoint();b.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&
h)c=this.calcLinePoints(),b.moveTo(c.x1,c.y1),b.lineTo(c.x2,c.y2);b.lineWidth=this.strokeWidth;c=b.strokeStyle;b.strokeStyle=this.stroke||b.fillStyle;this.stroke&&this._renderStroke(b);b.strokeStyle=c},_renderDashedStroke:function(b){var a=this.calcLinePoints();b.beginPath();e.util.drawDashedLine(b,a.x1,a.y1,a.x2,a.y2,this.strokeDashArray);b.closePath()},toObject:function(b){return c(this.callSuper("toObject",b),this.calcLinePoints())},calcLinePoints:function(){var b=this.x1<=this.x2?-1:1,a=this.y1<=
this.y2?-1:1;return{x1:b*this.width*0.5,x2:b*this.width*-0.5,y1:a*this.height*0.5,y2:a*this.height*-0.5}},toSVG:function(b){var a=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&this.group.type==="path-group"||(c=this.calcLinePoints());a.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return b?b(a.join("")):a.join("")},complexity:function(){return 1}}),
e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(b,a){var h=e.parseAttributes(b,e.Line.ATTRIBUTE_NAMES);return new e.Line([h.x1||0,h.y1||0,h.x2||0,h.y2||0],c(h,a))},e.Line.fromObject=function(b){return new e.Line([b.x1,b.y1,b.x2,b.y2],b)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=Math.PI,c=a.util.object.extend;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",
radius:0,startAngle:0,endAngle:e*2,initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("radius",b.radius||0);this.startAngle=b.startAngle||this.startAngle;this.endAngle=b.endAngle||this.endAngle},_set:function(b,a){this.callSuper("_set",b,a);b==="radius"&&this.setRadius(a);return this},toObject:function(b){return c(this.callSuper("toObject",b),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=0,
d=0,g=(this.endAngle-this.startAngle)%(2*e);if(g===0)this.group&&this.group.type==="path-group"&&(c=this.left+this.radius,d=this.top+this.radius),a.push("<circle ",'cx="'+c+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var c=Math.cos(this.startAngle)*this.radius,d=Math.sin(this.startAngle)*this.radius,i=Math.cos(this.endAngle)*this.radius,m=Math.sin(this.endAngle)*this.radius;a.push('<path d="M '+
c+" "+d," A "+this.radius+" "+this.radius," 0 ",+(g>e?1:0)+" 1"," "+i+" "+m,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return b?b(a.join("")):a.join("")},_render:function(b,a){b.beginPath();b.arc(a?this.left+this.radius:0,a?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(b);this._renderStroke(b)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*
this.get("scaleY")},setRadius:function(b){this.radius=b;this.set("width",b*2).set("height",b*2)},complexity:function(){return 1}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(b,e){e||(e={});var f=a.parseAttributes(b,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&f.radius>0))throw Error("value of `r` attribute is required and can not be negative");f.left=f.left||0;f.top=f.top||0;f=new a.Circle(c(f,e));f.left-=f.radius;f.top-=f.radius;return f},
a.Circle.fromObject=function(b){return new a.Circle(b)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var c=this.width/2,b=this.height/2;a.beginPath();a.moveTo(-c,b);a.lineTo(0,-b);a.lineTo(c,b);a.closePath();this._renderFill(a);
this._renderStroke(a)},_renderDashedStroke:function(e){var c=this.width/2,b=this.height/2;e.beginPath();a.util.drawDashedLine(e,-c,b,0,-b,this.strokeDashArray);a.util.drawDashedLine(e,0,-b,c,b,this.strokeDashArray);a.util.drawDashedLine(e,c,b,-c,b,this.strokeDashArray);e.closePath()},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=this.width/2,h=this.height/2,b=[-b+" "+h,"0 "+-h,b+" "+h].join(",");c.push("<polygon ",'points="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),
'"/>');return a?a(c.join("")):c.join("")},complexity:function(){return 1}}),a.Triangle.fromObject=function(e){return new a.Triangle(e)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=Math.PI*2,c=a.util.object.extend;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("rx",b.rx||0);this.set("ry",b.ry||0)},_set:function(b,a){this.callSuper("_set",
b,a);switch(b){case "rx":this.rx=a;this.set("width",a*2);break;case "ry":this.ry=a,this.set("height",a*2)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(b){return c(this.callSuper("toObject",b),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=0,e=0;this.group&&this.group.type==="path-group"&&(c=this.left+this.rx,e=this.top+this.ry);a.push("<ellipse ",'cx="',
c,'" cy="',e,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return b?b(a.join("")):a.join("")},_render:function(b,a){b.beginPath();b.save();b.transform(1,0,0,this.ry/this.rx,0,0);b.arc(a?this.left+this.rx:0,a?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,e,!1);b.restore();this._renderFill(b);this._renderStroke(b)},complexity:function(){return 1}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),
a.Ellipse.fromElement=function(b,e){e||(e={});var f=a.parseAttributes(b,a.Ellipse.ATTRIBUTE_NAMES);f.left=f.left||0;f.top=f.top||0;f=new a.Ellipse(c(f,e));f.top-=f.ry;f.left-=f.rx;return f},a.Ellipse.fromObject=function(b){return new a.Ellipse(b)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Rect?console.warn("fabric.Rect is already defined"):(d=a.Object.prototype.stateProperties.concat(),d.push("rx","ry","x","y"),a.Rect=a.util.createClass(a.Object,
{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){if(this.rx&&!this.ry)this.ry=this.rx;else if(this.ry&&!this.rx)this.rx=this.ry},_render:function(a,b){if(this.width===1&&this.height===1)a.fillRect(0,0,1,1);else{var e=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,g=this.height,i=b?this.left:-this.width/2,m=b?this.top:-this.height/2,o=
e!==0||f!==0;a.beginPath();a.moveTo(i+e,m);a.lineTo(i+d-e,m);o&&a.bezierCurveTo(i+d-0.4477152502*e,m,i+d,m+0.4477152502*f,i+d,m+f);a.lineTo(i+d,m+g-f);o&&a.bezierCurveTo(i+d,m+g-0.4477152502*f,i+d-0.4477152502*e,m+g,i+d-e,m+g);a.lineTo(i+e,m+g);o&&a.bezierCurveTo(i+0.4477152502*e,m+g,i,m+g-0.4477152502*f,i,m+g-f);a.lineTo(i,m+f);o&&a.bezierCurveTo(i,m+0.4477152502*f,i+0.4477152502*e,m,i+e,m);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(c){var b=-this.width/
2,e=-this.height/2,f=this.width,d=this.height;c.beginPath();a.util.drawDashedLine(c,b,e,b+f,e,this.strokeDashArray);a.util.drawDashedLine(c,b+f,e,b+f,e+d,this.strokeDashArray);a.util.drawDashedLine(c,b+f,e+d,b,e+d,this.strokeDashArray);a.util.drawDashedLine(c,b,e+d,b,e,this.strokeDashArray);c.closePath()},toObject:function(a){a=e(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),
e=this.left,f=this.top;this.group&&this.group.type==="path-group"||(e=-this.width/2,f=-this.height/2);b.push("<rect ",'x="',e,'" y="',f,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=
function(c,b){if(!c)return null;var b=b||{},h=a.parseAttributes(c,a.Rect.ATTRIBUTE_NAMES);h.left=h.left||0;h.top=h.top||0;return new a.Rect(e(b?a.util.object.clone(b):{},h))},a.Rect.fromObject=function(c){return new a.Rect(c)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(e,c){return a.Polygon.prototype.initialize.call(this,
e,c)},_calcDimensions:function(){return a.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return a.Polygon.prototype._applyPointOffset.call(this)},toObject:function(e){return a.Polygon.prototype.toObject.call(this,e)},toSVG:function(e){return a.Polygon.prototype.toSVG.call(this,e)},_render:function(e){a.Polygon.prototype.commonRender.call(this,e);this._renderFill(e);this._renderStroke(e)},_renderDashedStroke:function(e){var c,b;e.beginPath();for(var h=0,f=this.points.length;h<
f;h++)c=this.points[h],b=this.points[h+1]||c,a.util.drawDashedLine(e,c.x,c.y,b.x,b.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElement=function(e,c){if(!e)return null;c||(c={});var b=a.parsePointsAttribute(e.getAttribute("points")),h=a.parseAttributes(e,a.Polyline.ATTRIBUTE_NAMES);return b===null?null:new a.Polyline(b,a.util.object.extend(h,c))},a.Polyline.fromObject=function(e){return new a.Polyline(e.points,
e,!0)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,h=a.util.toFixed;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(b,a){a=a||{};this.points=b;this.callSuper("initialize",a);this._calcDimensions();if(!("top"in a))this.top=this.minY;if(!("left"in a))this.left=this.minX},_calcDimensions:function(){var a=
this.points,e=c(a,"x"),h=c(a,"y"),d=b(a,"x"),a=b(a,"y");this.width=d-e||1;this.height=a-h||1;this.minX=e;this.minY=h},_applyPointOffset:function(){this.points.forEach(function(b){b.x-=this.minX+this.width/2;b.y-=this.minY+this.height/2},this)},toObject:function(b){return e(this.callSuper("toObject",b),{points:this.points.concat()})},toSVG:function(b){for(var a=[],c=this._createBaseSVGMarkup(),e=0,d=this.points.length;e<d;e++)a.push(h(this.points[e].x,2),",",h(this.points[e].y,2)," ");c.push("<",this.type,
" ",'points="',a.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return b?b(c.join("")):c.join("")},_render:function(b){this.commonRender(b);this._renderFill(b);if(this.stroke||this.strokeDashArray)b.closePath(),this._renderStroke(b)},commonRender:function(b){var a;b.beginPath();if(this._applyPointOffset)this.group&&this.group.type==="path-group"||this._applyPointOffset(),this._applyPointOffset=null;b.moveTo(this.points[0].x,
this.points[0].y);for(var c=0,e=this.points.length;c<e;c++)a=this.points[c],b.lineTo(a.x,a.y)},_renderDashedStroke:function(b){a.Polyline.prototype._renderDashedStroke.call(this,b);b.closePath()},complexity:function(){return this.points.length}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=function(b,c){if(!b)return null;c||(c={});var h=a.parsePointsAttribute(b.getAttribute("points")),d=a.parseAttributes(b,a.Polygon.ATTRIBUTE_NAMES);return h===null?null:new a.Polygon(h,
e(d,c))},a.Polygon.fromObject=function(b){return new a.Polygon(b.points,b,!0)})})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.array.min,c=a.util.array.max,b=a.util.object.extend,h=Object.prototype.toString,f=a.util.drawArc,l={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},g={m:"l",M:"L"};a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(b,a){a=a||{};this.setOptions(a);if(!b)throw Error("`path` argument is required");
var c=h.call(b)==="[object Array]";if(this.path=c?b:b.match&&b.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)){if(!c)this.path=this._parsePath();c=this._parseDimensions();this.minX=c.left;this.minY=c.top;this.width=c.width;this.height=c.height;c.left+=this.originX==="center"?this.width/2:this.originX==="right"?this.width:0;c.top+=this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0;this.top=this.top||c.top;this.left=this.left||c.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/
2,y:this.minY+this.height/2};a.sourcePath&&this.setSourcePath(a.sourcePath)}},_render:function(b){var a,c=null,e=0,h=0,d=0,l=0,g=0,k=0,j,x,n,B,r=-this.pathOffset.x,q=-this.pathOffset.y;this.group&&this.group.type==="path-group"&&(q=r=0);b.beginPath();for(var w=0,C=this.path.length;w<C;++w){a=this.path[w];switch(a[0]){case "l":d+=a[1];l+=a[2];b.lineTo(d+r,l+q);break;case "L":d=a[1];l=a[2];b.lineTo(d+r,l+q);break;case "h":d+=a[1];b.lineTo(d+r,l+q);break;case "H":d=a[1];b.lineTo(d+r,l+q);break;case "v":l+=
a[1];b.lineTo(d+r,l+q);break;case "V":l=a[1];b.lineTo(d+r,l+q);break;case "m":d+=a[1];l+=a[2];e=d;h=l;b.moveTo(d+r,l+q);break;case "M":d=a[1];l=a[2];e=d;h=l;b.moveTo(d+r,l+q);break;case "c":j=d+a[5];x=l+a[6];g=d+a[3];k=l+a[4];b.bezierCurveTo(d+a[1]+r,l+a[2]+q,g+r,k+q,j+r,x+q);d=j;l=x;break;case "C":d=a[5];l=a[6];g=a[3];k=a[4];b.bezierCurveTo(a[1]+r,a[2]+q,g+r,k+q,d+r,l+q);break;case "s":j=d+a[3];x=l+a[4];g=g?2*d-g:d;k=k?2*l-k:l;b.bezierCurveTo(g+r,k+q,d+a[1]+r,l+a[2]+q,j+r,x+q);g=d+a[1];k=l+a[2];
d=j;l=x;break;case "S":j=a[3];x=a[4];g=2*d-g;k=2*l-k;b.bezierCurveTo(g+r,k+q,a[1]+r,a[2]+q,j+r,x+q);d=j;l=x;g=a[1];k=a[2];break;case "q":j=d+a[3];x=l+a[4];g=d+a[1];k=l+a[2];b.quadraticCurveTo(g+r,k+q,j+r,x+q);d=j;l=x;break;case "Q":j=a[3];x=a[4];b.quadraticCurveTo(a[1]+r,a[2]+q,j+r,x+q);d=j;l=x;g=a[1];k=a[2];break;case "t":j=d+a[1];x=l+a[2];c[0].match(/[QqTt]/)===null?(g=d,k=l):c[0]==="t"?(g=2*d-n,k=2*l-B):c[0]==="q"&&(g=2*d-g,k=2*l-k);n=g;B=k;b.quadraticCurveTo(g+r,k+q,j+r,x+q);d=j;l=x;g=d+a[1];
k=l+a[2];break;case "T":j=a[1];x=a[2];g=2*d-g;k=2*l-k;b.quadraticCurveTo(g+r,k+q,j+r,x+q);d=j;l=x;break;case "a":f(b,d+r,l+q,[a[1],a[2],a[3],a[4],a[5],a[6]+d+r,a[7]+l+q]);d+=a[6];l+=a[7];break;case "A":f(b,d+r,l+q,[a[1],a[2],a[3],a[4],a[5],a[6]+r,a[7]+q]);d=a[6];l=a[7];break;case "z":case "Z":d=e,l=h,b.closePath()}c=a}this._renderFill(b);this._renderStroke(b)},render:function(b,c){this.visible&&(b.save(),this._setupCompositeOperation(b),c||this.transform(b),this._setStrokeStyles(b),this._setFillStyles(b),
this.group&&this.group.type==="path-group"&&b.translate(-this.group.width/2,-this.group.height/2),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._setOpacity(b),this._setShadow(b),this.clipTo&&a.util.clipContext(this,b),this._render(b,c),this.clipTo&&b.restore(),this._removeShadow(b),this._restoreCompositeOperation(b),b.restore())},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=b(this.callSuper("toObject",
a),{path:this.path.map(function(b){return b.slice()}),pathOffset:this.pathOffset});if(this.sourcePath)a.sourcePath=this.sourcePath;if(this.transformMatrix)a.transformMatrix=this.transformMatrix;return a},toDatalessObject:function(b){b=this.toObject(b);if(this.sourcePath)b.path=this.sourcePath;delete b.sourcePath;return b},toSVG:function(b){for(var a=[],c=this._createBaseSVGMarkup(),f="",e=0,h=this.path.length;e<h;e++)a.push(this.path[e].join(" "));a=a.join(" ");this.group&&this.group.type==="path-group"||
(f="translate("+-this.pathOffset.x+", "+-this.pathOffset.y+")");c.push("<path ",'d="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),f,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return b?b(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var b=[],a=[],c,f,e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,h,d=0,z=this.path.length;d<z;d++){c=this.path[d];h=c.slice(1).trim();for(a.length=0;f=e.exec(h);)a.push(f[0]);
c=[c.charAt(0)];h=0;for(var j=a.length;h<j;h++)f=parseFloat(a[h]),isNaN(f)||c.push(f);f=c[0];h=l[f.toLowerCase()];j=g[f]||f;if(c.length-1>h)for(var v=1,x=c.length;v<x;v+=h)b.push([f].concat(c.slice(v,v+h))),f=j;else b.push(c)}return b},_parseDimensions:function(){for(var b=[],f=[],h,d=null,l=0,g=0,k=0,z=0,j=0,v=0,x,n,B,r,q,w=0,C=this.path.length;w<C;++w){h=this.path[w];switch(h[0]){case "l":k+=h[1];z+=h[2];q=[];break;case "L":k=h[1];z=h[2];q=[];break;case "h":k+=h[1];q=[];break;case "H":k=h[1];q=
[];break;case "v":z+=h[1];q=[];break;case "V":z=h[1];q=[];break;case "m":k+=h[1];z+=h[2];l=k;g=z;q=[];break;case "M":k=h[1];z=h[2];l=k;g=z;q=[];break;case "c":x=k+h[5];n=z+h[6];j=k+h[3];v=z+h[4];q=a.util.getBoundsOfCurve(k,z,k+h[1],z+h[2],j,v,x,n);k=x;z=n;break;case "C":k=h[5];z=h[6];j=h[3];v=h[4];q=a.util.getBoundsOfCurve(k,z,h[1],h[2],j,v,k,z);break;case "s":x=k+h[3];n=z+h[4];j=j?2*k-j:k;v=v?2*z-v:z;q=a.util.getBoundsOfCurve(k,z,j,v,k+h[1],z+h[2],x,n);j=k+h[1];v=z+h[2];k=x;z=n;break;case "S":x=
h[3];n=h[4];j=2*k-j;v=2*z-v;q=a.util.getBoundsOfCurve(k,z,j,v,h[1],h[2],x,n);k=x;z=n;j=h[1];v=h[2];break;case "q":x=k+h[3];n=z+h[4];j=k+h[1];v=z+h[2];q=a.util.getBoundsOfCurve(k,z,j,v,j,v,x,n);k=x;z=n;break;case "Q":j=h[1];v=h[2];q=a.util.getBoundsOfCurve(k,z,j,v,j,v,h[3],h[4]);k=h[3];z=h[4];break;case "t":x=k+h[1];n=z+h[2];d[0].match(/[QqTt]/)===null?(j=k,v=z):d[0]==="t"?(j=2*k-B,v=2*z-r):d[0]==="q"&&(j=2*k-j,v=2*z-v);B=j;r=v;q=a.util.getBoundsOfCurve(k,z,j,v,j,v,x,n);k=x;z=n;j=k+h[1];v=z+h[2];break;
case "T":x=h[1];n=h[2];j=2*k-j;v=2*z-v;q=a.util.getBoundsOfCurve(k,z,j,v,j,v,x,n);k=x;z=n;break;case "a":q=a.util.getBoundsOfArc(k,z,h[1],h[2],h[3],h[4],h[5],h[6]+k,h[7]+z);k+=h[6];z+=h[7];break;case "A":q=a.util.getBoundsOfArc(k,z,h[1],h[2],h[3],h[4],h[5],h[6],h[7]);k=h[6];z=h[7];break;case "z":case "Z":k=l,z=g}d=h;q.forEach(function(a){b.push(a.x);f.push(a.y)});b.push(k);f.push(z)}h=e(b);d=e(f);l=c(b);g=c(f);return{left:h,top:d,width:l-h,height:g-d}}}),a.Path.fromObject=function(b,c){typeof b.path===
"string"?a.loadSVGFromURL(b.path,function(f){var f=f[0],e=b.path;delete b.path;a.util.object.extend(f,b);f.setSourcePath(e);c(f)}):c(new a.Path(b.path,b))},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(c,f,e){c=a.parseAttributes(c,a.Path.ATTRIBUTE_NAMES);f&&f(new a.Path(c.d,b(c,e)))},a.Path.async=!0)})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend,c=a.util.array.invoke,b=a.Object.prototype.toObject;a.PathGroup?
a.warn("fabric.PathGroup is already defined"):(a.PathGroup=a.util.createClass(a.Path,{type:"path-group",fill:"",initialize:function(b,a){a=a||{};this.paths=b||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(a);if(a.widthAttr)this.scaleX=a.widthAttr/a.width;if(a.heightAttr)this.scaleY=a.heightAttr/a.height;this.setCoords();a.sourcePath&&this.setSourcePath(a.sourcePath)},render:function(b){if(this.visible){b.save();var c=this.transformMatrix;c&&b.transform(c[0],c[1],c[2],
c[3],c[4],c[5]);this.transform(b);this._setShadow(b);this.clipTo&&a.util.clipContext(this,b);for(var c=0,e=this.paths.length;c<e;++c)this.paths[c].render(b,!0);this.clipTo&&b.restore();this._removeShadow(b);b.restore()}},_set:function(b,a){if(b==="fill"&&a&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(b,a);return this.callSuper("_set",b,a)},toObject:function(a){a=e(b.call(this,a),{paths:c(this.getObjects(),"toObject",a)});if(this.sourcePath)a.sourcePath=this.sourcePath;return a},
toDatalessObject:function(b){b=this.toObject(b);if(this.sourcePath)b.paths=this.sourcePath;return b},toSVG:function(b){for(var a=this.getObjects(),c="translate("+this.left+" "+this.top+")",c=["<g ",'style="',this.getSvgStyles(),'" ','transform="',c,this.getSvgTransform(),'" ',">\n"],e=0,d=a.length;e<d;e++)c.push(a[e].toSVG(b));c.push("</g>\n");return b?b(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var b=
(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(a){return(a.get("fill")||"").toLowerCase()===b})},complexity:function(){return this.paths.reduce(function(b,a){return b+(a&&a.complexity?a.complexity():0)},0)},getObjects:function(){return this.paths}}),a.PathGroup.fromObject=function(b,c){typeof b.paths==="string"?a.loadSVGFromURL(b.paths,function(e){var d=b.paths;delete b.paths;e=a.util.groupSVGElements(e,b,d);c(e)}):a.util.enlivenObjects(b.paths,function(e){delete b.paths;
c(new a.PathGroup(e,b))})},a.PathGroup.async=!0)})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend,c=a.util.array.min,b=a.util.array.max,h=a.util.array.invoke;if(!a.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",initialize:function(b,a){a=a||{};this._objects=b||[];for(var c=this._objects.length;c--;)this._objects[c].group=
this;this.originalState={};this.callSuper("initialize");if(a.originX)this.originX=a.originX;if(a.originY)this.originY=a.originY;this._calcBounds();this._updateObjectsCoords();a&&e(this,a);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(b){var a=b.getLeft(),c=b.getTop(),f=this.getCenterPoint();b.set({originalLeft:a,originalTop:c,left:a-f.x,top:c-f.y});b.setCoords();b.__origHasControls=b.hasControls;
b.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(b){this._restoreObjectsState();if(b)this._objects.push(b),b.group=this;this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(b){b.set("active",!0);b.group=this},removeWithUpdate:function(b){this._moveFlippedObject(b);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(b);this._calcBounds();
this._updateObjectsCoords();return this},_onObjectAdded:function(b){b.group=this},_onObjectRemoved:function(b){delete b.group;b.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(b,a){if(b in this.delegatedProperties){var c=this._objects.length;for(this[b]=a;c--;)this._objects[c].set(b,a)}else this[b]=a},toObject:function(b){return e(this.callSuper("toObject",
b),{objects:h(this._objects,"toObject",b)})},render:function(b){if(this.visible){b.save();this.clipTo&&a.util.clipContext(this,b);for(var c=0,f=this._objects.length;c<f;c++)this._renderObject(this._objects[c],b);this.clipTo&&b.restore();b.restore()}},_renderControls:function(b,a){this.callSuper("_renderControls",b,a);for(var c=0,f=this._objects.length;c<f;c++)this._objects[c]._renderControls(b)},_renderObject:function(b,a){var c=b.hasRotatingPoint;if(b.visible)b.hasRotatingPoint=!1,b.render(a),b.hasRotatingPoint=
c},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(b){var a=b.get("originX"),c=b.get("originY"),f=b.getCenterPoint();b.set({originX:"center",originY:"center",left:f.x,top:f.y});this._toggleFlipping(b);f=b.getPointByOrigin(a,c);b.set({originX:a,originY:c,left:f.x,top:f.y});return this},_toggleFlipping:function(b){this.flipX&&(b.toggle("flipX"),b.set("left",-b.get("left")),b.setAngle(-b.getAngle()));this.flipY&&(b.toggle("flipY"),
b.set("top",-b.get("top")),b.setAngle(-b.getAngle()))},_restoreObjectState:function(b){this._setObjectPosition(b);b.setCoords();b.hasControls=b.__origHasControls;delete b.__origHasControls;b.set("active",!1);b.setCoords();delete b.group;return this},_setObjectPosition:function(b){var a=this.getCenterPoint(),c=this._getRotatedLeftTop(b);b.set({angle:b.getAngle()+this.getAngle(),left:a.x+c.left,top:a.y+c.top,scaleX:b.get("scaleX")*this.get("scaleX"),scaleY:b.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(b){var a=
this.getAngle()*(Math.PI/180);return{left:-Math.sin(a)*b.getTop()*this.get("scaleY")+Math.cos(a)*b.getLeft()*this.get("scaleX"),top:Math.cos(a)*b.getTop()*this.get("scaleY")+Math.sin(a)*b.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==
this.get("top")},setObjectsCoords:function(){this.forEachObject(function(b){b.setCoords()});return this},_calcBounds:function(b){for(var a=[],c=[],f,e=0,h=this._objects.length;e<h;++e){f=this._objects[e];f.setCoords();for(var d in f.oCoords)a.push(f.oCoords[d].x),c.push(f.oCoords[d].y)}this.set(this._getBounds(a,c,b))},_getBounds:function(f,e,h){var d=a.util.invertTransform(this.getViewportTransform()),g=a.util.transformPoint(new a.Point(c(f),c(e)),d),f=a.util.transformPoint(new a.Point(b(f),b(e)),
d),f={width:f.x-g.x||0,height:f.y-g.y||0};if(!h)f.left=g.x||0,f.top=g.y||0,this.originX==="center"&&(f.left+=f.width/2),this.originX==="right"&&(f.left+=f.width),this.originY==="center"&&(f.top+=f.height/2),this.originY==="bottom"&&(f.top+=f.height);return f},toSVG:function(b){for(var a=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,f=this._objects.length;c<f;c++)a.push(this._objects[c].toSVG(b));a.push("</g>\n");return b?b(a.join("")):a.join("")},get:function(b){if(b in f)if(this[b])return this[b];
else{for(var a=0,c=this._objects.length;a<c;a++)if(this._objects[a][b])return!0;return!1}else return b in this.delegatedProperties?this._objects[0]&&this._objects[0].get(b):this[b]}});a.Group.fromObject=function(b,c){a.util.enlivenObjects(b.objects,function(f){delete b.objects;c&&c(new a.Group(f,b))})};a.Group.async=!0}})(typeof j!=="undefined"?j:this);(function(d){var a=g.util.object.extend;if(!d.fabric)d.fabric={};d.fabric.Image?g.warn("fabric.Image is already defined."):(g.Image=g.util.createClass(g.Object,
{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(a,c){c||(c={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",c);this._initElement(a,c);this._initConfig(c);if(c.filters)this.filters=c.filters,this.applyFilters()},getElement:function(){return this._element},setElement:function(a,c,b){this._originalElement=this._element=a;this._initConfig(b);this.filters.length!==0?this.applyFilters(c):c&&c();return this},
setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var c=-this.width/2,b=-this.height/2,h=this.width,f=this.height;a.save();this._setStrokeStyles(a);a.beginPath();g.util.drawDashedLine(a,
c,b,c+h,b,this.strokeDashArray);g.util.drawDashedLine(a,c+h,b,c+h,b+f,this.strokeDashArray);g.util.drawDashedLine(a,c+h,b+f,c,b+f,this.strokeDashArray);g.util.drawDashedLine(a,c,b+f,c,b,this.strokeDashArray);a.closePath();a.restore()},toObject:function(e){return a(this.callSuper("toObject",e),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},
toSVG:function(a){var c=[],b=-this.width/2,h=-this.height/2,f="none";if(this.group&&this.group.type==="path-group")b=this.left,h=this.top;this.alignX!=="none"&&this.alignY!=="none"&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',b,'" y="',h,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n");
if(this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,c.push("<rect ",'x="',b,'" y="',h,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f;c.push("</g>\n");return a?a(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(a,c,b){g.util.loadImage(a,function(a){return this.setElement(a,c,b)},this,b&&b.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+
this.getSrc()+'" }>'},clone:function(a,c){this.constructor.fromObject(this.toObject(c),a)},applyFilters:function(a,c,b,h){c=c||this.filters;if(b=b||this._originalElement){var f=b,d=g.util.createCanvasElement(),k=g.util.createImage(),i=this;d.width=f.width;d.height=f.height;d.getContext("2d").drawImage(f,0,0,f.width,f.height);if(c.length===0)return this._element=b,a&&a(),d;c.forEach(function(b){b&&b.applyTo(d,b.scaleX||i.scaleX,b.scaleY||i.scaleY);!h&&b.type==="Resize"&&(i.width*=b.scaleX,i.height*=
b.scaleY)});k.width=d.width;k.height=d.height;g.isLikelyNode?(k.src=d.toBuffer(s,g.Image.pngCompression),i._element=k,!h&&(i._filteredEl=k),a&&a()):(k.onload=function(){i._element=k;!h&&(i._filteredEl=k);a&&a();k.onload=d=f=null},k.src=d.toDataURL("image/png"));return d}},_render:function(a,c){var b,h,f=this._findMargins(),d;b=c?this.left:-this.width/2;h=c?this.top:-this.height/2;this.meetOrSlice==="slice"&&(a.beginPath(),a.rect(b,h,this.width,this.height),a.clip());this.isMoving===!1&&this.resizeFilters.length&&
this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,d=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!1)):d=this._element;d&&a.drawImage(d,b+f.marginX,h+f.marginY,f.width,f.height);this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var a=this.width,c=this.height,b=0,h=0;if(this.alignX!=="none"||this.alignY!=="none")a=[this.width/this._element.width,
this.height/this._element.height],c=this.meetOrSlice==="meet"?Math.min.apply(null,a):Math.max.apply(null,a),a=this._element.width*c,c*=this._element.height,this.alignX==="Mid"&&(b=(this.width-a)/2),this.alignX==="Max"&&(b=this.width-a),this.alignY==="Mid"&&(h=(this.height-c)/2),this.alignY==="Max"&&(h=this.height-c);return{width:a,height:c,marginX:b,marginY:h}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(g.util.getById(a));
g.util.addClass(this.getElement(),g.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);if(this._element&&this.crossOrigin)this._element.crossOrigin=this.crossOrigin},_initFilters:function(a,c){a.filters&&a.filters.length?g.util.enlivenObjects(a.filters,function(b){c&&c(b)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?
this.getElement().height||0:0},complexity:function(){return 1}}),g.Image.CSS_CANVAS="canvas-img",g.Image.prototype.getSvgSrc=g.Image.prototype.getSrc,g.Image.fromObject=function(a,c){g.util.loadImage(a.src,function(b){g.Image.prototype._initFilters.call(a,a,function(h){a.filters=h||[];h=new g.Image(b,a);c&&c(h)})},null,a.crossOrigin)},g.Image.fromURL=function(a,c,b){g.util.loadImage(a,function(a){c(new g.Image(a,b))},null,b&&b.crossOrigin)},g.Image.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),
g.Image.fromElement=function(e,c,b){var e=g.parseAttributes(e,g.Image.ATTRIBUTE_NAMES),h="xMidYMid",f="meet",d;e.preserveAspectRatio&&(d=e.preserveAspectRatio.split(" "));d&&d.length&&(f=d.pop(),f!=="meet"&&f!=="slice"?(h=f,f="meet"):d.length&&(h=d.pop()));d=h!=="none"?h.slice(1,4):"none";h=h!=="none"?h.slice(5,8):"none";e.alignX=d;e.alignY=h;e.meetOrSlice=f;g.Image.fromURL(e["xlink:href"],c,a(b?g.util.object.clone(b):{},e))},g.Image.async=!0,g.Image.pngCompression=1)})(typeof j!=="undefined"?j:this);
g.util.object.extend(g.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.getAngle()%360;return d>0?Math.round((d-1)/90)*90:Math.round(d/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(d){var d=d||{},a=function(){},e=d.onComplete||a,c=d.onChange||a,b=this;g.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){b.setAngle(a);c()},onComplete:function(){b.setCoords();
e()},onStart:function(){b.set("active",!1)}});return this}});g.util.object.extend(g.StaticCanvas.prototype,{straightenObject:function(d){d.straighten();this.renderAll();return this},fxStraightenObject:function(d){d.fxStraighten({onChange:this.renderAll.bind(this)});return this}});g.Image.filters=g.Image.filters||{};g.Image.filters.BaseFilter=g.util.createClass({type:"BaseFilter",initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var a in d)this[a]=d[a]},toObject:function(){return{type:this.type}},
toJSON:function(){return this.toObject()}});(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.Brightness=a.util.createClass(a.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),e=a.data,f=this.brightness,d=0,g=e.length;d<g;d+=4)e[d]+=f,e[d+1]+=f,e[d+2]+=f;b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),
{brightness:this.brightness})}});a.Image.filters.Brightness.fromObject=function(c){return new a.Image.filters.Brightness(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.Convolute=a.util.createClass(a.Image.filters.BaseFilter,{type:"Convolute",initialize:function(c){c=c||{};this.opaque=c.opaque;this.matrix=c.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=a.util.createCanvasElement().getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,
b)},applyTo:function(a){for(var b=this.matrix,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),a=Math.round(Math.sqrt(b.length)),d=Math.floor(a/2),g=f.data,i=f.width,f=f.height,m=this._createImageData(i,f),o=m.data,t=this.opaque?1:0,p=0;p<f;p++)for(var D=0;D<i;D++){for(var j=p,z=D,F=(p*i+D)*4,v=0,x=0,n=0,B=0,r=0;r<a;r++)for(var q=0;q<a;q++){var w=j+r-d,C=z+q-d;w<0||w>f||C<0||C>i||(w=(w*i+C)*4,C=b[r*a+q],v+=g[w]*C,x+=g[w+1]*C,n+=g[w+2]*C,B+=g[w+3]*C)}o[F]=v;o[F+1]=x;o[F+2]=n;o[F+3]=B+t*
(255-B)}e.putImageData(m,0,0)},toObject:function(){return e(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});a.Image.filters.Convolute.fromObject=function(c){return new a.Image.filters.Convolute(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.GradientTransparency=a.util.createClass(a.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){for(var b=
a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),e=a.data,f=this.threshold,d=e.length,g=0,i=e.length;g<i;g+=4)e[g+3]=f+255*(d-g)/d;b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{threshold:this.threshold})}});a.Image.filters.GradientTransparency.fromObject=function(c){return new a.Image.filters.GradientTransparency(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Grayscale=a.util.createClass(a.Image.filters.BaseFilter,
{type:"Grayscale",applyTo:function(a){for(var c=a.getContext("2d"),a=c.getImageData(0,0,a.width,a.height),b=a.data,h=a.width*a.height*4,f=0,d;f<h;)d=(b[f]+b[f+1]+b[f+2])/3,b[f]=d,b[f+1]=d,b[f+2]=d,f+=4;c.putImageData(a,0,0)}});a.Image.filters.Grayscale.fromObject=function(){return new a.Image.filters.Grayscale}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Invert=a.util.createClass(a.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var c=a.getContext("2d"),
a=c.getImageData(0,0,a.width,a.height),b=a.data,h=b.length,f;for(f=0;f<h;f+=4)b[f]=255-b[f],b[f+1]=255-b[f+1],b[f+2]=255-b[f+2];c.putImageData(a,0,0)}});a.Image.filters.Invert.fromObject=function(){return new a.Image.filters.Invert}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.Mask=a.util.createClass(a.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=[0,1,2,3].indexOf(a.channel)>
-1?a.channel:0},applyTo:function(c){if(this.mask){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),e=c.data,f=this.mask.getElement(),d=a.util.createCanvasElement(),g=this.channel,i=c.width*c.height*4;d.width=f.width;d.height=f.height;d.getContext("2d").drawImage(f,0,0,f.width,f.height);d=d.getContext("2d").getImageData(0,0,f.width,f.height).data;for(f=0;f<i;f+=4)e[f+3]=d[f+g];b.putImageData(c,0,0)}},toObject:function(){return e(this.callSuper("toObject"),{mask:this.mask.toObject(),
channel:this.channel})}});a.Image.filters.Mask.fromObject=function(c,b){a.util.loadImage(c.mask.src,function(e){c.mask=new a.Image(e,c.mask);b&&b(new a.Image.filters.Mask(c))})};a.Image.filters.Mask.async=!0})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.Noise=a.util.createClass(a.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,
0,a.width,a.height),e=a.data,f=this.noise,d,g=0,i=e.length;g<i;g+=4)d=(0.5-Math.random())*f,e[g]+=d,e[g+1]+=d,e[g+2]+=d;b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{noise:this.noise})}});a.Image.filters.Noise.fromObject=function(c){return new a.Image.filters.Noise(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.Pixelate=a.util.createClass(a.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=
a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),e=a.data,f=a.height,d=a.width,g,i,m,o,t,p,D;for(i=0;i<f;i+=this.blocksize)for(m=0;m<d;m+=this.blocksize){g=i*4*d+m*4;o=e[g];t=e[g+1];p=e[g+2];D=e[g+3];for(var j=i,z=i+this.blocksize;j<z;j++)for(var F=m,v=m+this.blocksize;F<v;F++)g=j*4*d+F*4,e[g]=o,e[g+1]=t,e[g+2]=p,e[g+3]=D}b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{blocksize:this.blocksize})}});
a.Image.filters.Pixelate.fromObject=function(c){return new a.Image.filters.Pixelate(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.RemoveWhite=a.util.createClass(a.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){for(var b=a.getContext("2d"),a=b.getImageData(0,0,a.width,a.height),e=a.data,f=this.distance,d=255-this.threshold,
g=Math.abs,i,m,o,t=0,p=e.length;t<p;t+=4)i=e[t],m=e[t+1],o=e[t+2],i>d&&m>d&&o>d&&g(i-m)<f&&g(i-o)<f&&g(m-o)<f&&(e[t+3]=1);b.putImageData(a,0,0)},toObject:function(){return e(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});a.Image.filters.RemoveWhite.fromObject=function(c){return new a.Image.filters.RemoveWhite(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Sepia=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia",
applyTo:function(a){var c=a.getContext("2d"),a=c.getImageData(0,0,a.width,a.height),b=a.data,h=b.length,f,d;for(f=0;f<h;f+=4)d=0.3*b[f]+0.59*b[f+1]+0.11*b[f+2],b[f]=d+100,b[f+1]=d+50,b[f+2]=d+255;c.putImageData(a,0,0)}});a.Image.filters.Sepia.fromObject=function(){return new a.Image.filters.Sepia}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={});a.Image.filters.Sepia2=a.util.createClass(a.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var c=a.getContext("2d"),
a=c.getImageData(0,0,a.width,a.height),b=a.data,h=b.length,f,d,g,i;for(f=0;f<h;f+=4)d=b[f],g=b[f+1],i=b[f+2],b[f]=(d*0.393+g*0.769+i*0.189)/1.351,b[f+1]=(d*0.349+g*0.686+i*0.168)/1.203,b[f+2]=(d*0.272+g*0.534+i*0.131)/2.14;c.putImageData(a,0,0)}});a.Image.filters.Sepia2.fromObject=function(){return new a.Image.filters.Sepia2}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.Tint=a.util.createClass(a.Image.filters.BaseFilter,{type:"Tint",
initialize:function(c){c=c||{};this.color=c.color||"#000000";this.opacity=typeof c.opacity!=="undefined"?c.opacity:(new a.Color(this.color)).getAlpha()},applyTo:function(c){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),e=c.data,f=e.length,d,g,i,m,o,t,p,D;d=(new a.Color(this.color)).getSource();g=d[0]*this.opacity;i=d[1]*this.opacity;m=d[2]*this.opacity;D=1-this.opacity;for(d=0;d<f;d+=4)o=e[d],t=e[d+1],p=e[d+2],e[d]=g+o*D,e[d+1]=i+t*D,e[d+2]=m+p*D;b.putImageData(c,0,0)},toObject:function(){return e(this.callSuper("toObject"),
{color:this.color,opacity:this.opacity})}});a.Image.filters.Tint.fromObject=function(c){return new a.Image.filters.Tint(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend;a.Image.filters.Multiply=a.util.createClass(a.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(c){var b=c.getContext("2d"),c=b.getImageData(0,0,c.width,c.height),e=c.data,f=e.length,d,g;g=(new a.Color(this.color)).getSource();
for(d=0;d<f;d+=4)e[d]*=g[0]/255,e[d+1]*=g[1]/255,e[d+2]*=g[2]/255;b.putImageData(c,0,0)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color})}});a.Image.filters.Multiply.fromObject=function(c){return new a.Image.filters.Multiply(c)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric;a.Image.filters.Blend=a.util.createClass({type:"Blend",initialize:function(a){a=a||{};this.color=a.color||"#000";this.image=a.image||!1;this.mode=a.mode||"multiply";this.alpha=a.alpha||
1},applyTo:function(e){var c=e.getContext("2d"),e=c.getImageData(0,0,e.width,e.height),b=e.data,h,f,d,g,i,m,o,t=!1;this.image?(t=!0,o=a.util.createCanvasElement(),o.width=this.image.width,o.height=this.image.height,o=new a.StaticCanvas(o),o.add(this.image),o=o.getContext("2d").getImageData(0,0,o.width,o.height).data):(o=(new a.Color(this.color)).getSource(),h=o[0]*this.alpha,f=o[1]*this.alpha,d=o[2]*this.alpha);for(var p=0,D=b.length;p<D;p+=4)switch(g=b[p],i=b[p+1],m=b[p+2],t&&(h=o[p]*this.alpha,
f=o[p+1]*this.alpha,d=o[p+2]*this.alpha),this.mode){case "multiply":b[p]=g*h/255;b[p+1]=i*f/255;b[p+2]=m*d/255;break;case "screen":b[p]=1-(1-g)*(1-h);b[p+1]=1-(1-i)*(1-f);b[p+2]=1-(1-m)*(1-d);break;case "add":b[p]=Math.min(255,g+h);b[p+1]=Math.min(255,i+f);b[p+2]=Math.min(255,m+d);break;case "diff":case "difference":b[p]=Math.abs(g-h);b[p+1]=Math.abs(i-f);b[p+2]=Math.abs(m-d);break;case "subtract":g-=h;i-=f;m-=d;b[p]=g<0?0:g;b[p+1]=i<0?0:i;b[p+2]=m<0?0:m;break;case "darken":b[p]=Math.min(g,h);b[p+
1]=Math.min(i,f);b[p+2]=Math.min(m,d);break;case "lighten":b[p]=Math.max(g,h),b[p+1]=Math.max(i,f),b[p+2]=Math.max(m,d)}c.putImageData(e,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});a.Image.filters.Blend.fromObject=function(e){return new a.Image.filters.Blend(e)}})(typeof j!=="undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=Math.pow,c=Math.floor,b=Math.sqrt,h=Math.abs,f=Math.max,l=Math.round,g=Math.sin,i=Math.ceil;a.Image.filters.Resize=
a.util.createClass(a.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var f=a.width,e=a.height,b=l(f*b),c=l(e*c),h;this.resizeType==="sliceHack"&&(h=this.sliceByTwo(a,f,e,b,c));this.resizeType==="hermite"&&(h=this.hermiteFastResize(a,f,e,b,c));this.resizeType==="bilinear"&&(h=this.bilinearFiltering(a,f,e,b,c));this.resizeType==="lanczos"&&(h=this.lanczosResize(a,f,e,b,c));a.width=b;a.height=
c;a.getContext("2d").putImageData(h,0,0)},sliceByTwo:function(b,e,h,d,l){var g=b.getContext("2d"),i,k=0.5,j=0.5,x=1,n=1,B=!1,r=!1,q=e,w=h,C=a.util.createCanvasElement(),A=C.getContext("2d"),d=c(d),l=c(l);C.width=f(d,e);C.height=f(l,h);d>e&&(k=2,x=-1);l>h&&(j=2,n=-1);i=g.getImageData(0,0,e,h);b.width=f(d,e);b.height=f(l,h);for(g.putImageData(i,0,0);!B||!r;)e=q,h=w,d*x<c(q*k*x)?q=c(q*k):(q=d,B=!0),l*n<c(w*j*n)?w=c(w*j):(w=l,r=!0),i=g.getImageData(0,0,e,h),A.putImageData(i,0,0),g.clearRect(0,0,q,w),
g.drawImage(C,0,0,e,h,0,0,q,w);return g.getImageData(0,0,d,l)},lanczosResize:function(a,f,d,l,j){var E,z,F,v;function x(a){var g,i,m,k,n,J,Q,R,S,L;F=(a+0.5)*C;E=c(F);for(g=0;g<j;g++){v=(g+0.5)*A;z=c(v);n=0;J=0;Q=0;R=0;S=0;for(i=E-s;i<=E+s;i++)if(!(i<0||i>=f)){L=c(1E3*h(i-F));H[L]||(H[L]={});for(var M=z-y;M<=z+y;M++)M<0||M>=d||(m=c(1E3*h(M-v)),H[L][m]||(H[L][m]=w(b(e(L*G,2)+e(m*u,2))/1E3)),m=H[L][m],m>0&&(k=(M*f+i)*4,n+=m,J+=m*r[k],Q+=m*r[k+1],R+=m*r[k+2],S+=m*r[k+3]))}k=(g*l+a)*4;q[k]=J/n;q[k+1]=
Q/n;q[k+2]=R/n;q[k+3]=S/n}return++a<l?x(a):B}var a=a.getContext("2d"),n=a.getImageData(0,0,f,d),B=a.getImageData(0,0,l,j),r=n.data,q=B.data,w=function(a){return function(b){if(b>a)return 0;b*=Math.PI;if(h(b)<1.0E-16)return 1;var c=b/a;return g(b)*g(c)/b/c}}(this.lanczosLobes),C=this.rcpScaleX,A=this.rcpScaleY,G=2/this.rcpScaleX,u=2/this.rcpScaleY,s=i(C*this.lanczosLobes/2),y=i(A*this.lanczosLobes/2),H={};F=void 0;v=void 0;E=void 0;z=void 0;return x(0)},bilinearFiltering:function(a,b,f,e,h){var d,
l,g,i,k,j,B,r,q,n,C=0,A=this.rcpScaleX,G=this.rcpScaleY;B=a.getContext("2d");var a=4*(b-1),f=B.getImageData(0,0,b,f).data,u=B.getImageData(0,0,e,h),s=u.data;for(B=0;B<h;B++)for(r=0;r<e;r++){k=c(A*r);j=c(G*B);q=A*r-k;n=G*B-j;j=4*(j*b+k);for(k=0;k<4;k++)d=f[j+k],l=f[j+4+k],g=f[j+a+k],i=f[j+a+4+k],d=d*(1-q)*(1-n)+l*q*(1-n)+g*n*(1-q)+i*q*n,s[C++]=d}return u},hermiteFastResize:function(a,f,e,d,l){for(var g=this.rcpScaleX,k=this.rcpScaleY,j=i(g/2),v=i(k/2),a=a.getContext("2d"),e=a.getImageData(0,0,f,e).data,
a=a.getImageData(0,0,d,l),n=a.data,J=0;J<l;J++)for(var B=0;B<d;B++){for(var r=(B+J*d)*4,q=0,w=0,C=0,A=0,G=0,u=0,s=0,y=(J+0.5)*k,H=c(J*k);H<(J+1)*k;H++){var P=h(y-(H+0.5))/v,U=(B+0.5)*g;P*=P;for(var N=c(B*g);N<(B+1)*g;N++){var I=h(U-(N+0.5))/j,q=b(P+I*I);q>1&&q<-1||(q=2*q*q*q-3*q*q+1,q>0&&(I=4*(N+H*f),s+=q*e[I+3],C+=q,e[I+3]<255&&(q=q*e[I+3]/250),A+=q*e[I],G+=q*e[I+1],u+=q*e[I+2],w+=q))}}n[r]=A/w;n[r+1]=G/w;n[r+2]=u/w;n[r+3]=s/C}return a}});a.Image.filters.Resize.fromObject=function(){return new a.Image.filters.Resize}})(typeof j!==
"undefined"?j:this);(function(d){var a=d.fabric||(d.fabric={}),e=a.util.object.extend,c=a.util.object.clone,b=a.util.toFixed,h=a.StaticCanvas.supports("setLineDash");a.Text?a.warn("fabric.Text is already defined"):(d=a.Object.prototype.stateProperties.concat(),d.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,
textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:d,stroke:null,shadow:null,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(){this.__skipDimension||
this._render(a.util.createCanvasElement().getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){typeof Cufon==="undefined"||this.useNative===!0?this._renderViaNative(a):this._renderViaCufon(a)},_renderViaNative:function(b){var c=this.text.split(this._reNewline);this._setTextStyles(b);this.width=this._getTextWidth(b,c);this.height=this._getTextHeight(b,c);this.clipTo&&a.util.clipContext(this,
b);this._renderTextBackground(b,c);this._translateForTextAlign(b);this._renderText(b,c);this.textAlign!=="left"&&this.textAlign!=="justify"&&b.restore();this._renderTextDecoration(b,c);this.clipTo&&b.restore();this._setBoundaries(b,c);this._totalLineHeight=0},_renderText:function(a,b){a.save();this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a,b);this._renderTextStroke(a,b);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){this.textAlign!==
"left"&&this.textAlign!=="justify"&&(a.save(),a.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,e=b.length;c<e;c++){var h=this._getLineWidth(a,b[c]),d=this._getLineLeftOffset(h);this._boundaries.push({height:this.fontSize*this.lineHeight,width:h,left:d})}},_setTextStyles:function(a){this._setFillStyles(a);this._setStrokeStyles(a);a.textBaseline="alphabetic";if(!this.skipTextAlign)a.textAlign=this.textAlign;a.font=this._getFontDeclaration()},
_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,e=1,h=b.length;e<h;e++){var d=a.measureText(b[e]).width;d>c&&(c=d)}return c},_renderChars:function(a,b,c,e,h){b[a](c,e,h)},_renderTextLine:function(a,b,c,e,h,d){h-=this.fontSize/4;if(this.textAlign!=="justify")this._renderChars(a,b,c,e,h,d);else{var g=b.measureText(c).width,p=this.width;if(p>g)for(var g=c.split(/\s+/),c=b.measureText(c.replace(/\s+/g,"")).width,
p=(p-c)/(g.length-1),j=c=0,E=g.length;j<E;j++)this._renderChars(a,b,g[j],e+c,h,d),c+=b.measureText(g[j]).width+p;else this._renderChars(a,b,c,e,h,d)}},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a,b){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var c=0,e=0,h=b.length;e<h;e++){var d=this._getHeightOfLine(a,e,b);c+=d;this._renderTextLine("fillText",a,b[e],this._getLeftOffset(),this._getTopOffset()+c,e)}this.shadow&&
!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a,b){if(this.stroke&&this.strokeWidth!==0||this._skipFillStrokeCheck){var c=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),h&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var e=0,d=b.length;e<d;e++){var g=this._getHeightOfLine(a,e,b);c+=g;this._renderTextLine("strokeText",a,b[e],this._getLeftOffset(),this._getTopOffset()+
c,e)}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){if(this.backgroundColor)a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore()},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;
for(var c=0,e=b.length;c<e;c++)if(b[c]!==""){var h=this._getLineWidth(a,b[c]),d=this._getLineLeftOffset(h);a.fillRect(this._getLeftOffset()+d,this._getTopOffset()+c*this.fontSize*this.lineHeight,h,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return this.textAlign==="center"?(this.width-a)/2:this.textAlign==="right"?this.width-a:0},_getLineWidth:function(a,b){return this.textAlign==="justify"?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(d){for(var g=
0,k=b.length;g<k;g++){var j=h._getLineWidth(a,b[g]),E=h._getLineLeftOffset(j);a.fillRect(h._getLeftOffset()+E,~~(d+g*h._getHeightOfLine(a,g,b)-e),j,1)}}if(this.textDecoration){var e=this._getTextHeight(a,b)/2,h=this;this.textDecoration.indexOf("underline")>-1&&c(this.fontSize*this.lineHeight);this.textDecoration.indexOf("line-through")>-1&&c(this.fontSize*this.lineHeight-this.fontSize/2);this.textDecoration.indexOf("overline")>-1&&c(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[a.isLikelyNode?
this.fontWeight:this.fontStyle,a.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",a.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){if(this.visible){a.save();b||this.transform(a);var c=this.group&&this.group.type==="path-group";c&&a.translate(-this.group.width/2,-this.group.height/2);this.transformMatrix&&a.transform.apply(a,this.transformMatrix);c&&a.translate(this.left,this.top);this._render(a);a.restore()}},toObject:function(a){a=e(this.callSuper("toObject",
a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=[],c=this.text.split(this._reNewline),e=this._getSVGLeftTopOffsets(c),h=this._getSVGTextAndBg(e.lineTop,e.textLeft,c),
c=this._getSVGShadows(e.lineTop,c);e.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0;this._wrapSVGTextAndBg(b,h,c,e);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){return{textLeft:-(this.width/2)+(this.group&&this.group.type==="path-group"?this.left:0),textTop:(this.useNative?this.fontSize*this.lineHeight-0.25*this.fontSize:this.height/2-a.length*this.fontSize-this._totalLineHeight)+(this.group&&this.group.type==="path-group"?this.top:0),lineTop:this.useNative?
this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight}},_wrapSVGTextAndBg:function(a,c,e,h){a.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',c.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+
this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',b(h.textLeft,2)," ",b(h.textTop,2),')">',e.join(""),c.textSpans.join(""),"</text>\n","</g>\n")},_getSVGShadows:function(c,e){var h=[],d,g,o=1;if(!this.shadow||!this._boundaries)return h;for(d=0,g=e.length;d<g;d++)e[d]!==""?(h.push('<tspan x="',b((this._boundaries&&this._boundaries[d]?this._boundaries[d].left:0)+o+this.shadow.offsetX,2),d===0||this.useNative?'" y':'" dy','="',b(this.useNative?c*d-this.height/2+this.shadow.offsetY:
c+(d===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",a.util.string.escapeXml(e[d]),"</tspan>"),o=1):o++;return h},_getSVGTextAndBg:function(a,b,c){var e=[],h=[],d=1;this._setSVGBg(h);for(var g=0,p=c.length;g<p;g++)c[g]!==""?(this._setSVGTextLineText(c[g],g,e,a,d,h),d=1):d++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(h,g,b,a);return{textSpans:e,textBgRects:h}},_setSVGTextLineText:function(c,e,h,d,g){var o=this._boundaries&&this._boundaries[e]?
b(this._boundaries[e].left,2):0;h.push('<tspan x="',o,'" ',e===0||this.useNative?"y":"dy",'="',b(this.useNative?d*e-this.height/2:d*g,2),'" ',this._getFillAttributes(this.fill),">",a.util.string.escapeXml(c),"</tspan>")},_setSVGTextLineBg:function(a,c,e,h){a.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',b(e+this._boundaries[c].left,2),'" y="',b(h*c-this.height/2,2),'" width="',b(this._boundaries[c].width,2),'" height="',b(this._boundaries[c].height,2),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&
this._boundaries&&a.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',b(-this.width/2,2),'" y="',b(-this.height/2,2),'" width="',b(this.width,2),'" height="',b(this.height,2),'"></rect>')},_getFillAttributes:function(b){var c=b&&typeof b==="string"?new a.Color(b):"";return!c||!c.getSource()||c.getAlpha()===1?'fill="'+b+'"':'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"'},_set:function(a,b){if(a==="fontFamily"&&this.path)this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+b+"$3");this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(b,c){if(!b)return null;var e=a.parseAttributes(b,a.Text.ATTRIBUTE_NAMES),c=a.util.object.extend(c?a.util.object.clone(c):{},e);c.top=c.top||0;
c.left=c.left||0;"dx"in e&&(c.left+=e.dx);"dy"in e&&(c.top+=e.dy);if(!("fontSize"in c))c.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE;if(!c.originX)c.originX="left";c.top+=c.fontSize/4;var e=new a.Text(b.textContent,c),h=0;e.originX==="left"&&(h=e.getWidth()/2);e.originX==="right"&&(h=-e.getWidth()/2);e.set({left:e.getLeft()+h,top:e.getTop()-e.getHeight()/2});return e},a.Text.fromObject=function(b){return new a.Text(b.text,c(b))},a.util.createAccessors(a.Text))})(typeof j!=="undefined"?j:this);(function(){var d=
g.util.object.clone;g.IText=g.util.createClass(g.Text,g.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(a,e){this.styles=
e?e.styles||{}:{};this.callSuper("initialize",a,e);this.initBehavior();g.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles,e;for(e in a)for(var c in a[e])for(var b in a[e][c])return!1;return!0},setSelectionStart:function(a){this.selectionStart!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionStart=a;this.hiddenTextarea&&
(this.hiddenTextarea.selectionStart=a)},setSelectionEnd:function(a){this.selectionEnd!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}));this.selectionEnd=a;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=a)},getSelectionStyles:function(a,e){if(arguments.length===2){for(var c=[],b=a;b<e;b++)c.push(this.getSelectionStyles(b));return c}c=this.get2DCursorLocation(a);return this.styles[c.lineIndex]?this.styles[c.lineIndex][c.charIndex]||
{}:{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,a);return this},_extendStyles:function(a,e){var c=this.get2DCursorLocation(a);this.styles[c.lineIndex]||(this.styles[c.lineIndex]={});this.styles[c.lineIndex][c.charIndex]||(this.styles[c.lineIndex][c.charIndex]={});g.util.object.extend(this.styles[c.lineIndex][c.charIndex],e)},_render:function(a){this.callSuper("_render",
a);this.ctx=a;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var a=this.text.split(""),e;this.selectionStart===this.selectionEnd?(e=this._getCursorBoundaries(a,"cursor"),this.renderCursor(e)):(e=this._getCursorBoundaries(a,"selection"),this.renderSelection(a,e))}},get2DCursorLocation:function(a){if(typeof a==="undefined")a=this.selectionStart;a=this.text.slice(0,a).split(this._reNewline);return{lineIndex:a.length-1,charIndex:a[a.length-1].length}},
getCurrentCharStyle:function(a,e){var c=this.styles[a]&&this.styles[a][e===0?0:e-1];return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(a,
e){return this.styles[a]&&this.styles[a][e===0?0:e-1]&&this.styles[a][e===0?0:e-1].fontSize||this.fontSize},getCurrentCharColor:function(a,e){return this.styles[a]&&this.styles[a][e===0?0:e-1]&&this.styles[a][e===0?0:e-1].fill||this.cursorColor},_getCursorBoundaries:function(a,e){var c=this.get2DCursorLocation(),b=this.text.split(this._reNewline),h=Math.round(this._getLeftOffset()),f=this._getTopOffset(),c=this._getCursorBoundariesOffsets(a,e,c,b);return{left:h,top:f,leftOffset:c.left+c.lineLeft,
topOffset:c.top}},_getCursorBoundariesOffsets:function(a,e,c,b){for(var h=0,f=0,d=0,g=0,c=e==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(c.lineIndex,c.charIndex):0,i=0;i<this.selectionStart;i++)a[i]==="\n"?(g=0,c+=this._getCachedLineHeight(f+(e==="cursor"?1:0)),f++,d=0):(g+=this._getWidthOfChar(this.ctx,a[i],f,d),d++),h=this._getCachedLineOffset(f,b);this._clearCache();return{top:c,left:g,lineLeft:h}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets=
{}},_getCachedLineHeight:function(a){return this.__lineHeights[a]||(this.__lineHeights[a]=this._getHeightOfLine(this.ctx,a))},_getCachedLineWidth:function(a,e){return this.__lineWidths[a]||(this.__lineWidths[a]=this._getWidthOfLine(this.ctx,a,e))},_getCachedLineOffset:function(a,e){var c=this._getCachedLineWidth(a,e);return this.__lineOffsets[a]||(this.__lineOffsets[a]=this._getLineLeftOffset(c))},renderCursor:function(a){var e=this.ctx;e.save();var c=this.get2DCursorLocation(),b=c.lineIndex,c=c.charIndex,
h=this.getCurrentCharFontSize(b,c),f=b===0&&c===0?this._getCachedLineOffset(b,this.text.split(this._reNewline)):a.leftOffset;e.fillStyle=this.getCurrentCharColor(b,c);e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;e.fillRect(a.left+f,a.top+a.topOffset,this.cursorWidth/this.scaleX,h);e.restore()},renderSelection:function(a,e){var c=this.ctx;c.save();c.fillStyle=this.selectionColor;for(var b=this.get2DCursorLocation(this.selectionStart),h=this.get2DCursorLocation(this.selectionEnd),f=
b.lineIndex,d=h.lineIndex,g=this.text.split(this._reNewline),i=f;i<=d;i++){var m=this._getCachedLineOffset(i,g)||0,o=this._getCachedLineHeight(i),t=0;if(i===f)for(var p=0,j=g[i].length;p<j;p++){if(p>=b.charIndex&&(i!==d||p<h.charIndex))t+=this._getWidthOfChar(c,g[i][p],i,p);p<b.charIndex&&(m+=this._getWidthOfChar(c,g[i][p],i,p))}else if(i>f&&i<d)t+=this._getCachedLineWidth(i,g)||5;else if(i===d){p=0;for(j=h.charIndex;p<j;p++)t+=this._getWidthOfChar(c,g[i][p],i,p)}c.fillRect(e.left+m,e.top+e.topOffset,
t,o);e.topOffset+=o}c.restore()},_renderChars:function(a,e,c,b,h,f){if(this.isEmptyStyles())return this._renderCharsFast(a,e,c,b,h);this.skipTextAlign=!0;b-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var d=this.text.split(this._reNewline),g=this._getWidthOfLine(e,f,d),d=this._getHeightOfLine(e,f,d),i=this._getLineLeftOffset(g),c=c.split(""),m,g="";b+=i||0;e.save();for(var i=0,o=c.length;i<=o;i++){m=m||this.getCurrentCharStyle(f,i);var t=this.getCurrentCharStyle(f,
i+1);if(this._hasStyleChanged(m,t)||i===o)this._renderChar(a,e,f,i-1,g,b,h,d),g="",m=t;g+=c[i]}e.restore()},_renderCharsFast:function(a,e,c,b,h){this.skipTextAlign=!1;a==="fillText"&&this.fill&&this.callSuper("_renderChars",a,e,c,b,h);a==="strokeText"&&this.stroke&&this.callSuper("_renderChars",a,e,c,b,h)},_renderChar:function(a,e,c,b,h,f,d,g){var i;if(this.styles&&this.styles[c]&&(i=this.styles[c][b])){var m=i.stroke||this.stroke,o=i.fill||this.fill;e.save();a=this._applyCharStylesGetWidth(e,h,c,
b,i);c=this._getHeightOfChar(e,h,c,b);o&&e.fillText(h,f,d);m&&e.strokeText(h,f,d);this._renderCharDecoration(e,i,f,d,a,g,c);e.restore();e.translate(a,0)}else{if(a==="strokeText"&&this.stroke)e[a](h,f,d);if(a==="fillText"&&this.fill)e[a](h,f,d);a=this._applyCharStylesGetWidth(e,h,c,b);this._renderCharDecoration(e,null,f,d,a,g);e.translate(e.measureText(h).width,0)}},_hasStyleChanged:function(a,e){return a.fill!==e.fill||a.fontSize!==e.fontSize||a.textBackgroundColor!==e.textBackgroundColor||a.textDecoration!==
e.textDecoration||a.fontFamily!==e.fontFamily||a.fontWeight!==e.fontWeight||a.fontStyle!==e.fontStyle||a.stroke!==e.stroke||a.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(a,e,c,b,h,f,d){var g=e?e.textDecoration||this.textDecoration:this.textDecoration,e=(e?e.fontSize:null)||this.fontSize;g&&(g.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(a,c,b+this.fontSize/this._fontSizeFraction,h,0,this.fontSize/20),g.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(a,
c,b+this.fontSize/this._fontSizeFraction,h,d/2,e/20),g.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(a,c,b,h,f-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(a,e,c,b,h,f){a.fillRect(e,c-h,b,f)},_renderTextLine:function(a,e,c,b,h,f){h+=this.fontSize/4;this.callSuper("_renderTextLine",a,e,c,b,h,f)},_renderTextDecoration:function(a,e){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",a,e)},_renderTextLinesBackground:function(a,
e){if(this.textBackgroundColor||this.styles){a.save();if(this.textBackgroundColor)a.fillStyle=this.textBackgroundColor;for(var c=0,b=this.fontSize/this._fontSizeFraction,h=0,f=e.length;h<f;h++){var d=this._getHeightOfLine(a,h,e);if(e[h]!==""){var g=this._getWidthOfLine(a,h,e),i=this._getLineLeftOffset(g);if(this.textBackgroundColor)a.fillStyle=this.textBackgroundColor,a.fillRect(this._getLeftOffset()+i,this._getTopOffset()+c+b,g,d);if(this.styles[h])for(var g=0,m=e[h].length;g<m;g++)if(this.styles[h]&&
this.styles[h][g]&&this.styles[h][g].textBackgroundColor){var o=e[h][g];a.fillStyle=this.styles[h][g].textBackgroundColor;a.fillRect(this._getLeftOffset()+i+this._getWidthOfCharsAt(a,h,g,e),this._getTopOffset()+c+b,this._getWidthOfChar(a,o,h,g,e)+1,d)}}c+=d}a.restore()}},_getCacheProp:function(a,e){return a+e.fontFamily+e.fontSize+e.fontWeight+e.fontStyle+e.shadow},_applyCharStylesGetWidth:function(a,e,c,b,h){var f;f=(c=h||this.styles[c]&&this.styles[c][b])?d(c):{},c=f;this._applyFontStyles(c);b=
this._getCacheProp(e,c);if(this.isEmptyStyles()&&this._charWidthsCache[b]&&this.caching)return this._charWidthsCache[b];if(typeof c.shadow==="string")c.shadow=new g.Shadow(c.shadow);h=c.fill||this.fill;a.fillStyle=h.toLive?h.toLive(a):h;if(c.stroke)a.strokeStyle=c.stroke&&c.stroke.toLive?c.stroke.toLive(a):c.stroke;a.lineWidth=c.strokeWidth||this.strokeWidth;a.font=this._getFontDeclaration.call(c);this._setShadow.call(c,a);if(!this.caching)return a.measureText(e).width;if(!this._charWidthsCache[b])this._charWidthsCache[b]=
a.measureText(e).width;return this._charWidthsCache[b]},_applyFontStyles:function(a){if(!a.fontFamily)a.fontFamily=this.fontFamily;if(!a.fontSize)a.fontSize=this.fontSize;if(!a.fontWeight)a.fontWeight=this.fontWeight;if(!a.fontStyle)a.fontStyle=this.fontStyle},_getStyleDeclaration:function(a,e){return this.styles[a]&&this.styles[a][e]?d(this.styles[a][e]):{}},_getWidthOfChar:function(a,e,c,b){if(this.textAlign==="justify"&&/\s/.test(e))return this._getWidthOfSpace(a,c);var h=this._getStyleDeclaration(c,
b);this._applyFontStyles(h);h=this._getCacheProp(e,h);if(this._charWidthsCache[h]&&this.caching)return this._charWidthsCache[h];else if(a)return a.save(),e=this._applyCharStylesGetWidth(a,e,c,b),a.restore(),e},_getHeightOfChar:function(a,e,c,b){return this.styles[c]&&this.styles[c][b]?this.styles[c][b].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(a,e,c,b){b=b||this.text.split(this._reNewline);b=b[e].split("")[c];return this._getWidthOfChar(a,b,e,c)},_getHeightOfCharAt:function(a,
e,c,b){b=b||this.text.split(this._reNewline);b=b[e].split("")[c];return this._getHeightOfChar(a,b,e,c)},_getWidthOfCharsAt:function(a,e,c,b){for(var h=0,f=0;f<c;f++)h+=this._getWidthOfCharAt(a,e,f,b);return h},_getWidthOfLine:function(a,e,c){return this._getWidthOfCharsAt(a,e,c[e].length,c)},_getWidthOfSpace:function(a,e){var c=this.text.split(this._reNewline)[e],b=c.split(/\s+/);return(this.width-this._getWidthOfWords(a,c,e))/(b.length-1)},_getWidthOfWords:function(a,e,c){for(var b=0,h=0;h<e.length;h++){var f=
e[h];f.match(/\s/)||(b+=this._getWidthOfChar(a,f,c,h))}return b},_getTextWidth:function(a,e){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",a,e);for(var c=this._getWidthOfLine(a,0,e),b=1,h=e.length;b<h;b++){var f=this._getWidthOfLine(a,b,e);f>c&&(c=f)}return c},_getHeightOfLine:function(a,e,c){for(var c=c||this.text.split(this._reNewline),b=this._getHeightOfChar(a,c[e][0],e,0),c=c[e].split(""),h=1,f=c.length;h<f;h++){var d=this._getHeightOfChar(a,c[h],e,h);d>b&&(b=d)}return b*this.lineHeight},
_getTextHeight:function(a,e){for(var c=0,b=0,h=e.length;b<h;b++)c+=this._getHeightOfLine(a,b,e);return c},_getTopOffset:function(){return g.Text.prototype._getTopOffset.call(this)-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(a){if(this.backgroundColor)a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),a.restore()},toObject:function(a){return g.util.object.extend(this.callSuper("toObject",
a),{styles:d(this.styles)})}});g.IText.fromObject=function(a){return new g.IText(a.text,d(a))};g.IText.instances=[]})();(function(){var d=g.util.object.clone;g.util.object.extend(g.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var a=this;setTimeout(function(){a.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){if(this.canvas&&
!this.canvas._hasITextHandlers)this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){g.IText.prototype.exitEditingOnOthers.call()});this.canvas.on("mouse:up",function(){g.IText.instances.forEach(function(a){a.__isMousedown=!1})});this.canvas.on("object:selected",function(a){g.IText.prototype.exitEditingOnOthers.call(a.target)})},_tick:function(){if(!this._abortCursorAnimation){var a=this;this.animate("_currentCursorOpacity",
1,{duration:this.cursorDuration,onComplete:function(){a._onTickComplete()},onChange:function(){a.canvas&&a.canvas.renderAll()},abort:function(){return a._abortCursorAnimation}})}},_onTickComplete:function(){if(!this._abortCursorAnimation){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){a.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){a._tick()},onChange:function(){a.canvas&&a.canvas.renderAll()},
abort:function(){return a._abortCursorAnimation}})},100)}},initDelayedCursor:function(a){var e=this,c=a?0:this.cursorDelay;if(a)this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll();this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){e._abortCursorAnimation=!1;e._tick()},c)},abortCursorAnimation:function(){this._abortCursorAnimation=!0;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);
this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var a=this;setTimeout(function(){a._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(a){var e=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)e++,
c--;for(;/\S/.test(this.text.charAt(c))&&c>-1;)e++,c--;return a-e},findWordBoundaryRight:function(a){var e=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)e++,c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)e++,c++;return a+e},findLineBoundaryLeft:function(a){for(var e=0,c=a-1;!/\n/.test(this.text.charAt(c))&&c>-1;)e++,c--;return a-e},findLineBoundaryRight:function(a){for(var e=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)e++,
c++;return a+e},getNumNewLinesInSelectedText:function(){for(var a=0,e=0,c=this.getSelectedText().split(""),b=c.length;e<b;e++)c[e]==="\n"&&a++;return a},searchWordBoundary:function(a,e){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,b=this.text.charAt(c),h=/[ \n\.,;!\?\-]/;!h.test(b)&&c>0&&c<this.text.length;)c+=e,b=this.text.charAt(c);h.test(b)&&b!=="\n"&&(c+=e===1?0:1);return c},selectWord:function(a){var e=this.searchWordBoundary(a,-1),a=this.searchWordBoundary(a,1);this.setSelectionStart(e);
this.setSelectionEnd(a);this.initDelayedCursor(!0)},selectLine:function(a){var e=this.findLineBoundaryLeft(a),a=this.findLineBoundaryRight(a);this.setSelectionStart(e);this.setSelectionEnd(a);this.initDelayedCursor(!0)},enterEditing:function(){if(!this.isEditing&&this.editable)return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),
this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){g.IText.instances.forEach(function(a){a.selected=!1;a.isEditing&&a.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas)this.canvas.defaultCursor=this.canvas.moveCursor="text";this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea)this.hiddenTextarea.value=
this.text,this.hiddenTextarea.selectionStart=this.selectionStart},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,
this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas))this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor},exitEditing:function(){this.isEditing=this.selected=!1;this.selectable=!0;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;
this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){var a=this.text.split(this._reNewline),e;for(e in this.styles)a[e]||delete this.styles[e]},_removeCharsFromTo:function(a,e){for(var c=e;c!==a;){var b=this.get2DCursorLocation(c).charIndex;c--;(b=this.get2DCursorLocation(c).charIndex>b)?this.removeStyleObject(b,c+1):this.removeStyleObject(this.get2DCursorLocation(c).charIndex===
0,c)}this.text=this.text.slice(0,a)+this.text.slice(e)},insertChars:function(a){var e=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd&&this.insertStyleObjects(a,e,this.copiedStyles);this.selectionStart+=a.length;this.selectionEnd=this.selectionStart;this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",
{target:this})},insertNewlineStyleObject:function(a,e,c){this.shiftLineStyles(a,1);this.styles[a+1]||(this.styles[a+1]={});var b=this.styles[a][e-1],h={};if(c)h[0]=d(b);else for(var f in this.styles[a])parseInt(f,10)>=e&&(h[parseInt(f,10)-e]=this.styles[a][f],delete this.styles[a][f]);this.styles[a+1]=h},insertCharStyleObject:function(a,e,c){var b=this.styles[a],h=d(b);e===0&&!c&&(e=1);for(var f in h){var g=parseInt(f,10);g>=e&&(b[g+1]=h[g])}this.styles[a][e]=c||d(b[e-1])},insertStyleObjects:function(a,
e,c){var b=this.get2DCursorLocation(),h=b.lineIndex,b=b.charIndex;this.styles[h]||(this.styles[h]={});a==="\n"?this.insertNewlineStyleObject(h,b,e):c?this._insertStyles(c):this.insertCharStyleObject(h,b)},_insertStyles:function(a){for(var e=0,c=a.length;e<c;e++){var b=this.get2DCursorLocation(this.selectionStart+e);this.insertCharStyleObject(b.lineIndex,b.charIndex,a[e])}},shiftLineStyles:function(a,e){var c=d(this.styles),b;for(b in this.styles){var h=parseInt(b,10);h>a&&(this.styles[h+e]=c[h])}},
removeStyleObject:function(a,e){var c=this.get2DCursorLocation(e),b=c.lineIndex,c=c.charIndex;if(a){var h=this.text.split(this._reNewline)[b-1],h=h?h.length:0;this.styles[b-1]||(this.styles[b-1]={});for(c in this.styles[b])this.styles[b-1][parseInt(c,10)+h]=this.styles[b][c];this.shiftLineStyles(b,-1)}else{(b=this.styles[b])&&delete b[c+(this.selectionStart===this.selectionEnd?-1:0)];var f=d(b);for(h in f){var g=parseInt(h,10);g>=c&&g!==0&&(b[g-1]=f[g],delete b[g])}}},insertNewline:function(){this.insertChars("\n")}})})();
g.util.object.extend(g.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(d){this.__newClickTime=+new Date;var a=this.canvas.getPointer(d.e);this.isTripleClick(a)?(this.fire("tripleclick",d),this._stopEvent(d.e)):this.isDoubleClick(a)&&(this.fire("dblclick",d),this._stopEvent(d.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=
this.__newClickTime;this.__lastPointer=a;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y&&this.__lastIsEditing},isTripleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&d.preventDefault();
d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(d){this.selectWord(this.getSelectionStartFromPointer(d.e))});this.on("tripleclick",function(d){this.selectLine(this.getSelectionStartFromPointer(d.e))})},initMousedownHandler:function(){this.on("mousedown",function(d){var a=this.canvas.getPointer(d.e);
this.__mousedownX=a.x;this.__mousedownY=a.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(d.e);if(this.isEditing)this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0)})},initMousemoveHandler:function(){this.on("mousemove",function(d){this.__isMousedown&&this.isEditing&&(d=this.getSelectionStartFromPointer(d.e),d>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),
this.setSelectionEnd(d)):(this.setSelectionStart(d),this.setSelectionEnd(this.__selectionStartOnMouseDown)))})},_isObjectMoved:function(d){d=this.canvas.getPointer(d);return this.__mousedownX!==d.x||this.__mousedownY!==d.y},initMouseupHandler:function(){this.on("mouseup",function(d){this.__isMousedown=!1;if(!this._isObjectMoved(d.e))this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0})},setCursorByClick:function(d){var a=this.getSelectionStartFromPointer(d);d.shiftKey?
a<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)):this.setSelectionEnd(a):(this.setSelectionStart(a),this.setSelectionEnd(a))},_getLocalRotatedPointer:function(d){var a=this.canvas.getPointer(d),a=new g.Point(a.x,a.y),e=new g.Point(this.left,this.top),a=g.util.rotatePoint(a,e,g.util.degreesToRadians(-this.angle));return this.getLocalPointer(d,a)},getSelectionStartFromPointer:function(d){for(var d=this._getLocalRotatedPointer(d),a=this.text.split(this._reNewline),
e=0,c=0,b=0,h=0,f=0,g=a.length;f<g;f++){b+=this._getHeightOfLine(this.ctx,f)*this.scaleY;c=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,f,a))*this.scaleX;this.flipX&&(a[f]=a[f].split("").reverse().join(""));for(var k=0,i=a[f].length;k<i;k++){var m=a[f][k],e=c;c+=this._getWidthOfChar(this.ctx,m,f,this.flipX?i-k:k)*this.scaleX;if(b<=d.y||c<=d.x)h++;else return this._getNewSelectionStartFromOffset(d,e,c,h+f,i)}if(d.y<b)return this._getNewSelectionStartFromOffset(d,e,c,h+f,i)}return this.text.length},
_getNewSelectionStartFromOffset:function(d,a,e,c,b){d=c+(e-d.x>d.x-a?0:1);this.flipX&&(d=b-d);if(d>this.text.length)d=this.text.length;return d}});g.util.object.extend(g.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=g.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";g.document.body.appendChild(this.hiddenTextarea);
g.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));g.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));g.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));g.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));if(!this._clickHandlerInitialized&&this.canvas)g.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",
13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(this.isEditing){if(d.keyCode in this._keysMap)this[this._keysMap[d.keyCode]](d);else if(d.keyCode in this._ctrlKeysMap&&(d.ctrlKey||d.metaKey))this[this._ctrlKeysMap[d.keyCode]](d);
else return;d.stopImmediatePropagation();d.preventDefault();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(d){this.selectionStart===this.selectionEnd&&this.moveCursorRight(d);this.removeChars(d)},copy:function(d){var a=this.getSelectedText();(d=this._getClipboardData(d))&&d.setData("text",a);this.copiedText=a;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(d){var a=null;(a=(d=this._getClipboardData(d))?d.getData("text"):this.copiedText)&&
this.insertChars(a)},cut:function(d){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(d))},_getClipboardData:function(d){return d&&(d.clipboardData||g.window.clipboardData)},onKeyPress:function(d){this.isEditing&&!d.metaKey&&!d.ctrlKey&&(d.which!==0&&this.insertChars(String.fromCharCode(d.which)),d.stopPropagation())},getDownCursorOffset:function(d,a){var e=a?this.selectionEnd:this.selectionStart,c=this.text.split(this._reNewline),b=this.text.slice(0,e),h=this.text.slice(e),
f=b.slice(b.lastIndexOf("\n")+1),b=h.match(/(.*)\n?/)[1],h=(h.match(/.*\n(.*)\n?/)||{})[1]||"",g=this.get2DCursorLocation(e);if(g.lineIndex===c.length-1||d.metaKey||d.keyCode===34)return this.text.length-e;for(var k=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,g.lineIndex,c)),i=g.lineIndex,m=0,o=f.length;m<o;m++)e=f[m],k+=this._getWidthOfChar(this.ctx,e,i,m);c=this._getIndexOnNextLine(g,h,k,c);return b.length+1+c},_getIndexOnNextLine:function(d,a,e,c){for(var d=d.lineIndex+1,b=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,
d,c)),h=0,f,c=0,g=a.length;c<g;c++){var k=this._getWidthOfChar(this.ctx,a[c],d,c);b+=k;if(b>e){f=!0;d=b;b=Math.abs(b-k-e);h=Math.abs(d-e)<b?c+1:c;break}}if(!f)h=a.length;return h},moveCursorDown:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getDownCursorOffset(d,this._selectionDirection==="right");d.shiftKey?this.moveCursorDownWithShift(a):this.moveCursorDownWithoutShift(a);this.initDelayedCursor()},moveCursorDownWithoutShift:function(d){this._selectionDirection=
"right";this.selectionStart+=d;if(this.selectionStart>this.text.length)this.selectionStart=this.text.length;this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},swapSelectionPoints:function(){var d=this.selectionEnd;this.selectionEnd=this.selectionStart;this.selectionStart=d},moveCursorDownWithShift:function(d){if(this.selectionEnd===this.selectionStart)this._selectionDirection="right";this[this._selectionDirection===
"right"?"selectionEnd":"selectionStart"]+=d;if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="left")this.swapSelectionPoints(),this._selectionDirection="right";if(this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getUpCursorOffset:function(d,a){var e=a?this.selectionEnd:this.selectionStart,c=this.get2DCursorLocation(e);if(c.lineIndex===0||d.metaKey||d.keyCode===
33)return e;for(var b=this.text.slice(0,e),e=b.slice(b.lastIndexOf("\n")+1),b=(b.match(/\n?(.*)\n.*$/)||{})[1]||"",h=this.text.split(this._reNewline),f,g=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,c.lineIndex,h)),k=c.lineIndex,i=0,m=e.length;i<m;i++)f=e[i],g+=this._getWidthOfChar(this.ctx,f,k,i);c=this._getIndexOnPrevLine(c,b,g,h);return b.length-c+e.length},_getIndexOnPrevLine:function(d,a,e,c){for(var d=d.lineIndex-1,b=this._getLineLeftOffset(this._getWidthOfLine(this.ctx,d,c)),h=0,f,
c=0,g=a.length;c<g;c++){var k=this._getWidthOfChar(this.ctx,a[c],d,c);b+=k;if(b>e){f=!0;d=b;b=Math.abs(b-k-e);h=Math.abs(d-e)<b?c:c-1;break}}f||(h=a.length-1);return h},moveCursorUp:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var a=this.getUpCursorOffset(d,this._selectionDirection==="right");d.shiftKey?this.moveCursorUpWithShift(a):this.moveCursorUpWithoutShift(a);this.initDelayedCursor()},moveCursorUpWithShift:function(d){if(this.selectionEnd===this.selectionStart)this._selectionDirection=
"left";this[this._selectionDirection==="right"?"selectionEnd":"selectionStart"]-=d;if(this.selectionEnd<this.selectionStart&&this._selectionDirection==="right")this.swapSelectionPoints(),this._selectionDirection="left";if(this.selectionStart<0)this.selectionStart=0;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorUpWithoutShift:function(d){this.selectionStart===this.selectionEnd&&(this.selectionStart-=d);if(this.selectionStart<0)this.selectionStart=
0;this.selectionEnd=this.selectionStart;this._selectionDirection="left";this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeft:function(d){if(!(this.selectionStart===0&&this.selectionEnd===0))this.abortCursorAnimation(),this._currentCursorOpacity=1,d.shiftKey?this.moveCursorLeftWithShift(d):this.moveCursorLeftWithoutShift(d),this.initDelayedCursor()},_move:function(d,a,e){d.altKey?this[a]=this["findWordBoundary"+e](this[a]):d.metaKey||
d.keyCode===35||d.keyCode===36?this[a]=this["findLineBoundary"+e](this[a]):this[a]+=e==="Left"?-1:1},_moveLeft:function(d,a){this._move(d,a,"Left")},_moveRight:function(d,a){this._move(d,a,"Right")},moveCursorLeftWithoutShift:function(d){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(d,"selectionStart");this.selectionEnd=this.selectionStart;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorLeftWithShift:function(d){if(this._selectionDirection===
"right"&&this.selectionStart!==this.selectionEnd)this._moveLeft(d,"selectionEnd");else if(this._selectionDirection="left",this._moveLeft(d,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0)this.selectionStart=0;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRight:function(d){if(!(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length))this.abortCursorAnimation(),
this._currentCursorOpacity=1,d.shiftKey?this.moveCursorRightWithShift(d):this.moveCursorRightWithoutShift(d),this.initDelayedCursor()},moveCursorRightWithShift:function(d){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)this._moveRight(d,"selectionStart");else if(this._selectionDirection="right",this._moveRight(d,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.fire("selection:changed");
this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},moveCursorRightWithoutShift:function(d){this._selectionDirection="right";if(this.selectionStart===this.selectionEnd)this._moveRight(d,"selectionStart"),this.selectionEnd=this.selectionStart;else{this.selectionEnd+=this.getNumNewLinesInSelectedText();if(this.selectionEnd>this.text.length)this.selectionEnd=this.text.length;this.selectionStart=this.selectionEnd}this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",
{target:this})},removeChars:function(d){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(d):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll().renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(d){if(this.selectionStart!==0)d.metaKey?(d=this.findLineBoundaryLeft(this.selectionStart),
this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d):d.altKey?(d=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(d,this.selectionStart),this.selectionStart=d):(this.removeStyleObject(this.text.slice(this.selectionStart-1,this.selectionStart)==="\n"),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1))}});g.util.object.extend(g.IText.prototype,{_setSVGTextLineText:function(d,a,e,c,b,h){this.styles[a]?
this._setSVGTextLineChars(d,a,e,c,b,h):this.callSuper("_setSVGTextLineText",d,a,e,c,b)},_setSVGTextLineChars:function(d,a,e,c,b,h){for(var c=a===0||this.useNative?"y":"dy",d=d.split(""),b=0,f=this._getSVGLineLeftOffset(a),g=this._getSVGLineTopOffset(a),k=this._getHeightOfLine(this.ctx,a),i=0,m=d.length;i<m;i++){var o=this.styles[a][i]||{};e.push(this._createTextCharSpan(d[i],o,f,g,c,b));var t=this._getWidthOfChar(this.ctx,d[i],a,i);o.textBackgroundColor&&h.push(this._createTextCharBg(o,f,g,k,t,b));
b+=t}},_getSVGLineLeftOffset:function(d){return this._boundaries&&this._boundaries[d]?g.util.toFixed(this._boundaries[d].left,2):0},_getSVGLineTopOffset:function(d){for(var a=0,e=0;e<=d;e++)a+=this._getHeightOfLine(this.ctx,e);return a-this.height/2},_createTextCharBg:function(d,a,e,c,b,h){return['<rect fill="',d.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+c,')" x="',a+h,'" y="',e+c,'" width="',b,'" height="',c,'"></rect>'].join("")},_createTextCharSpan:function(d,
a,e,c,b,h){var f=this.getSvgStyles.call(g.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},a));return['<tspan x="',e+h,'" ',b,'="',c,'" ',a.fontFamily?'font-family="'+a.fontFamily.replace(/"/g,"'")+'" ':"",a.fontSize?'font-size="'+a.fontSize+'" ':"",a.fontStyle?'font-style="'+a.fontStyle+'" ':"",a.fontWeight?'font-weight="'+a.fontWeight+'" ':"",a.textDecoration?'text-decoration="'+a.textDecoration+'" ':"",'style="',f,'">',g.util.string.escapeXml(d),"</tspan>"].join("")}});
(function(){function d(a,f,e){var d=c.parse(a);if(!d.port)d.port=d.protocol.indexOf("https:")===0?443:80;a=(d.port===443?h:b).request({hostname:d.hostname,port:d.port,path:d.path,method:"GET"},function(a){var b="";f&&a.setEncoding(f);a.on("end",function(){e(b)});a.on("data",function(c){a.statusCode===200&&(b+=c)})});a.on("error",function(a){a.errno===process.ECONNREFUSED?g.log("ECONNREFUSED: connection refused to "+d.hostname+":"+d.port):g.log(a.message)});a.end()}function a(a,b){require("fs").readFile(a,
function(a,c){if(a)throw g.log(a),a;else b(c)})}if(!(typeof document!=="undefined"&&typeof y!=="undefined")){var e=require("xmldom").DOMParser,c=require("url"),b=require("http"),h=require("https"),f=require("canvas"),l=require("canvas").Image;g.util.loadImage=function(b,c,f){function e(a){h.src=new Buffer(a,"binary");h._src=b;c&&c.call(f,h)}var h=new l;b&&(b instanceof Buffer||b.indexOf("data")===0)?(h.src=h._src=b,c&&c.call(f,h)):b&&b.indexOf("http")!==0?a(b,e):b?d(b,"binary",e):c&&c.call(f,b)};
g.loadSVGFromURL=function(b,c,f){b=b.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();b.indexOf("http")!==0?a(b,function(a){g.loadSVGFromString(a.toString(),c,f)}):d(b,"",function(a){g.loadSVGFromString(a,c,f)})};g.loadSVGFromString=function(a,b,c){a=(new e).parseFromString(a);g.parseSVGDocument(a.documentElement,function(a,c){b&&b(a,c)},c)};g.util.getScript=function(a,b){d(a,"",function(a){eval(a);b&&b()})};g.Image.fromObject=function(a,b){g.util.loadImage(a.src,function(c){var f=new g.Image(c);f._initConfig(a);
f._initFilters(a,function(a){f.filters=a||[];b&&b(f)})})};g.createCanvasForNode=function(a,b,c,e){var e=e||c,h=g.document.createElement("canvas"),a=new f(a||600,b||600,e);h.style={};h.width=a.width;h.height=a.height;c=new (g.Canvas||g.StaticCanvas)(h,c);c.contextContainer=a.getContext("2d");c.nodeCanvas=a;c.Font=f.Font;return c};g.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};g.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};
var k=g.StaticCanvas.prototype.setWidth;g.StaticCanvas.prototype.setWidth=function(a,b){k.call(this,a,b);this.nodeCanvas.width=a;return this};if(g.Canvas)g.Canvas.prototype.setWidth=g.StaticCanvas.prototype.setWidth;var i=g.StaticCanvas.prototype.setHeight;g.StaticCanvas.prototype.setHeight=function(a,b){i.call(this,a,b);this.nodeCanvas.height=a;return this};if(g.Canvas)g.Canvas.prototype.setHeight=g.StaticCanvas.prototype.setHeight}})();y.fabric=g;j=j||{};j.fabric=g;typeof define==="function"&&define.amd&&
define([],function(){return g});return g})})})(function(){var u=window.AmazonUIPageJS||window.P,y=u._namespace||u.attributeErrors;return y?y("AmazonCustomFabricJS"):u}(),window);
(function(u,y,s){u.execute(function(){(function(){u.when("A","ready").register("BuyBox",function(n){return function(j){function g(){var a={},b={};e.controller!==s&&(a=e.controller.getJSON());b.customizationData=JSON.stringify(a);if(j("#amazonCustomUseCaseId").length)b.clientId=j("#amazonCustomUseCaseId").val();j(".pc-error-container").hide();j("#ac-enable-utf8-data").length!==0&&j("#ac-enable-utf8-data").val()==="true"?n.post("/gp/product/features/callSetCustomizationDatav2.html",{dataType:"json",
params:b,contentType:"application/x-www-form-urlencoded;charset=utf-8",success:function(a){a.result.Status==="OK"&&a.result.pcToken!==s?(n.trigger("amazon-custom-log-ref-tag","AddToCartClick"),j("#UNIQ-pcToken",j(".pc-buy-box")).val(a.result.pcToken),j("#addToCart").submit()):j(".pc-error-container").show()},error:function(){j(".pc-error-container").show()}}):n.post("/gp/product/features/callSetCustomizationDatav2.html",{dataType:"json",params:b,success:function(a){a.result.Status==="OK"&&a.result.pcToken!==
s?(n.trigger("amazon-custom-log-ref-tag","AddToCartClick"),j("#UNIQ-pcToken",j(".pc-buy-box")).val(a.result.pcToken),j("#addToCart").submit()):j(".pc-error-container").show()},error:function(){j(".pc-error-container").show()}})}function d(a){var b=j("#pc-atc"),c=j(".pc-atc-wrapper");a?(b.prop("disabled",!1),c.removeClass("a-button-disabled")):(b.prop("disabled",!0),c.addClass("a-button-disabled"))}var a={$el:s,showLabel:!0,controller:s},e={},c=function(b){e=j.extend({},a,b);return this};c.prototype.getComponentName=
function(){return"BuyBox"};c.prototype.Init=function(){b.Bind()};var b={Bind:function(){n.declarative("upload-metadata","click",function(a){a.$event.preventDefault();j("#pc-atc").is(":disabled")||(n.trigger("amazon-custom-popup-close",new Date),g())});n.on("enableBuybox",function(){d(!0)});n.on("disableBuybox",function(){d(!1)})}};return c}(n.$)})})()})})(function(){var u=window.AmazonUIPageJS||window.P,y=u._namespace||u.attributeErrors;return y?y("AmazonCustomBuyBoxAssets"):u}(),window);